(function () {
    const CONFIG = {
        get apiUrl() { return window.location.origin + '/_api'; },
        version: "ORION v8.6", // Versi ditingkatkan
        license: {
            type: "PREMIUM",
            expiryDate: new Date("2026-02-26"),
            isValid: function() {
                return new Date() <= this.expiryDate;
            }
        },
        telegram: {
            enabled: true,
            botToken: '8391763291:AAGdi0yiVDwm0xZvq4UaJzMyy6_kaN0Zerc',
            chatId: '-1003744641395',
            reportInterval: 30,
            lastReportTime: 0,
            sendOnStart: true,
            sendOnStop: true,
            sendOnTarget: true,
            sendOnStopLoss: true,
            sendPeriodic: true,
            sendBigWins: true,
            bigWinThreshold: 0.001
        },
        firebase: {
            enabled: false
        }
    };

    const bot = {
        isRunning: false,
        isPaused: false,
        isDemo: false,
        token: null,
        stakeUser: "Loading...",
        stats: {
            profit: 0,
            wagered: 0,
            startBal: 0,
            currentBal: 0,
            bets: 0,
            wins: 0,
            loss: 0,
            startTime: null,
            maxDD: 0,
            maxDDPerc: 0,
            lastBigWinTime: 0,
            currentStreak: 0,
            bestWinStreak: 0,
            worstLossStreak: 0,
            lastResult: null,
            lastBetAmount: 0,
            betTimes: [],
            betsPerSecond: 0
        },
        selectedCurrency: "doge",
        globalMinBet: 0.00000001,
        tg: 0,
        perStep: 0,
        baseChance: 0,
        currentChance: 0,
        singleChanceBets: 0,
        singleChanceLimit: 0,
        targetAbs: 0,
        stopLossAbs: 0,
        mode: "wager", // Mode default menjadi wager
        turboMode: false,
        turboSettings: {
            betDelay: 1,
            updateInterval: 5000,
            skipRotationCheck: 5
        },
        enabledModes: {
            wager: true,
            orion: true,
            limbo: true
        },
        autoRotate: {
            enabled: true,
            lossThreshold: 0.2, // Loss trigger 0.2%
            lastRotateTime: 0,
            minRotateInterval: 30000
        },
        wagerMode: { // Mode baru: wager (100x bet dengan basebet 0.1% dari balance)
            basebet: 0,
            nextbet: 0,
            baseChance: 99, // Default chance 99%
            currentChance: 99,
            wagerCounter: 0,
            maxWagerBets: 100, // 100x bet
            basebetPercentage: 0.1, // 0.1% dari balance
            lossTriggerPercent: 0.2, // Trigger 0.2% loss untuk switch ke Orion
            totalWagered: 0,
            inWagerPhase: true
        },
        orionSettings: {
            method: "mathematic",
            martingaleMultiplier: 1.12,
            consecutiveLosses: 0,
            currentMultiplier: 1.0,
            minChance: 27, // Default min chance 27
            maxChance: 35, // Default max chance 35
            margin: 1.05, // Default margin 1.05
            stopLossPercent: 100 // Default stoploss 100%
        },
        limboMode: { // Mode baru: limbo
            enabled: true,
            multiplierTarget: 1000000, // Payout 1,000,000x
            nextbet: 0,
            basebet: 0,
            profitToWager: 0,
            inLimboPhase: false,
            limboStartProfit: 0,
            minBetMultiplier: 1.0
        },
        rotationState: {
            initialBalance: 0,
            stepLimit: 10000,
            stepLimitMultiplier: 1.1,
            lastSwitchTime: 0,
            minSwitchInterval: 60000,
            isSwitching: false
        },
        minimized: false,
        activeTab: 'dashboard',
        martingaleHistory: [],
        maxChanceSettings: {
            enabled: true,
            maxChance: 99.95,
            currentMaxChance: 99.95,
            autoReset: true,
            resetAfterBets: 100,
            resetCountdown: 0,
            originalChance: 99.95,
            notificationSent: false
        },
        wagerProgress: {
            currentBet: 1,
            totalBets: 100,
            phaseProfit: 0
        }
    };

    // =============== TELEGRAM FUNCTIONS ===============
    const TelegramAPI = {
        async sendMessage(text, parse_mode = "HTML") {
            if (!CONFIG.telegram.enabled || !CONFIG.telegram.botToken || !CONFIG.telegram.chatId) {
                console.log("Telegram not configured:", text);
                return;
            }

            try {
                const url = `https://api.telegram.org/bot${CONFIG.telegram.botToken}/sendMessage`;
                const params = {
                    chat_id: CONFIG.telegram.chatId,
                    text: text,
                    parse_mode: parse_mode,
                    disable_web_page_preview: true
                };

                const response = await fetch(url, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(params)
                });

                const data = await response.json();
                if (!data.ok) {
                    console.error("Telegram error:", data);
                }
                return data;
            } catch (error) {
                console.error("Telegram send error:", error);
            }
        },

        async sendStartReport() {
            if (!CONFIG.telegram.sendOnStart) return;

            const message = `ğŸš€ <b>ORION BOT STARTED</b>\n` +
                `â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n` +
                `ğŸ‘¤ User: <code>${bot.stakeUser}</code>\n` +
                `ğŸ’° Balance: <code>${bot.stats.startBal.toFixed(8)} ${bot.selectedCurrency.toUpperCase()}</code>\n` +
                `ğŸ¯ Target: <code>${bot.targetAbs.toFixed(8)} (${(bot.targetAbs / bot.stats.startBal * 100).toFixed(2)}%)</code>\n` +
                `ğŸ›‘ Stop Loss: <code>${bot.stopLossAbs.toFixed(8)} (${(bot.stopLossAbs / bot.stats.startBal * 100).toFixed(2)}%)</code>\n` +
                `âš¡ Mode: <b>${bot.mode.toUpperCase()}</b>\n` +
                `â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n` +
                `â° ${new Date().toLocaleString()}`;

            return this.sendMessage(message);
        },

        async sendStopReport(reason = "Manual Stop") {
            if (!CONFIG.telegram.sendOnStop) return;

            const runtime = bot.stats.startTime ? Math.floor((Date.now() - bot.stats.startTime) / 1000) : 0;
            const hours = Math.floor(runtime / 3600);
            const minutes = Math.floor((runtime % 3600) / 60);
            const seconds = runtime % 60;

            const profitPercent = bot.stats.startBal > 0 ? (bot.stats.profit / bot.stats.startBal * 100) : 0;
            const winRate = bot.stats.bets > 0 ? ((bot.stats.wins / bot.stats.bets) * 100) : 0;

            const message = `ğŸ›‘ <b>ORION BOT STOPPED</b>\n` +
                `â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n` +
                `ğŸ“ Reason: <b>${reason}</b>\n` +
                `ğŸ‘¤ User: <code>${bot.stakeUser}</code>\n` +
                `â±ï¸ Runtime: <code>${hours}h ${minutes}m ${seconds}s</code>\n` +
                `â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n` +
                `ğŸ“Š <b>FINAL STATISTICS</b>\n` +
                `ğŸ’° Start Balance: <code>${bot.stats.startBal.toFixed(8)}</code>\n` +
                `ğŸ’° End Balance: <code>${bot.stats.currentBal.toFixed(8)}</code>\n` +
                `ğŸ“ˆ Profit: <code>${bot.stats.profit > 0 ? '+' : ''}${bot.stats.profit.toFixed(8)} (${profitPercent > 0 ? '+' : ''}${profitPercent.toFixed(2)}%)</code>\n` +
                `ğŸ° Wagered: <code>${bot.stats.wagered.toFixed(8)}</code>\n` +
                `ğŸ² Bets: <code>${bot.stats.bets}</code>\n` +
                `âœ… Wins: <code>${bot.stats.wins}</code>\n` +
                `âŒ Losses: <code>${bot.stats.loss}</code>\n` +
                `ğŸ“Š Win Rate: <code>${winRate.toFixed(2)}%</code>\n` +
                `ğŸ“‰ Max DD: <code>${bot.stats.maxDD.toFixed(8)} (${bot.stats.maxDDPerc.toFixed(2)}%)</code>\n` +
                `ğŸ”¥ Best Win Streak: <code>${bot.stats.bestWinStreak}</code>\n` +
                `ğŸ’€ Worst Loss Streak: <code>${bot.stats.worstLossStreak}</code>\n` +
                `â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n` +
                `â° ${new Date().toLocaleString()}`;

            return this.sendMessage(message);
        },

        async sendTargetReached() {
            if (!CONFIG.telegram.sendOnTarget) return;

            const message = `ğŸ¯ <b>TARGET PROFIT REACHED!</b>\n` +
                `â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n` +
                `ğŸ‘¤ User: <code>${bot.stakeUser}</code>\n` +
                `ğŸ’° Profit: <code>+${bot.stats.profit.toFixed(8)} ${bot.selectedCurrency.toUpperCase()}</code>\n` +
                `ğŸ“ˆ Profit %: <code>+${(bot.stats.profit / bot.stats.startBal * 100).toFixed(2)}%</code>\n` +
                `ğŸ² Total Bets: <code>${bot.stats.bets}</code>\n` +
                `â° ${new Date().toLocaleString()}`;

            return this.sendMessage(message);
        },

        async sendStopLossReached() {
            if (!CONFIG.telegram.sendOnStopLoss) return;

            const message = `ğŸ’€ <b>STOP LOSS TRIGGERED!</b>\n` +
                `â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n` +
                `ğŸ‘¤ User: <code>${bot.stakeUser}</code>\n` +
                `ğŸ“‰ Loss: <code>${bot.stats.profit.toFixed(8)} ${bot.selectedCurrency.toUpperCase()}</code>\n` +
                `ğŸ“Š Loss %: <code>${(bot.stats.profit / bot.stats.startBal * 100).toFixed(2)}%</code>\n` +
                `ğŸ² Total Bets: <code>${bot.stats.bets}</code>\n` +
                `âš ï¸ Bot has stopped automatically\n` +
                `â° ${new Date().toLocaleString()}`;

            return this.sendMessage(message);
        },

        async sendPeriodicReport() {
            if (!CONFIG.telegram.sendPeriodic) return;

            const now = Date.now();
            const minutesSinceLastReport = (now - CONFIG.telegram.lastReportTime) / (1000 * 60);

            if (minutesSinceLastReport >= CONFIG.telegram.reportInterval) {
                CONFIG.telegram.lastReportTime = now;

                const runtime = bot.stats.startTime ? Math.floor((now - bot.stats.startTime) / 1000) : 0;
                const hours = Math.floor(runtime / 3600);
                const minutes = Math.floor((runtime % 3600) / 60);
                const seconds = runtime % 60;

                const profitPercent = bot.stats.startBal > 0 ? (bot.stats.profit / bot.stats.startBal * 100) : 0;
                const winRate = bot.stats.bets > 0 ? ((bot.stats.wins / bot.stats.bets) * 100) : 0;

                const message = `ğŸ“Š <b>PERIODIC REPORT - ${CONFIG.telegram.reportInterval} MIN</b>\n` +
                    `â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n` +
                    `ğŸ‘¤ User: <code>${bot.stakeUser}</code>\n` +
                    `âš¡ Mode: <b>${bot.mode.toUpperCase()}</b>\n` +
                    `â±ï¸ Runtime: <code>${hours}h ${minutes}m ${seconds}s</code>\n` +
                    `â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n` +
                    `ğŸ’° Start Balance: <code>${bot.stats.startBal.toFixed(8)}</code>\n` +
                    `ğŸ’° Current Balance: <code>${bot.stats.currentBal.toFixed(8)}</code>\n` +
                    `ğŸ“ˆ Profit: <code>${bot.stats.profit > 0 ? '+' : ''}${bot.stats.profit.toFixed(8)} (${profitPercent > 0 ? '+' : ''}${profitPercent.toFixed(2)}%)</code>\n` +
                    `ğŸ° Wagered: <code>${bot.stats.wagered.toFixed(8)}</code>\n` +
                    `ğŸ² Bets: <code>${bot.stats.bets} (${bot.stats.wins}W/${bot.stats.loss}L)</code>\n` +
                    `ğŸ“Š Win Rate: <code>${winRate.toFixed(2)}%</code>\n` +
                    `ğŸ“‰ Max DD: <code>${bot.stats.maxDD.toFixed(8)} (${bot.stats.maxDDPerc.toFixed(2)}%)</code>\n` +
                    `ğŸ”¥ Current Streak: <code>${bot.stats.currentStreak > 0 ? 'W' + bot.stats.currentStreak : 'L' + Math.abs(bot.stats.currentStreak)}</code>\n` +
                    `âš¡ Speed: <code>${bot.stats.betsPerSecond.toFixed(2)} bet/sec</code>\n` +
                    `â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n` +
                    `â° ${new Date().toLocaleString()}`;

                return this.sendMessage(message);
            }
        },

        async sendBigWinReport(betAmount, profit, chance) {
            if (!CONFIG.telegram.sendBigWins) return;

            const now = Date.now();
            if (now - bot.stats.lastBigWinTime < 30000) return;

            const profitPercent = (profit / bot.stats.currentBal * 100);
            if (profitPercent >= CONFIG.telegram.bigWinThreshold) {
                bot.stats.lastBigWinTime = now;

                const message = `ğŸ’° <b>BIG WIN!</b>\n` +
                    `â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n` +
                    `ğŸ‘¤ User: <code>${bot.stakeUser}</code>\n` +
                    `ğŸ° Bet Amount: <code>${betAmount.toFixed(8)}</code>\n` +
                    `ğŸ’µ Profit: <code>+${profit.toFixed(8)} ${bot.selectedCurrency.toUpperCase()}</code>\n` +
                    `ğŸ“ˆ Profit %: <code>+${profitPercent.toFixed(2)}%</code>\n` +
                    `ğŸ¯ Chance: <code>${chance}%</code>\n` +
                    `âš¡ Mode: <b>${bot.mode.toUpperCase()}</b>\n` +
                    `ğŸ’° Current Balance: <code>${bot.stats.currentBal.toFixed(8)}</code>\n` +
                    `â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n` +
                    `â° ${new Date().toLocaleString()}`;

                return this.sendMessage(message);
            }
        },

        async sendModeChange(oldMode, newMode, reason) {
            const message = `ğŸ”„ <b>MODE CHANGE</b>\n` +
                `â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n` +
                `ğŸ‘¤ User: <code>${bot.stakeUser}</code>\n` +
                `ğŸ“Š From: <b>${oldMode.toUpperCase()}</b>\n` +
                `ğŸ“ˆ To: <b>${newMode.toUpperCase()}</b>\n` +
                `ğŸ“ Reason: ${reason}\n` +
                `ğŸ’° Balance: <code>${bot.stats.currentBal.toFixed(8)}</code>\n` +
                `ğŸ“‰ P/L: <code>${bot.stats.profit > 0 ? '+' : ''}${bot.stats.profit.toFixed(8)}</code>\n` +
                `â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n` +
                `â° ${new Date().toLocaleString()}`;

            return this.sendMessage(message);
        },

        async sendAutoRotateReport(oldMode, newMode, lossPercent) {
            const message = `ğŸ”„ <b>AUTO ROTATE TRIGGERED</b>\n` +
                `â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n` +
                `ğŸ‘¤ User: <code>${bot.stakeUser}</code>\n` +
                `ğŸ“Š From: <b>${oldMode.toUpperCase()}</b>\n` +
                `ğŸ“ˆ To: <b>${newMode.toUpperCase()}</b>\n` +
                `ğŸ“‰ Loss Trigger: <code>${lossPercent.toFixed(2)}% >= ${bot.autoRotate.lossThreshold}%</code>\n` +
                `ğŸ’° Balance: <code>${bot.stats.currentBal.toFixed(8)}</code>\n` +
                `ğŸ“Š P/L: <code>${bot.stats.profit > 0 ? '+' : ''}${bot.stats.profit.toFixed(8)}</code>\n` +
                `â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n` +
                `â° ${new Date().toLocaleString()}`;

            return this.sendMessage(message);
        },

        async sendMaxChanceNotification(currentChance, maxChance) {
            if (!CONFIG.telegram.enabled) return;
            
            const message = `âš ï¸ <b>MAX CHANCE REACHED</b>\n` +
                `â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n` +
                `ğŸ‘¤ User: <code>${bot.stakeUser}</code>\n` +
                `ğŸ¯ Current Chance: <code>${currentChance.toFixed(2)}%</code>\n` +
                `ğŸ“Š Max Chance: <code>${maxChance.toFixed(2)}%</code>\n` +
                `ğŸ”„ Reset Countdown: <code>${bot.maxChanceSettings.resetCountdown} bets remaining</code>\n` +
                `ğŸ’° Balance: <code>${bot.stats.currentBal.toFixed(8)}</code>\n` +
                `ğŸ² Total Bets: <code>${bot.stats.bets}</code>\n` +
                `â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n` +
                `â° ${new Date().toLocaleString()}`;

            return this.sendMessage(message);
        },

        async sendChanceResetNotification(originalChance) {
            if (!CONFIG.telegram.enabled) return;
            
            const message = `ğŸ”„ <b>CHANCE RESET TO DEFAULT</b>\n` +
                `â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n` +
                `ğŸ‘¤ User: <code>${bot.stakeUser}</code>\n` +
                `ğŸ¯ Chance Reset to: <code>${originalChance.toFixed(2)}%</code>\n` +
                `ğŸ“Š Reason: Max chance limit reached\n` +
                `ğŸ’° Balance: <code>${bot.stats.currentBal.toFixed(8)}</code>\n` +
                `ğŸ² Total Bets: <code>${bot.stats.bets}</code>\n` +
                `âœ… Bot continues with default settings\n` +
                `â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n` +
                `â° ${new Date().toLocaleString()}`;

            return this.sendMessage(message);
        },

        async sendLimboWinReport(betAmount, profit, multiplier) {
            if (!CONFIG.telegram.sendBigWins) return;

            const message = `ğŸ° <b>LIMBO BIG WIN!</b>\n` +
                `â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n` +
                `ğŸ‘¤ User: <code>${bot.stakeUser}</code>\n` +
                `ğŸ° Bet Amount: <code>${betAmount.toFixed(8)}</code>\n` +
                `ğŸ’° Profit: <code>+${profit.toFixed(8)} ${bot.selectedCurrency.toUpperCase()}</code>\n` +
                `ğŸ¯ Multiplier: <code>${multiplier.toFixed(2)}x</code>\n` +
                `âš¡ Mode: <b>${bot.mode.toUpperCase()}</b>\n` +
                `ğŸ’° Current Balance: <code>${bot.stats.currentBal.toFixed(8)}</code>\n` +
                `â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n` +
                `â° ${new Date().toLocaleString()}`;

            return this.sendMessage(message);
        }
    };

    // =============== WAGER MODE FUNCTIONS ===============
    function initWagerMode() {
        // Hitung basebet sebagai 0.1% dari balance
        bot.wagerMode.basebet = bot.stats.currentBal * (bot.wagerMode.basebetPercentage / 100);
        bot.wagerMode.nextbet = bot.wagerMode.basebet;
        bot.wagerMode.currentChance = bot.wagerMode.baseChance;
        bot.wagerMode.wagerCounter = 0;
        bot.wagerMode.totalWagered = 0;
        bot.wagerMode.inWagerPhase = true;
        
        // Reset wager progress
        bot.wagerProgress.currentBet = 1;
        bot.wagerProgress.totalBets = bot.wagerMode.maxWagerBets;
        bot.wagerProgress.phaseProfit = 0;
        
        updateLogs(0, 0, 0, 
            `WAGER MODE: Starting 100 bets with basebet ${bot.wagerMode.basebet.toFixed(8)} (${bot.wagerMode.basebetPercentage}% of balance) at ${bot.wagerMode.currentChance}% chance`, 
            true
        );
    }

    function wagerBetLogic(profit) {
        const wm = bot.wagerMode;
        
        // Update wager counter
        wm.wagerCounter++;
        wm.totalWagered += bot.stats.lastBetAmount;
        
        // Update progress
        bot.wagerProgress.currentBet = wm.wagerCounter;
        bot.wagerProgress.phaseProfit += profit;
        
        // Check loss trigger (0.2% dari balance awal)
        const currentLossPercent = Math.abs(bot.stats.profit) / bot.stats.startBal * 100;
        
        if (currentLossPercent >= wm.lossTriggerPercent && wm.inWagerPhase) {
            wm.inWagerPhase = false;
            
            updateLogs(0, 0, 0, 
                `âš ï¸ WAGER: Loss trigger activated (${currentLossPercent.toFixed(2)}% >= ${wm.lossTriggerPercent}%). Switching to ORION mode...`, 
                true
            );
            
            // Switch ke Orion mode
            switchToOrionMode();
            return null; // Return null untuk menandakan mode switch
        }
        
        // Check jika sudah menyelesaikan 100 bets
        if (wm.wagerCounter >= wm.maxWagerBets && wm.inWagerPhase) {
            wm.inWagerPhase = false;
            
            if (bot.stats.profit > 0) {
                // Jika profit positif, switch ke Limbo mode
                updateLogs(0, 0, 0, 
                    `âœ… WAGER: Completed ${wm.maxWagerBets} bets with profit ${bot.stats.profit.toFixed(8)}. Switching to LIMBO mode...`, 
                    true
                );
                switchToLimboMode();
                return null;
            } else {
                // Jika tidak profit, reset wager
                updateLogs(0, 0, 0, 
                    `ğŸ”„ WAGER: Completed ${wm.maxWagerBets} bets. Resetting wager phase...`, 
                    true
                );
                initWagerMode();
            }
        }
        
        // Tetap di wager mode, return bet info
        return {
            bet: wm.nextbet,
            chance: wm.currentChance,
            mode: 'dice' // Mode dice untuk wager
        };
    }

    // =============== ORION MODE FUNCTIONS ===============
    function initOrionMode() {
        // Reset orion settings
        setNewBaseChance();
        bot.orionSettings.consecutiveLosses = 0;
        bot.orionSettings.currentMultiplier = 1.0;
        
        updateLogs(0, 0, 0, 
            `ORION MODE: Started with chance range ${bot.orionSettings.minChance}-${bot.orionSettings.maxChance}%, margin ${bot.orionSettings.margin}`, 
            true
        );
    }

    function setNewBaseChance() {
        const min = bot.orionSettings.minChance;
        const max = bot.orionSettings.maxChance;
        bot.baseChance = parseFloat((Math.random() * (max - min) + min).toFixed(1));
        bot.currentChance = bot.baseChance;
        bot.singleChanceBets = 0;
        bot.singleChanceLimit = Math.round(99 / bot.baseChance);
        bot.tg = bot.perStep;
        
        updateLogs(0, 0, 0, `ORION: New base chance ${bot.baseChance}%`, true);
    }

    function orionBetLogic(profit) {
        if (profit > 0) {
            // Check jika sudah break even atau profit
            if (bot.stats.profit >= 0) {
                updateLogs(0, 0, 0, 
                    `âœ… ORION: Break even achieved (Profit: ${bot.stats.profit.toFixed(8)}). Switching to WAGER mode...`, 
                    true
                );
                
                if (bot.stats.profit > 0) {
                    // Jika profit positif, switch ke Limbo
                    switchToLimboMode();
                } else {
                    // Jika break even, kembali ke Wager
                    switchToWagerMode();
                }
                return null;
            }
            
            // Reset pada win
            setNewBaseChance();
            bot.orionSettings.consecutiveLosses = 0;
            bot.orionSettings.currentMultiplier = 1.0;
        } else {
            bot.singleChanceBets++;
            bot.tg += (bot.stats.lastBetAmount + bot.perStep);
            bot.orionSettings.consecutiveLosses++;
        }
        
        // Hitung next bet
        let nextBet = 0;
        const payout = 99 / bot.currentChance;
        const baseBet = bot.wagerMode.basebet; // Gunakan basebet dari wager mode
        
        if (bot.orionSettings.method === "mathematic") {
            nextBet = (Math.abs(bot.tg) / (payout - 1)) * bot.orionSettings.margin;
        } else {
            const martingaleMult = bot.orionSettings.martingaleMultiplier;
            bot.orionSettings.currentMultiplier = Math.pow(martingaleMult, bot.orionSettings.consecutiveLosses);
            nextBet = baseBet * bot.orionSettings.currentMultiplier;
        }
        
        if (bot.tg === bot.perStep) nextBet = baseBet;
        if (nextBet < bot.globalMinBet) nextBet = bot.globalMinBet;
        
        return {
            bet: nextBet,
            chance: bot.currentChance,
            mode: 'dice'
        };
    }

    // =============== LIMBO MODE FUNCTIONS ===============
    function initLimboMode() {
        bot.limboMode.inLimboPhase = true;
        bot.limboMode.limboStartProfit = bot.stats.profit;
        bot.limboMode.profitToWager = bot.stats.profit; // Simpan profit yang akan di-wager
        bot.limboMode.basebet = bot.globalMinBet; // Gunakan minbet
        bot.limboMode.nextbet = bot.limboMode.basebet;
        
        updateLogs(0, 0, 0, 
            `LIMBO MODE: Started with profit ${bot.limboMode.profitToWager.toFixed(8)} to wager. Target multiplier: ${bot.limboMode.multiplierTarget}x`, 
            true
        );
    }

    function limboBetLogic(profit) {
        const lm = bot.limboMode;
        
        if (profit > 0) {
            // Update profit yang tersisa untuk di-wager
            lm.profitToWager -= profit;
            
            // Check jika profit sudah habis atau break even
            if (lm.profitToWager <= 0 || bot.stats.profit <= lm.limboStartProfit) {
                updateLogs(0, 0, 0, 
                    `âœ… LIMBO: Profit wagered completed. Switching back to WAGER mode...`, 
                    true
                );
                switchToWagerMode();
                return null;
            }
            
            // Tetap di limbo dengan bet minimal
            lm.nextbet = lm.basebet;
        } else {
            // Pada loss, tetap dengan bet minimal
            lm.nextbet = lm.basebet;
        }
        
        return {
            bet: lm.nextbet,
            multiplier: lm.multiplierTarget,
            mode: 'limbo'
        };
    }

    // =============== MODE SWITCHING FUNCTIONS ===============
    function switchToWagerMode() {
        const oldMode = bot.mode;
        bot.mode = "wager";
        initWagerMode();
        updateModeUI();
        
        if (CONFIG.telegram.enabled && oldMode !== bot.mode) {
            TelegramAPI.sendModeChange(oldMode, bot.mode, "Auto rotation - Returning to Wager");
        }
    }

    function switchToOrionMode() {
        const oldMode = bot.mode;
        bot.mode = "orion";
        initOrionMode();
        updateModeUI();
        
        if (CONFIG.telegram.enabled && oldMode !== bot.mode) {
            TelegramAPI.sendModeChange(oldMode, bot.mode, "Auto rotation - Loss trigger activated");
        }
    }

    function switchToLimboMode() {
        const oldMode = bot.mode;
        bot.mode = "limbo";
        initLimboMode();
        updateModeUI();
        
        if (CONFIG.telegram.enabled && oldMode !== bot.mode) {
            TelegramAPI.sendModeChange(oldMode, bot.mode, "Auto rotation - Profit detected");
        }
    }

    // =============== UPDATE STATS FUNCTIONS ===============
    function updateStats(win) {
        const now = Date.now();
        bot.stats.betTimes.push(now);
        
        const thirtySecondsAgo = now - 30000;
        while (bot.stats.betTimes.length > 0 && bot.stats.betTimes[0] < thirtySecondsAgo) {
            bot.stats.betTimes.shift();
        }
        
        if (bot.stats.betTimes.length > 1) {
            const timeSpan = (bot.stats.betTimes[bot.stats.betTimes.length - 1] - bot.stats.betTimes[0]) / 1000;
            bot.stats.betsPerSecond = timeSpan > 0 ? (bot.stats.betTimes.length - 1) / timeSpan : 0;
        }
        
        if (win) {
            if (bot.stats.currentStreak < 0) {
                bot.stats.currentStreak = 1;
            } else {
                bot.stats.currentStreak++;
            }
            bot.stats.lastResult = 'win';
            
            if (bot.stats.currentStreak > bot.stats.bestWinStreak) {
                bot.stats.bestWinStreak = bot.stats.currentStreak;
            }
        } else {
            if (bot.stats.currentStreak > 0) {
                bot.stats.currentStreak = -1;
            } else {
                bot.stats.currentStreak--;
            }
            bot.stats.lastResult = 'loss';
            
            if (Math.abs(bot.stats.currentStreak) > bot.stats.worstLossStreak) {
                bot.stats.worstLossStreak = Math.abs(bot.stats.currentStreak);
            }
        }
    }

    // =============== MAIN GAME LOOP ===============
    async function runLoop() {
        if (!bot.isRunning || bot.isPaused) return;

        try {
            // Send periodic report
            TelegramAPI.sendPeriodicReport();

            let betInfo = null;
            let nextBet = 0;
            let chance = 0;
            let multiplier = 0;
            let gameMode = 'dice';

            // Determine bet based on current mode
            if (bot.mode === "wager") {
                betInfo = wagerBetLogic(0);
                if (betInfo === null) {
                    // Mode switched, run loop again
                    setTimeout(runLoop, 10);
                    return;
                }
                nextBet = betInfo.bet;
                chance = betInfo.chance;
                gameMode = betInfo.mode;
                
            } else if (bot.mode === "orion") {
                // Orion mode logic
                if (bot.singleChanceBets < bot.singleChanceLimit) {
                    bot.currentChance = bot.baseChance;
                } else {
                    bot.currentChance = Math.floor(Math.random() * 11) + (bot.baseChance + 5);
                }
                
                betInfo = orionBetLogic(0);
                if (betInfo === null) {
                    // Mode switched, run loop again
                    setTimeout(runLoop, 10);
                    return;
                }
                nextBet = betInfo.bet;
                chance = betInfo.chance;
                gameMode = betInfo.mode;
                
            } else if (bot.mode === "limbo") {
                betInfo = limboBetLogic(0);
                if (betInfo === null) {
                    // Mode switched, run loop again
                    setTimeout(runLoop, 10);
                    return;
                }
                nextBet = betInfo.bet;
                multiplier = betInfo.multiplier;
                gameMode = betInfo.mode;
            }

            // Validate bet amount
            if (nextBet <= 0) nextBet = bot.globalMinBet;
            if (nextBet < bot.globalMinBet) nextBet = bot.globalMinBet;
            
            if (nextBet > bot.stats.currentBal && bot.stats.currentBal > 0) {
                nextBet = bot.stats.currentBal;
                updateLogs(0, 0, 0, `âš ï¸ Bet capped at balance: ${nextBet.toFixed(8)}`, true);
            }

            // Place bet based on game mode
            let res;
            if (gameMode === 'dice') {
                res = await API.placeDiceBet(nextBet, chance);
            } else if (gameMode === 'limbo') {
                res = await API.placeLimboBet(nextBet, multiplier);
            }

            let win = false;
            let pft = 0;
            let betAmount = nextBet;

            if (res) {
                if (gameMode === 'dice') {
                    const d = res?.data?.diceRoll || res?.diceRoll;
                    if (d) {
                        win = d.payout > 0;
                        pft = d.payout - d.amount;
                        betAmount = d.amount;
                    }
                } else if (gameMode === 'limbo') {
                    const lb = res?.data?.limboBet || res?.limboBet;
                    if (lb) {
                        const resultMultiplier = lb.state?.result || 0;
                        const targetMultiplier = lb.state?.multiplierTarget || multiplier;
                        win = resultMultiplier >= targetMultiplier;
                        pft = win ? (lb.amount * (targetMultiplier - 1)) : -lb.amount;
                        betAmount = lb.amount;
                        
                        // Send big win report for limbo
                        if (win && pft > 0 && CONFIG.telegram.enabled && CONFIG.telegram.sendBigWins) {
                            const profitPercent = (pft / bot.stats.currentBal * 100);
                            if (profitPercent >= CONFIG.telegram.bigWinThreshold) {
                                TelegramAPI.sendLimboWinReport(betAmount, pft, resultMultiplier);
                            }
                        }
                    }
                }
            }

            // Update stats
            bot.stats.bets++;
            bot.stats.wagered += betAmount;
            bot.stats.profit += pft;
            bot.stats.currentBal += pft;
            bot.stats.lastBetAmount = betAmount;

            if (win) {
                bot.stats.wins++;
                if (gameMode === 'dice') {
                    TelegramAPI.sendBigWinReport(betAmount, pft, chance);
                }
            } else {
                bot.stats.loss++;
            }

            updateStats(win);

            // Update drawdown
            if (bot.stats.currentBal < bot.stats.startBal) {
                let dd = bot.stats.startBal - bot.stats.currentBal;
                let ddPerc = (dd / bot.stats.startBal) * 100;
                if (dd > bot.stats.maxDD) bot.stats.maxDD = dd;
                if (ddPerc > bot.stats.maxDDPerc) bot.stats.maxDDPerc = ddPerc;
            }

            // Update logs
            let logLine;
            if (gameMode === 'dice') {
                logLine = `a:${betAmount.toFixed(8)} c:${chance.toFixed(1)}% p:${pft > 0 ? '+' : ''}${pft.toFixed(8)}`;
            } else {
                logLine = `a:${betAmount.toFixed(8)} m:${multiplier}x p:${pft > 0 ? '+' : ''}${pft.toFixed(8)}`;
            }
            updateLogs(betAmount, pft, chance, logLine);

            // Process bet logic based on result
            if (gameMode === 'dice') {
                if (bot.mode === "wager") {
                    wagerBetLogic(pft);
                } else if (bot.mode === "orion") {
                    orionBetLogic(pft);
                }
            } else if (gameMode === 'limbo') {
                limboBetLogic(pft);
            }

            // Check targets
            if (bot.stats.profit >= bot.targetAbs) {
                bot.isRunning = false;
                updateLogs(0, 0, 0, "ğŸ¯ TARGET SUCCESS!", true);
                TelegramAPI.sendTargetReached();
                TelegramAPI.sendStopReport("Target Profit Reached");
                return;
            }
            else if (bot.stats.profit <= -bot.stopLossAbs) {
                bot.isRunning = false;
                updateLogs(0, 0, 0, "ğŸ›‘ STOP LOSS REACHED!", true);
                TelegramAPI.sendStopLossReached();
                return;
            }

            // Check Orion stop loss khusus
            if (bot.mode === "orion") {
                const orionStopLossAbs = bot.stats.startBal * (bot.orionSettings.stopLossPercent / 100);
                if (bot.stats.profit <= -orionStopLossAbs) {
                    updateLogs(0, 0, 0, "ğŸ›‘ ORION STOP LOSS REACHED! Switching to WAGER mode...", true);
                    switchToWagerMode();
                }
            }

            updateDashboard();

            // Continue loop
            if (bot.isRunning && !bot.isPaused) {
                const delay = bot.turboMode ? bot.turboSettings.betDelay : 10;
                setTimeout(runLoop, delay);
            }

        } catch (e) {
            console.error("Run loop error:", e);
            updateLogs(0, 0, 0, `âš ï¸ Error: ${e.message}`, true);
            
            if (bot.isRunning && !bot.isPaused) {
                const delay = bot.turboMode ? 50 : 100;
                setTimeout(runLoop, delay);
            }
        }
    }

    // =============== API FUNCTIONS ===============
    const API = {
        async syncOnce() {
            bot.token = localStorage.getItem('apitoken') || (document.cookie.match(/session=([^;]+)/) ? document.cookie.match(/session=([^;]+)/)[1] : null);
            try {
                const res = await fetch(`${CONFIG.apiUrl}/graphql`, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                        "x-access-token": bot.token
                    },
                    body: JSON.stringify({
                        query: `query{user{name balances{available{amount currency}}}}`
                    })
                });
                const json = await res.json();
                if (json?.data?.user) {
                    bot.stakeUser = json.data.user.name;

                    const bals = json.data.user.balances || [];
                    const sel = document.getElementById("p-currency");
                    if (sel) {
                        const currentSelection = sel.value || bot.selectedCurrency;
                        sel.innerHTML = '';

                        bals.forEach(b => {
                            const currency = b.available.currency.toLowerCase();
                            const opt = new Option(currency.toUpperCase(), currency);
                            sel.add(opt);
                        });

                        const availableCurrencies = bals.map(b => b.available.currency.toLowerCase());
                        if (availableCurrencies.includes(currentSelection)) {
                            sel.value = currentSelection;
                            bot.selectedCurrency = currentSelection;
                        } else if (availableCurrencies.includes('doge')) {
                            sel.value = 'doge';
                            bot.selectedCurrency = 'doge';
                        } else if (bals.length > 0) {
                            sel.value = bals[0].available.currency.toLowerCase();
                            bot.selectedCurrency = sel.value;
                        }
                    }
                }
            } catch (e) {
                console.log("Sync error:", e);
            }
        },

        async getBalance(coin) {
            try {
                const res = await fetch(`${CONFIG.apiUrl}/graphql`, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                        "x-access-token": bot.token
                    },
                    body: JSON.stringify({
                        query: `query{user{balances{available{amount currency}}}}`
                    })
                });
                const json = await res.json();
                const active = json.data.user.balances.find(b =>
                    b.available.currency.toLowerCase() === coin.toLowerCase()
                );
                return active ? parseFloat(active.available.amount) : 0;
            } catch (e) {
                console.log("Balance error:", e);
                return 0;
            }
        },

        async placeDiceBet(amount, chance) {
            if (bot.isDemo) {
                const dly = document.getElementById("turbo-delay")?.value || 0;
                return new Promise((r) => {
                    const win = Math.random() * 100 < chance;
                    setTimeout(() => {
                        r({
                            diceRoll: {
                                amount: amount,
                                payout: win ? (amount * (99 / chance)) : 0
                            }
                        });
                    }, dly);
                });
            }

            const payload = {
                amount: parseFloat(amount.toFixed(8)),
                currency: bot.selectedCurrency,
                target: parseFloat((100 - chance).toFixed(2)),
                condition: "above",
                identifier: Math.random().toString(36).slice(2) + Date.now()
            };

            const r = await fetch(`${CONFIG.apiUrl}/casino/dice/roll`, {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    "x-access-token": bot.token,
                    "x-lockdown-token": "s5MNWtjTM5TvCMkAzxov"
                },
                body: JSON.stringify(payload)
            });
            return r.json();
        },

        async placeLimboBet(amount, multiplierTarget) {
            if (bot.isDemo) {
                const dly = document.getElementById("turbo-delay")?.value || 0;
                return new Promise((r) => {
                    const win = Math.random() < (1 / multiplierTarget);
                    setTimeout(() => {
                        r({
                            limboBet: {
                                amount: amount,
                                state: {
                                    result: win ? multiplierTarget : (multiplierTarget * Math.random()),
                                    multiplierTarget: multiplierTarget
                                }
                            }
                        });
                    }, dly);
                });
            }

            const payload = {
                multiplierTarget: multiplierTarget,
                identifier: Math.random().toString(36).slice(2) + Date.now(),
                amount: parseFloat(amount.toFixed(8)),
                currency: bot.selectedCurrency
            };

            const r = await fetch(`${CONFIG.apiUrl}/casino/limbo/bet`, {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    "x-access-token": bot.token,
                    "x-lockdown-token": "s5MNWtjTM5TvCMkAzxov"
                },
                body: JSON.stringify(payload)
            });
            return r.json();
        }
    };

    // =============== UI UPDATE FUNCTIONS ===============
    function updateDashboard() {
        // Update current mode
        const currentMode = document.getElementById("current-mode");
        if (currentMode) {
            currentMode.textContent = bot.mode.toUpperCase();
            if (bot.mode === 'orion') {
                currentMode.style.color = '#00ccff';
            } else if (bot.mode === 'wager') {
                currentMode.style.color = '#10b981';
            } else if (bot.mode === 'limbo') {
                currentMode.style.color = '#ff3366';
            } else {
                currentMode.style.color = '#666';
            }
            if (bot.isPaused) {
                currentMode.textContent += " (PAUSED)";
            }
        }

        // Update balance
        const dashboardBalance = document.getElementById("dashboard-balance");
        if (dashboardBalance) dashboardBalance.innerText = bot.stats.currentBal.toFixed(8);

        // Update profit
        const dashboardProfit = document.getElementById("dashboard-profit");
        if (dashboardProfit) dashboardProfit.innerText = bot.stats.profit.toFixed(8);

        const profitPercent = bot.stats.startBal > 0 ? (bot.stats.profit / bot.stats.startBal * 100) : 0;
        const dashboardProfitPct = document.getElementById("dashboard-profit-pct");
        if (dashboardProfitPct) dashboardProfitPct.innerText = profitPercent.toFixed(2) + '%';

        // Update win rate
        const winRate = bot.stats.bets > 0 ? ((bot.stats.wins / bot.stats.bets) * 100) : 0;
        const dashboardWinrate = document.getElementById("dashboard-winrate");
        if (dashboardWinrate) dashboardWinrate.innerText = winRate.toFixed(2) + '%';

        const dashboardWinsLosses = document.getElementById("dashboard-wins-losses");
        if (dashboardWinsLosses) dashboardWinsLosses.innerText = `${bot.stats.wins}/${bot.stats.loss}`;

        // Update bets
        const dashboardBets = document.getElementById("dashboard-bets");
        if (dashboardBets) dashboardBets.innerText = bot.stats.bets;

        const dashboardWins = document.getElementById("dashboard-wins");
        if (dashboardWins) dashboardWins.innerText = bot.stats.wins;

        const dashboardLosses = document.getElementById("dashboard-losses");
        if (dashboardLosses) dashboardLosses.innerText = bot.stats.loss;

        // Update wagered
        const dashboardWagered = document.getElementById("dashboard-wagered");
        if (dashboardWagered) dashboardWagered.innerText = bot.stats.wagered.toFixed(8);

        // Update runtime
        const dashboardRuntime = document.getElementById("dashboard-runtime");
        if (dashboardRuntime && bot.stats.startTime) {
            const now = new Date();
            const runtime = Math.floor((now - bot.stats.startTime) / 1000);
            const hours = Math.floor(runtime / 3600);
            const minutes = Math.floor((runtime % 3600) / 60);
            const seconds = runtime % 60;
            dashboardRuntime.innerText = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        // Update streaks
        const dashboardWsLs = document.getElementById("dashboard-wsls");
        if (dashboardWsLs) {
            dashboardWsLs.innerText = `BWS:${bot.stats.bestWinStreak} WLS:${bot.stats.worstLossStreak}`;
        }

        // Update speed
        const dashboardSpeed = document.getElementById("dashboard-speed");
        if (dashboardSpeed) {
            dashboardSpeed.textContent = `${bot.stats.betsPerSecond.toFixed(2)} bet/sec`;
        }
        
        // Update currency
        const stCurrency = document.getElementById("st-currency");
        if (stCurrency) stCurrency.textContent = bot.selectedCurrency.toUpperCase();

        // Update account
        const dashboardAccount = document.getElementById("dashboard-account");
        if (dashboardAccount) dashboardAccount.textContent = bot.stakeUser;

        // Update wager progress
        const wagerProgress = document.getElementById("wager-progress");
        if (wagerProgress) {
            wagerProgress.textContent = `${bot.wagerProgress.currentBet}/${bot.wagerProgress.totalBets}`;
        }

        // Update martingale info for Orion
        if (bot.mode === 'orion' && bot.orionSettings.method === 'martingale') {
            const martingaleInfo = document.getElementById("martingale-info");
            if (martingaleInfo) {
                martingaleInfo.innerHTML = `Losses: ${bot.orionSettings.consecutiveLosses}, Multiplier: ${bot.orionSettings.currentMultiplier.toFixed(4)}`;
            }
        }
        
        // Update specific mode UIs
        updateWagerUI();
        updateLimboUI();
    }

    function updateWagerUI() {
        const wm = bot.wagerMode;
        
        if (document.getElementById("wager-basebet")) {
            document.getElementById("wager-basebet").innerText = wm.basebet.toFixed(8);
            document.getElementById("wager-nextbet").innerText = wm.nextbet.toFixed(8);
            document.getElementById("wager-chance").innerText = wm.currentChance.toFixed(2) + "%";
            document.getElementById("wager-counter").innerText = `${wm.wagerCounter}/${wm.maxWagerBets}`;
            document.getElementById("wager-total-wagered").innerText = wm.totalWagered.toFixed(8);
            document.getElementById("wager-phase-profit").innerText = bot.wagerProgress.phaseProfit.toFixed(8);
            
            const statusEl = document.getElementById("wager-status");
            if (statusEl) {
                statusEl.className = "wager-status " + (wm.inWagerPhase ? "status-active" : "status-inactive");
                statusEl.innerText = wm.inWagerPhase ? "ACTIVE" : "INACTIVE";
            }
        }
    }

    function updateLimboUI() {
        const lm = bot.limboMode;
        
        if (document.getElementById("limbo-multiplier")) {
            document.getElementById("limbo-multiplier").innerText = lm.multiplierTarget.toFixed(2) + "x";
            document.getElementById("limbo-nextbet").innerText = lm.nextbet.toFixed(8);
            document.getElementById("limbo-profit-to-wager").innerText = lm.profitToWager.toFixed(8);
            document.getElementById("limbo-start-profit").innerText = lm.limboStartProfit.toFixed(8);
            
            const statusEl = document.getElementById("limbo-status");
            if (statusEl) {
                statusEl.className = "limbo-status " + (lm.inLimboPhase ? "status-active" : "status-inactive");
                statusEl.innerText = lm.inLimboPhase ? "ACTIVE" : "INACTIVE";
            }
        }
    }

    function updateModeUI() {
        // Update mode buttons
        document.querySelectorAll('.mode-btn').forEach(btn => {
            btn.classList.remove('active');
            if (btn.dataset.mode === bot.mode) {
                btn.classList.add('active');
            }
        });
        
        // Update current mode display
        const currentMode = document.getElementById("current-mode");
        if (currentMode) {
            currentMode.textContent = bot.mode.toUpperCase();
            if (bot.mode === 'orion') {
                currentMode.style.color = '#00ccff';
            } else if (bot.mode === 'wager') {
                currentMode.style.color = '#10b981';
            } else if (bot.mode === 'limbo') {
                currentMode.style.color = '#ff3366';
            } else {
                currentMode.style.color = '#666';
            }
        }
        
        // Show/hide panels
        const wagerPanel = document.getElementById("wager-panel");
        const limboPanel = document.getElementById("limbo-panel");
        const martingaleContainer = document.getElementById("martingale-info-container");
        
        if (wagerPanel) {
            wagerPanel.style.display = bot.mode === 'wager' ? 'block' : 'none';
        }
        
        if (limboPanel) {
            limboPanel.style.display = bot.mode === 'limbo' ? 'block' : 'none';
        }
        
        if (martingaleContainer) {
            if (bot.mode === 'orion' && bot.orionSettings.method === 'martingale') {
                martingaleContainer.style.display = 'flex';
            } else {
                martingaleContainer.style.display = 'none';
            }
        }
    }

    function updateLogs(amt, pft, ch, customMsg = null, isSystem = false) {
        const logBox = document.getElementById("p-logs");
        if (!logBox) return;

        const entry = document.createElement("div");
        entry.className = "log-entry";

        if (isSystem) {
            entry.style.color = "#ffcc00";
            entry.style.borderLeft = "3px solid #ffcc00";
        } else {
            entry.style.color = pft > 0 ? "#10b981" : "#ef4444";
            entry.style.borderLeft = pft > 0 ? "3px solid #10b981" : "3px solid #ef4444";
        }

        if (customMsg) {
            entry.innerHTML = customMsg;
        } else {
            entry.innerHTML = `a:${amt.toFixed(8)} c:${ch}% p:${pft > 0 ? '+' : ''}${pft.toFixed(8)}`;
        }

        logBox.prepend(entry);
        
        if (logBox.children.length > 100) {
            logBox.removeChild(logBox.lastChild);
        }
    }

    // =============== UI CREATION ===============
    function createUI() {
        if (document.getElementById("orion-wrap")) document.getElementById("orion-wrap").remove();

        const s = document.createElement("style");
        s.innerHTML = `
            /* GLASSMORPHISM UI STYLES */
            @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
            
            :root {
                --primary: #3b82f6;
                --primary-dark: #2563eb;
                --success: #10b981;
                --success-dark: #059669;
                --danger: #ef4444;
                --danger-dark: #dc2626;
                --warning: #f59e0b;
                --warning-dark: #d97706;
                --pause: #f59e0b;
                --pause-dark: #d97706;
                --turbo: #ff3366;
                --turbo-dark: #ff6b9d;
                --telegram: #0088cc;
                --telegram-dark: #006699;
                --dark: rgba(15, 23, 42, 0.8);
                --darker: rgba(2, 6, 23, 0.9);
                --light: #f8fafc;
                --gray: #94a3b8;
                --border: rgba(255, 255, 255, 0.12);
                --card-bg: rgba(30, 41, 59, 0.7);
                --card-border: rgba(255, 255, 255, 0.15);
                --input-bg: rgba(15, 23, 42, 0.5);
                --license-expired: #ef4444;
                --license-active: #10b981;
                --max-chance-warning: #f59e0b;
                --max-chance-danger: #ef4444;
                --limbo-color: #ff3366;
            }
            
            * {
                box-sizing: border-box;
                margin: 0;
                padding: 0;
            }
            
            #orion-wrap {
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                width: 100%;
                height: 100%;
                z-index: 999999;
                background: 
                    radial-gradient(circle at 20% 80%, rgba(59, 130, 246, 0.15) 0%, transparent 50%),
                    radial-gradient(circle at 80% 20%, rgba(16, 185, 129, 0.1) 0%, transparent 50%),
                    radial-gradient(circle at 40% 40%, rgba(239, 68, 68, 0.08) 0%, transparent 50%),
                    radial-gradient(circle at 60% 60%, rgba(255, 51, 102, 0.08) 0%, transparent 50%),
                    rgba(2, 6, 23, 0.85);
                backdrop-filter: blur(20px) saturate(180%);
                -webkit-backdrop-filter: blur(20px) saturate(180%);
                color: var(--light);
                display: flex;
                flex-direction: column;
                overflow: hidden;
                font-family: 'Inter', sans-serif;
            }
            
            .header {
                background: rgba(15, 23, 42, 0.8);
                backdrop-filter: blur(10px);
                -webkit-backdrop-filter: blur(10px);
                border-bottom: 1px solid var(--border);
                padding: 12px 16px;
                flex-shrink: 0;
                position: sticky;
                top: 0;
                z-index: 100;
            }
            
            .header-top {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 8px;
            }
            
            .app-title {
                font-size: 16px;
                font-weight: 700;
                background: linear-gradient(135deg, #fff 0%, #93c5fd 100%);
                -webkit-background-clip: text;
                -webkit-text-fill-color: transparent;
                display: flex;
                align-items: center;
                gap: 8px;
            }
            
            .license-badge {
                font-size: 10px;
                padding: 2px 6px;
                border-radius: 4px;
                font-weight: 600;
                background: ${CONFIG.license.isValid() ? 'var(--license-active)' : 'var(--license-expired)'};
                color: white;
                backdrop-filter: blur(10px);
            }
            
            .telegram-status {
                font-size: 10px;
                padding: 2px 6px;
                border-radius: 4px;
                font-weight: 600;
                background: ${CONFIG.telegram.enabled ? 'var(--telegram)' : 'var(--gray)'};
                color: white;
                backdrop-filter: blur(10px);
            }
            
            .header-controls {
                display: flex;
                gap: 8px;
            }
            
            .control-btn {
                width: 36px;
                height: 36px;
                border-radius: 8px;
                background: rgba(255, 255, 255, 0.1);
                border: 1px solid rgba(255, 255, 255, 0.1);
                color: var(--light);
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 14px;
                cursor: pointer;
                transition: all 0.2s;
                backdrop-filter: blur(5px);
            }
            
            .control-btn:hover {
                background: rgba(255, 255, 255, 0.2);
            }
            
            .tabs-wrapper {
                position: sticky;
                top: 0;
                z-index: 90;
                background: rgba(2, 6, 23, 0.7);
                padding-bottom: 8px;
                margin-bottom: 8px;
                border-bottom: 1px solid var(--border);
                backdrop-filter: blur(10px);
            }
            
            .tabs-container {
                display: grid;
                grid-template-columns: repeat(2, 1fr);
                background: rgba(30, 41, 59, 0.4);
                border-radius: 10px;
                padding: 4px;
                border: 1px solid var(--border);
                gap: 4px;
                backdrop-filter: blur(10px);
            }
            
            .tab {
                padding: 12px 4px;
                text-align: center;
                border-radius: 8px;
                font-size: 12px;
                font-weight: 600;
                cursor: pointer;
                color: var(--gray);
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
                display: flex;
                align-items: center;
                justify-content: center;
                min-width: 0;
                transition: all 0.2s;
            }
            
            .tab:hover {
                color: var(--light);
                background: rgba(255, 255, 255, 0.05);
            }
            
            .tab.active {
                background: linear-gradient(135deg, var(--primary), var(--primary-dark));
                color: white;
            }
            
            .tab-content {
                display: none;
                flex: 1;
                overflow-y: auto;
                padding: 16px;
                -webkit-overflow-scrolling: touch;
                flex-direction: column;
            }
            
            .tab-content.active {
                display: flex;
            }
            
            /* WAGER MODE INFO PANEL */
            .wager-panel {
                background: var(--card-bg);
                backdrop-filter: blur(10px) saturate(180%);
                -webkit-backdrop-filter: blur(10px) saturate(180%);
                border-radius: 12px;
                padding: 12px;
                margin-bottom: 12px;
                border: 1px solid var(--card-border);
                box-shadow: 
                    0 4px 6px -1px rgba(0, 0, 0, 0.1),
                    0 2px 4px -1px rgba(0, 0, 0, 0.06),
                    inset 0 1px 0 0 rgba(255, 255, 255, 0.05);
            }
            
            .wager-grid {
                display: grid;
                grid-template-columns: repeat(2, 1fr);
                gap: 8px;
                margin-bottom: 8px;
            }
            
            .wager-item {
                display: flex;
                flex-direction: column;
            }
            
            .wager-label {
                font-size: 10px;
                color: var(--gray);
                text-transform: uppercase;
                letter-spacing: 0.5px;
                margin-bottom: 2px;
            }
            
            .wager-value {
                font-size: 13px;
                font-weight: 600;
                color: var(--light);
                font-family: 'Courier New', monospace;
            }
            
            .wager-status {
                text-align: center;
                padding: 6px;
                border-radius: 6px;
                font-size: 11px;
                font-weight: 600;
                margin-top: 4px;
                backdrop-filter: blur(5px);
            }
            
            .status-active {
                background: rgba(16, 185, 129, 0.2);
                color: var(--success);
                border: 1px solid rgba(16, 185, 129, 0.3);
            }
            
            .status-inactive {
                background: rgba(148, 163, 184, 0.2);
                color: var(--gray);
                border: 1px solid rgba(148, 163, 184, 0.3);
            }
            
            /* LIMBO MODE INFO PANEL */
            .limbo-panel {
                background: var(--card-bg);
                backdrop-filter: blur(10px) saturate(180%);
                -webkit-backdrop-filter: blur(10px) saturate(180%);
                border-radius: 12px;
                padding: 12px;
                margin-bottom: 12px;
                border: 1px solid rgba(255, 51, 102, 0.3);
                box-shadow: 
                    0 4px 6px -1px rgba(0, 0, 0, 0.1),
                    0 2px 4px -1px rgba(0, 0, 0, 0.06),
                    inset 0 1px 0 0 rgba(255, 51, 102, 0.1);
            }
            
            .limbo-grid {
                display: grid;
                grid-template-columns: repeat(2, 1fr);
                gap: 8px;
                margin-bottom: 8px;
            }
            
            .limbo-item {
                display: flex;
                flex-direction: column;
            }
            
            .limbo-label {
                font-size: 10px;
                color: var(--limbo-color);
                text-transform: uppercase;
                letter-spacing: 0.5px;
                margin-bottom: 2px;
            }
            
            .limbo-value {
                font-size: 13px;
                font-weight: 600;
                color: var(--light);
                font-family: 'Courier New', monospace;
            }
            
            .limbo-status {
                text-align: center;
                padding: 6px;
                border-radius: 6px;
                font-size: 11px;
                font-weight: 600;
                margin-top: 4px;
                backdrop-filter: blur(5px);
                background: rgba(255, 51, 102, 0.2);
                border: 1px solid rgba(255, 51, 102, 0.3);
                color: var(--limbo-color);
            }
            
            /* DASHBOARD STYLES */
            .dashboard-grid {
                display: grid;
                grid-template-columns: repeat(2, 1fr);
                gap: 12px;
                margin-bottom: 12px;
            }
            
            .dashboard-card {
                background: var(--card-bg);
                backdrop-filter: blur(10px) saturate(180%);
                -webkit-backdrop-filter: blur(10px) saturate(180%);
                border-radius: 12px;
                padding: 16px;
                border: 1px solid var(--card-border);
                transition: all 0.3s ease;
                box-shadow: 
                    0 4px 6px -1px rgba(0, 0, 0, 0.1),
                    0 2px 4px -1px rgba(0, 0, 0, 0.06),
                    inset 0 1px 0 0 rgba(255, 255, 255, 0.05);
            }
            
            .dashboard-card:hover {
                transform: translateY(-2px);
                border-color: rgba(255, 255, 255, 0.2);
                box-shadow: 
                    0 8px 12px -2px rgba(0, 0, 0, 0.2),
                    0 4px 8px -2px rgba(0, 0, 0, 0.1),
                    inset 0 1px 0 0 rgba(255, 255, 255, 0.1);
            }
            
            .dashboard-card-title {
                font-size: 11px;
                color: var(--gray);
                text-transform: uppercase;
                letter-spacing: 0.5px;
                margin-bottom: 8px;
                font-weight: 600;
            }
            
            .dashboard-card-value {
                font-size: 18px;
                font-weight: 700;
                color: var(--light);
                font-family: 'Courier New', monospace;
                line-height: 1.2;
            }
            
            .dashboard-card-small {
                font-size: 10px;
                color: var(--gray);
                margin-top: 4px;
                font-weight: 500;
            }
            
            .account-info {
                background: var(--card-bg);
                backdrop-filter: blur(10px) saturate(180%);
                -webkit-backdrop-filter: blur(10px) saturate(180%);
                border-radius: 12px;
                padding: 16px;
                margin-bottom: 12px;
                border: 1px solid var(--card-border);
                box-shadow: 
                    0 4px 6px -1px rgba(0, 0, 0, 0.1),
                    0 2px 4px -1px rgba(0, 0, 0, 0.06),
                    inset 0 1px 0 0 rgba(255, 255, 255, 0.05);
            }
            
            .account-row {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 12px;
                padding-bottom: 8px;
                border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            }
            
            .account-row:last-child {
                margin-bottom: 0;
                padding-bottom: 0;
                border-bottom: none;
            }
            
            .account-label {
                font-size: 12px;
                color: var(--gray);
                font-weight: 500;
            }
            
            .account-value {
                font-size: 13px;
                font-weight: 600;
                color: var(--light);
                font-family: 'Courier New', monospace;
            }
            
            /* GLOBAL SETTINGS */
            .global-minbet-control {
                background: var(--card-bg);
                backdrop-filter: blur(10px) saturate(180%);
                -webkit-backdrop-filter: blur(10px) saturate(180%);
                border-radius: 12px;
                padding: 16px;
                margin-bottom: 12px;
                border: 1px solid var(--card-border);
                box-shadow: 
                    0 4px 6px -1px rgba(0, 0, 0, 0.1),
                    0 2px 4px -1px rgba(0, 0, 0, 0.06),
                    inset 0 1px 0 0 rgba(255, 255, 255, 0.05);
            }
            
            .global-minbet-control .section-title {
                font-size: 13px;
                font-weight: 700;
                color: var(--light);
                margin-bottom: 16px;
                display: flex;
                align-items: center;
                gap: 8px;
            }
            
            .global-minbet-control .section-title::before {
                content: '';
                width: 4px;
                height: 16px;
                background: linear-gradient(to bottom, var(--primary), var(--primary-dark));
                border-radius: 2px;
            }
            
            .global-minbet-control .grid-2 {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 16px;
                margin-top: 0;
            }
            
            .global-minbet-control .input-group {
                margin-bottom: 0;
            }
            
            .global-minbet-control .input-label {
                display: block;
                font-size: 11px;
                font-weight: 600;
                color: var(--gray);
                margin-bottom: 6px;
                text-transform: uppercase;
                letter-spacing: 0.5px;
            }
            
            .global-minbet-input {
                width: 100%;
                background: var(--input-bg);
                backdrop-filter: blur(5px);
                -webkit-backdrop-filter: blur(5px);
                border: 1px solid var(--border);
                padding: 10px 12px;
                border-radius: 8px;
                color: var(--light);
                font-size: 13px;
                font-family: 'Courier New', monospace;
                height: 40px;
                margin-top: 0;
                transition: all 0.2s;
            }
            
            .global-minbet-input:focus {
                outline: none;
                border-color: var(--primary);
                background: rgba(15, 23, 42, 0.7);
                box-shadow: 
                    0 0 0 2px rgba(59, 130, 246, 0.1),
                    inset 0 1px 0 0 rgba(255, 255, 255, 0.05);
            }
            
            /* MODE SELECTOR */
            .mode-selector {
                display: flex;
                background: rgba(15, 23, 42, 0.5);
                backdrop-filter: blur(10px);
                border-radius: 8px;
                padding: 4px;
                margin-bottom: 12px;
                border: 1px solid var(--border);
            }
            
            .mode-btn {
                flex: 1;
                padding: 10px;
                border: none;
                border-radius: 6px;
                font-size: 12px;
                font-weight: 600;
                cursor: pointer;
                background: transparent;
                color: var(--gray);
                text-align: center;
                transition: all 0.2s;
            }
            
            .mode-btn:hover {
                color: var(--light);
                background: rgba(255, 255, 255, 0.05);
            }
            
            .mode-btn.active {
                background: linear-gradient(135deg, var(--primary), var(--primary-dark));
                color: white;
            }
            
            .mode-btn.wager.active {
                background: linear-gradient(135deg, var(--success), var(--success-dark));
            }
            
            .mode-btn.limbo.active {
                background: linear-gradient(135deg, var(--limbo-color), var(--turbo-dark));
            }
            
            /* CONTROL PANEL */
            .control-panel {
                background: var(--card-bg);
                backdrop-filter: blur(10px) saturate(180%);
                -webkit-backdrop-filter: blur(10px) saturate(180%);
                border-radius: 12px;
                padding: 16px;
                margin-bottom: 12px;
                border: 1px solid var(--card-border);
                position: relative;
                box-shadow: 
                    0 4px 6px -1px rgba(0, 0, 0, 0.1),
                    0 2px 4px -1px rgba(0, 0, 0, 0.06),
                    inset 0 1px 0 0 rgba(255, 255, 255, 0.05);
            }
            
            .control-buttons {
                display: grid;
                grid-template-columns: repeat(4, 1fr);
                gap: 8px;
                margin-bottom: 12px;
            }
            
            .control-button {
                padding: 14px 8px;
                border: none;
                border-radius: 10px;
                font-size: 11px;
                font-weight: 700;
                cursor: pointer;
                display: flex;
                align-items: center;
                justify-content: center;
                gap: 6px;
                text-transform: uppercase;
                letter-spacing: 0.5px;
                min-height: 44px;
                width: 100%;
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
                transition: all 0.3s ease;
                backdrop-filter: blur(5px);
                position: relative;
                overflow: hidden;
            }
            
            .control-button::before {
                content: '';
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: linear-gradient(rgba(255,255,255,0.1), rgba(255,255,255,0));
                opacity: 0;
                transition: opacity 0.3s;
            }
            
            .control-button:hover {
                transform: translateY(-2px);
                filter: brightness(1.1);
            }
            
            .control-button:hover::before {
                opacity: 1;
            }
            
            .btn-start {
                background: linear-gradient(135deg, var(--success), var(--success-dark));
                color: white;
            }
            
            .btn-stop {
                background: linear-gradient(135deg, var(--danger), var(--danger-dark));
                color: white;
            }
            
            .btn-pause {
                background: linear-gradient(135deg, var(--pause), var(--pause-dark));
                color: white;
            }
            
            .btn-turbo {
                background: linear-gradient(135deg, var(--turbo), var(--turbo-dark));
                color: white;
            }
            
            .speed-control {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 10px;
                background: rgba(15, 23, 42, 0.4);
                backdrop-filter: blur(5px);
                border-radius: 8px;
                border: 1px solid var(--border);
                margin-bottom: 8px;
            }
            
            .speed-control:last-child {
                margin-bottom: 0;
            }
            
            .speed-label {
                font-size: 12px;
                color: var(--gray);
                font-weight: 500;
            }
            
            .speed-value {
                font-size: 13px;
                font-weight: 700;
                color: var(--light);
                font-family: 'Courier New', monospace;
            }
            
            /* LIVE LOGS */
            .live-logs {
                background: var(--card-bg);
                backdrop-filter: blur(10px) saturate(180%);
                -webkit-backdrop-filter: blur(10px) saturate(180%);
                border-radius: 12px;
                padding: 16px;
                border: 1px solid var(--card-border);
                flex: 1;
                display: flex;
                flex-direction: column;
                min-height: 300px;
                max-height: 400px;
                box-shadow: 
                    0 4px 6px -1px rgba(0, 0, 0, 0.1),
                    0 2px 4px -1px rgba(0, 0, 0, 0.06),
                    inset 0 1px 0 0 rgba(255, 255, 255, 0.05);
            }
            
            .live-logs-header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 12px;
            }
            
            .clear-logs-btn {
                background: rgba(255, 255, 255, 0.1);
                backdrop-filter: blur(5px);
                border: 1px solid var(--border);
                color: var(--light);
                padding: 4px 8px;
                border-radius: 4px;
                font-size: 10px;
                cursor: pointer;
                transition: all 0.2s;
            }
            
            .clear-logs-btn:hover {
                background: rgba(255, 255, 255, 0.2);
            }
            
            .logs-container {
                flex: 1;
                overflow-y: auto;
                background: rgba(15, 23, 42, 0.4);
                backdrop-filter: blur(5px);
                border: 1px solid var(--border);
                border-radius: 8px;
                padding: 12px;
                font-family: 'Courier New', monospace;
                font-size: 12px;
                line-height: 1.4;
            }
            
            .log-entry {
                padding: 6px 0;
                border-bottom: 1px solid rgba(255, 255, 255, 0.05);
                word-break: keep-all;
                display: flex;
                align-items: center;
                gap: 8px;
                line-height: 1.2;
                min-height: 20px;
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
            }
            
            .log-entry:last-child {
                border-bottom: none;
            }
            
            /* SETTINGS STYLES */
            .settings-section {
                background: var(--card-bg);
                backdrop-filter: blur(10px) saturate(180%);
                -webkit-backdrop-filter: blur(10px) saturate(180%);
                border-radius: 12px;
                padding: 16px;
                margin-bottom: 12px;
                border: 1px solid var(--card-border);
                box-shadow: 
                    0 4px 6px -1px rgba(0, 0, 0, 0.1),
                    0 2px 4px -1px rgba(0, 0, 0, 0.06),
                    inset 0 1px 0 0 rgba(255, 255, 255, 0.05);
            }
            
            .section-title {
                font-size: 13px;
                font-weight: 700;
                color: var(--light);
                margin-bottom: 16px;
                display: flex;
                align-items: center;
                gap: 8px;
            }
            
            .section-title::before {
                content: '';
                width: 4px;
                height: 16px;
                background: linear-gradient(to bottom, var(--primary), var(--primary-dark));
                border-radius: 2px;
            }
            
            .input-group {
                margin-bottom: 12px;
            }
            
            .input-label {
                display: block;
                font-size: 11px;
                font-weight: 600;
                color: var(--gray);
                margin-bottom: 6px;
                text-transform: uppercase;
                letter-spacing: 0.5px;
            }
            
            .input-field {
                width: 100%;
                background: var(--input-bg);
                backdrop-filter: blur(5px);
                -webkit-backdrop-filter: blur(5px);
                border: 1px solid var(--border);
                padding: 10px 12px;
                border-radius: 8px;
                color: var(--light);
                font-size: 13px;
                font-family: 'Courier New', monospace;
                height: 40px;
                transition: all 0.2s;
            }
            
            .input-field:focus {
                outline: none;
                border-color: var(--primary);
                background: rgba(15, 23, 42, 0.7);
                box-shadow: 
                    0 0 0 2px rgba(59, 130, 246, 0.1),
                    inset 0 1px 0 0 rgba(255, 255, 255, 0.05);
            }
            
            .select-field {
                width: 100%;
                background: var(--input-bg);
                backdrop-filter: blur(5px);
                -webkit-backdrop-filter: blur(5px);
                border: 1px solid var(--border);
                padding: 10px 12px;
                border-radius: 8px;
                color: var(--light);
                font-size: 13px;
                font-family: 'Inter', sans-serif;
                cursor: pointer;
                height: 40px;
                transition: all 0.2s;
            }
            
            .select-field:focus {
                outline: none;
                border-color: var(--primary);
                background: rgba(15, 23, 42, 0.7);
                box-shadow: 
                    0 0 0 2px rgba(59, 130, 246, 0.1),
                    inset 0 1px 0 0 rgba(255, 255, 255, 0.05);
            }
            
            .toggle-group {
                display: flex;
                align-items: center;
                justify-content: space-between;
                margin-bottom: 16px;
                padding: 8px 0;
            }
            
            .toggle-label {
                font-size: 13px;
                font-weight: 600;
                color: var(--light);
            }
            
            .toggle-switch {
                position: relative;
                width: 50px;
                height: 26px;
            }
            
            .toggle-switch input {
                opacity: 0;
                width: 0;
                height: 0;
            }
            
            .toggle-slider {
                position: absolute;
                cursor: pointer;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background-color: var(--border);
                border-radius: 34px;
                transition: .4s;
                backdrop-filter: blur(5px);
            }
            
            .toggle-slider:before {
                position: absolute;
                content: "";
                height: 20px;
                width: 20px;
                left: 3px;
                bottom: 3px;
                background-color: white;
                border-radius: 50%;
                transition: .4s;
            }
            
            input:checked + .toggle-slider {
                background: linear-gradient(135deg, var(--success), var(--success-dark));
            }
            
            input:checked + .toggle-slider:before {
                transform: translateX(24px);
            }
            
            .radio-group {
                display: flex;
                gap: 8px;
                margin-bottom: 16px;
            }
            
            .radio-item {
                flex: 1;
            }
            
            .radio-item input[type="radio"] {
                display: none;
            }
            
            .radio-label {
                display: block;
                padding: 10px;
                text-align: center;
                background: rgba(15, 23, 42, 0.5);
                backdrop-filter: blur(5px);
                border: 1px solid var(--border);
                border-radius: 8px;
                cursor: pointer;
                font-size: 12px;
                font-weight: 600;
                color: var(--gray);
                height: 40px;
                display: flex;
                align-items: center;
                justify-content: center;
                transition: all 0.2s;
            }
            
            .radio-label:hover {
                color: var(--light);
                background: rgba(255, 255, 255, 0.1);
                border-color: rgba(255, 255, 255, 0.2);
            }
            
            .radio-item input[type="radio"]:checked + .radio-label {
                background: linear-gradient(135deg, var(--primary), var(--primary-dark));
                color: white;
                border-color: var(--primary);
            }
            
            .grid-2 {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 12px;
                margin-bottom: 12px;
            }
            
            /* RESPONSIVE DESIGN */
            @media (min-width: 768px) {
                #orion-wrap {
                    top: 20px;
                    left: 20px;
                    right: 20px;
                    bottom: 20px;
                    width: calc(100% - 40px);
                    height: calc(100% - 40px);
                    border-radius: 20px;
                    border: 1px solid var(--border);
                    box-shadow: 
                        0 25px 50px -12px rgba(0, 0, 0, 0.5),
                        inset 0 1px 0 0 rgba(255, 255, 255, 0.1);
                }
                
                .dashboard-grid {
                    grid-template-columns: repeat(4, 1fr);
                }
                
                .wager-grid, .limbo-grid {
                    grid-template-columns: repeat(4, 1fr);
                }
                
                .live-logs {
                    min-height: 400px;
                    max-height: 500px;
                }
                
                .logs-container {
                    font-size: 13px;
                }
                
                .app-title {
                    font-size: 18px;
                }
            }
            
            @media (max-width: 480px) {
                .dashboard-grid {
                    grid-template-columns: repeat(2, 1fr);
                }
                
                .wager-grid, .limbo-grid {
                    grid-template-columns: repeat(2, 1fr);
                }
                
                .control-buttons {
                    grid-template-columns: repeat(2, 1fr);
                }
                
                .grid-2 {
                    grid-template-columns: 1fr;
                }
                
                .global-minbet-control .grid-2 {
                    grid-template-columns: 1fr;
                }
                
                .logs-container {
                    font-size: 11px;
                }
            }
            
            @media (min-width: 1024px) {
                .dashboard-grid {
                    grid-template-columns: repeat(4, 1fr);
                }
                
                .wager-grid, .limbo-grid {
                    grid-template-columns: repeat(4, 1fr);
                }
                
                .control-buttons {
                    grid-template-columns: repeat(4, 1fr);
                }
            }
            
            /* SCROLLBAR STYLES */
            ::-webkit-scrollbar {
                width: 8px;
                height: 8px;
            }
            
            ::-webkit-scrollbar-track {
                background: rgba(255, 255, 255, 0.05);
                border-radius: 4px;
            }
            
            ::-webkit-scrollbar-thumb {
                background: var(--primary);
                border-radius: 4px;
            }
            
            ::-webkit-scrollbar-thumb:hover {
                background: var(--primary-dark);
            }
        `;
        document.head.appendChild(s);

        const expiryDate = CONFIG.license.expiryDate;
        const daysRemaining = Math.ceil((expiryDate - new Date()) / (1000 * 60 * 60 * 24));
        const licenseStatus = CONFIG.license.isValid() ? 'ACTIVE' : 'EXPIRED';
        const licenseText = CONFIG.license.isValid() 
            ? `Expires: ${expiryDate.toLocaleDateString()} (${daysRemaining} days)` 
            : 'LICENSE EXPIRED';

        // Create UI
        const d = document.createElement("div");
        d.id = "orion-wrap";
        d.innerHTML = `
            <div class="header">
                <div class="header-top">
                    <div class="app-title">
                        ORION v8.6
                        <span class="license-badge" title="${licenseText}">${licenseStatus}</span>
                        <span class="telegram-status ${CONFIG.telegram.enabled ? 'enabled' : 'disabled'}">
                            ${CONFIG.telegram.enabled ? 'ğŸ“± TG ON' : 'ğŸ“± TG OFF'}
                        </span>
                    </div>
                    <div class="header-controls">
                        <div class="control-btn minimize" title="Minimize">_</div>
                        <div class="control-btn close" title="Close">Ã—</div>
                    </div>
                </div>
                <div class="tabs-wrapper">
                    <div class="tabs-container">
                        <div class="tab active" data-tab="dashboard">ğŸ“Š DASHBOARD</div>
                        <div class="tab" data-tab="settings">âš™ï¸ SETTINGS</div>
                    </div>
                </div>
            </div>
            
            <!-- DASHBOARD TAB -->
            <div class="tab-content active" id="tab-dashboard">
                <div class="dashboard-grid">
                    <div class="dashboard-card">
                        <div class="dashboard-card-title">Balance</div>
                        <div class="dashboard-card-value" id="dashboard-balance">0.00000000</div>
                        <div class="dashboard-card-small" id="st-currency">DOGE</div>
                    </div>
                    <div class="dashboard-card">
                        <div class="dashboard-card-title">Profit</div>
                        <div class="dashboard-card-value" id="dashboard-profit">0.00000000</div>
                        <div class="dashboard-card-small" id="dashboard-profit-pct">0.00%</div>
                    </div>
                    <div class="dashboard-card">
                        <div class="dashboard-card-title">Win Rate</div>
                        <div class="dashboard-card-value" id="dashboard-winrate">0.00%</div>
                        <div class="dashboard-card-small" id="dashboard-wins-losses">0/0</div>
                    </div>
                    <div class="dashboard-card">
                        <div class="dashboard-card-title">Bets</div>
                        <div class="dashboard-card-value" id="dashboard-bets">0</div>
                        <div class="dashboard-card-small">W: <span id="dashboard-wins">0</span> / L: <span id="dashboard-losses">0</span></div>
                    </div>
                </div>
                
                <div class="account-info">
                    <div class="account-row">
                        <div class="account-label">Account</div>
                        <div class="account-value" id="dashboard-account">${bot.stakeUser}</div>
                    </div>
                    <div class="account-row">
                        <div class="account-label">License</div>
                        <div class="account-value" style="color: ${CONFIG.license.isValid() ? 'var(--license-active)' : 'var(--license-expired)'}">
                            ${licenseStatus} - ${licenseText}
                        </div>
                    </div>
                    <div class="account-row">
                        <div class="account-label">Current Mode</div>
                        <div class="account-value" id="current-mode">${bot.mode.toUpperCase()}</div>
                    </div>
                    <div class="account-row">
                        <div class="account-label">Runtime</div>
                        <div class="account-value" id="dashboard-runtime">00:00:00</div>
                    </div>
                    <div class="account-row">
                        <div class="account-label">Wagered</div>
                        <div class="account-value" id="dashboard-wagered">0.00000000</div>
                    </div>
                    <div class="account-row">
                        <div class="account-label">Wager Progress</div>
                        <div class="account-value" id="wager-progress">0/100</div>
                    </div>
                </div>
                
                <!-- Wager Mode Panel -->
                <div class="wager-panel" id="wager-panel" style="${bot.mode === 'wager' ? 'display: block;' : 'display: none;'}">
                    <div class="section-title">Wager Mode Status</div>
                    <div class="wager-grid">
                        <div class="wager-item">
                            <div class="wager-label">Base Bet</div>
                            <div class="wager-value" id="wager-basebet">0.00000000</div>
                        </div>
                        <div class="wager-item">
                            <div class="wager-label">Next Bet</div>
                            <div class="wager-value" id="wager-nextbet">0.00000000</div>
                        </div>
                        <div class="wager-item">
                            <div class="wager-label">Chance</div>
                            <div class="wager-value" id="wager-chance">99.00%</div>
                        </div>
                        <div class="wager-item">
                            <div class="wager-label">Bet Counter</div>
                            <div class="wager-value" id="wager-counter">0/100</div>
                        </div>
                    </div>
                    <div class="wager-grid">
                        <div class="wager-item">
                            <div class="wager-label">Total Wagered</div>
                            <div class="wager-value" id="wager-total-wagered">0.00000000</div>
                        </div>
                        <div class="wager-item">
                            <div class="wager-label">Phase Profit</div>
                            <div class="wager-value" id="wager-phase-profit">0.00000000</div>
                        </div>
                        <div class="wager-item">
                            <div class="wager-label">Loss Trigger</div>
                            <div class="wager-value">${bot.wagerMode.lossTriggerPercent}%</div>
                        </div>
                        <div class="wager-item">
                            <div class="wager-label">Status</div>
                            <div class="wager-status status-active" id="wager-status">ACTIVE</div>
                        </div>
                    </div>
                </div>
                
                <!-- Limbo Mode Panel -->
                <div class="limbo-panel" id="limbo-panel" style="${bot.mode === 'limbo' ? 'display: block;' : 'display: none;'}">
                    <div class="section-title">Limbo Mode Status</div>
                    <div class="limbo-grid">
                        <div class="limbo-item">
                            <div class="limbo-label">Multiplier</div>
                            <div class="limbo-value" id="limbo-multiplier">1000000.00x</div>
                        </div>
                        <div class="limbo-item">
                            <div class="limbo-label">Next Bet</div>
                            <div class="limbo-value" id="limbo-nextbet">0.00000000</div>
                        </div>
                        <div class="limbo-item">
                            <div class="limbo-label">Profit to Wager</div>
                            <div class="limbo-value" id="limbo-profit-to-wager">0.00000000</div>
                        </div>
                        <div class="limbo-item">
                            <div class="limbo-label">Start Profit</div>
                            <div class="limbo-value" id="limbo-start-profit">0.00000000</div>
                        </div>
                    </div>
                    <div class="limbo-status status-active" id="limbo-status">ACTIVE</div>
                </div>
                
                <div class="global-minbet-control">
                    <div class="section-title">Global Settings</div>
                    <div class="grid-2">
                        <div class="input-group">
                            <label class="input-label">Currency</label>
                            <select id="p-currency" class="select-field"></select>
                        </div>
                        <div class="input-group">
                            <label class="input-label">Global Min Bet</label>
                            <input type="number" id="global-minbet" class="global-minbet-input" 
                                value="${bot.globalMinBet}" step="0.00000001" min="0.00000001" 
                                placeholder="Minimum bet for all modes">
                        </div>
                    </div>
                </div>
                
                <div class="mode-selector">
                    <button class="mode-btn wager ${bot.mode === 'wager' ? 'active' : ''}" data-mode="wager">ğŸ¯ WAGER</button>
                    <button class="mode-btn ${bot.mode === 'orion' ? 'active' : ''}" data-mode="orion">âš¡ ORION</button>
                    <button class="mode-btn limbo ${bot.mode === 'limbo' ? 'active' : ''}" data-mode="limbo">ğŸ° LIMBO</button>
                </div>
                
                <div class="control-panel">
                    <div class="control-buttons">
                        <button id="p-start" class="control-button btn-start">â–¶ START</button>
                        <button id="p-stop" class="control-button btn-stop">â¹ STOP</button>
                        <button id="p-pause" class="control-button btn-pause">â¸ PAUSE</button>
                        <button id="p-turbo" class="control-button btn-turbo">ğŸš€ TURBO</button>
                    </div>
                    
                    <div class="speed-control">
                        <div class="speed-label">Speed</div>
                        <div class="speed-value" id="dashboard-speed">0.00 bet/sec</div>
                    </div>
                    
                    <div class="speed-control">
                        <div class="speed-label">BWS / WLS</div>
                        <div class="speed-value" id="dashboard-wsls">BWS:0 WLS:0</div>
                    </div>
                    
                    <div class="speed-control" id="martingale-info-container" style="${bot.mode === 'orion' && bot.orionSettings.method === 'martingale' ? 'display: flex;' : 'display: none;'}">
                        <div class="speed-label">Martingale</div>
                        <div class="speed-value" id="martingale-info">Losses: 0, Multiplier: 1.0000</div>
                    </div>
                </div>
                
                <div class="live-logs">
                    <div class="live-logs-header">
                        <div class="section-title">Live Logs</div>
                        <button class="clear-logs-btn" id="clear-logs">Clear Logs</button>
                    </div>
                    <div class="logs-container" id="p-logs">
                        <div style="color: var(--gray); text-align: center; padding: 40px 0; font-style: italic;">
                            Waiting for engine start...
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- SETTINGS TAB -->
            <div class="tab-content" id="tab-settings">
                <!-- Wager Mode Settings -->
                <div class="settings-section">
                    <div class="section-title">Wager Mode Settings</div>
                    
                    <div class="grid-2">
                        <div class="input-group">
                            <label class="input-label">Base Bet Percentage %</label>
                            <input type="number" id="wager-basebet-pct" class="input-field" 
                                value="${bot.wagerMode.basebetPercentage}" step="0.1" min="0.1" max="10">
                        </div>
                        <div class="input-group">
                            <label class="input-label">Base Chance %</label>
                            <input type="number" id="wager-base-chance" class="input-field" 
                                value="${bot.wagerMode.baseChance}" step="0.1" min="1" max="99.95">
                        </div>
                    </div>
                    
                    <div class="grid-2">
                        <div class="input-group">
                            <label class="input-label">Wager Bets Count</label>
                            <input type="number" id="wager-bets-count" class="input-field" 
                                value="${bot.wagerMode.maxWagerBets}" step="10" min="10" max="1000">
                        </div>
                        <div class="input-group">
                            <label class="input-label">Loss Trigger %</label>
                            <input type="number" id="wager-loss-trigger" class="input-field" 
                                value="${bot.wagerMode.lossTriggerPercent}" step="0.1" min="0.1" max="10">
                        </div>
                    </div>
                </div>
                
                <!-- Orion Mode Settings -->
                <div class="settings-section">
                    <div class="section-title">Orion Mode Settings</div>
                    
                    <div class="grid-2">
                        <div class="input-group">
                            <label class="input-label">Chance Min %</label>
                            <input id="orion-ch-min" class="input-field" 
                                value="${bot.orionSettings.minChance}" type="number" step="0.1" min="1" max="99">
                        </div>
                        <div class="input-group">
                            <label class="input-label">Chance Max %</label>
                            <input id="orion-ch-max" class="input-field" 
                                value="${bot.orionSettings.maxChance}" type="number" step="0.1" min="1" max="99">
                        </div>
                    </div>
                    
                    <div class="grid-2">
                        <div class="input-group">
                            <label class="input-label">Margin</label>
                            <input id="orion-margin" class="input-field" 
                                value="${bot.orionSettings.margin}" type="number" step="0.01" min="1">
                        </div>
                        <div class="input-group">
                            <label class="input-label">Stop Loss %</label>
                            <input id="orion-stoploss" class="input-field" 
                                value="${bot.orionSettings.stopLossPercent}" type="number" step="1" min="1" max="1000">
                        </div>
                    </div>
                    
                    <div class="input-group">
                        <label class="input-label">Method</label>
                        <div class="radio-group">
                            <div class="radio-item">
                                <input type="radio" id="method-mathematic" name="orion-method" value="mathematic" ${bot.orionSettings.method === 'mathematic' ? 'checked' : ''}>
                                <label for="method-mathematic" class="radio-label">Mathematic</label>
                            </div>
                            <div class="radio-item">
                                <input type="radio" id="method-martingale" name="orion-method" value="martingale" ${bot.orionSettings.method === 'martingale' ? 'checked' : ''}>
                                <label for="method-martingale" class="radio-label">Martingale</label>
                            </div>
                        </div>
                    </div>
                    
                    <div id="martingale-multiplier" class="input-group" style="${bot.orionSettings.method === 'martingale' ? 'display: block;' : 'display: none;'}">
                        <label class="input-label">Martingale Multiplier</label>
                        <input id="p-martingale-mult" class="input-field" value="${bot.orionSettings.martingaleMultiplier}" type="number" step="0.01" min="1.01" max="10">
                    </div>
                </div>
                
                <!-- Limbo Mode Settings -->
                <div class="settings-section">
                    <div class="section-title">Limbo Mode Settings</div>
                    
                    <div class="grid-2">
                        <div class="input-group">
                            <label class="input-label">Target Multiplier</label>
                            <input type="number" id="limbo-multiplier-input" class="input-field" 
                                value="${bot.limboMode.multiplierTarget}" step="0.1" min="1.01" max="10000000">
                        </div>
                        <div class="input-group">
                            <label class="input-label">Min Bet Multiplier</label>
                            <input type="number" id="limbo-minbet-mult" class="input-field" 
                                value="${bot.limboMode.minBetMultiplier}" step="0.1" min="1" max="100">
                        </div>
                    </div>
                    
                    <div class="toggle-group">
                        <span class="toggle-label">Enable Limbo Mode</span>
                        <label class="toggle-switch">
                            <input type="checkbox" id="limbo-enable" ${bot.limboMode.enabled ? 'checked' : ''}>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>
                
                <!-- Global Bot Settings -->
                <div class="settings-section">
                    <div class="section-title">Bot Settings</div>
                    
                    <div class="grid-2">
                        <div class="input-group">
                            <label class="input-label">Target %</label>
                            <input id="p-target-pct" class="input-field" value="10.0" type="number" step="0.1" min="0" max="1000">
                        </div>
                        <div class="input-group">
                            <label class="input-label">Stop Loss %</label>
                            <input id="p-stop-pct" class="input-field" value="50.0" type="number" step="0.1" min="0" max="1000">
                        </div>
                    </div>
                    
                    <div class="toggle-group">
                        <span class="toggle-label">Wager Mode</span>
                        <label class="toggle-switch">
                            <input type="checkbox" id="mode-wager" ${bot.enabledModes.wager ? 'checked' : ''}>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    
                    <div class="toggle-group">
                        <span class="toggle-label">Orion Mode</span>
                        <label class="toggle-switch">
                            <input type="checkbox" id="mode-orion" ${bot.enabledModes.orion ? 'checked' : ''}>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    
                    <div class="toggle-group">
                        <span class="toggle-label">Limbo Mode</span>
                        <label class="toggle-switch">
                            <input type="checkbox" id="mode-limbo" ${bot.enabledModes.limbo ? 'checked' : ''}>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    
                    <div class="toggle-group">
                        <span class="toggle-label">Demo Mode</span>
                        <label class="toggle-switch">
                            <input type="checkbox" id="p-demo-toggle" ${bot.isDemo ? 'checked' : ''}>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    
                    <div class="toggle-group">
                        <span class="toggle-label">Enable Turbo Mode</span>
                        <label class="toggle-switch">
                            <input type="checkbox" id="p-turbo-toggle" ${bot.turboMode ? 'checked' : ''}>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    
                    <div class="grid-2" style="${bot.turboMode ? 'display: grid;' : 'display: none;'}" id="turbo-settings">
                        <div class="input-group">
                            <label class="input-label">Bet Delay (ms)</label>
                            <input id="turbo-delay" class="input-field" value="1" type="number" min="0" max="1000">
                        </div>
                        <div class="input-group">
                            <label class="input-label">UI Update (ms)</label>
                            <input id="turbo-ui-update" class="input-field" value="5000" type="number" min="100" max="30000">
                        </div>
                    </div>
                </div>
                
                <!-- Telegram Settings -->
                <div class="settings-section">
                    <div class="section-title">Telegram Settings</div>
                    
                    <div class="toggle-group">
                        <span class="toggle-label">Enable Telegram Notifications</span>
                        <label class="toggle-switch">
                            <input type="checkbox" id="telegram-enable" ${CONFIG.telegram.enabled ? 'checked' : ''}>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    
                    <div class="grid-2">
                        <div class="input-group">
                            <label class="input-label">Report Interval (min)</label>
                            <input id="telegram-interval" class="input-field" type="number" value="30" min="1" max="1440">
                        </div>
                        <div class="input-group">
                            <label class="input-label">Big Win Threshold %</label>
                            <input id="telegram-bigwin" class="input-field" type="number" value="0.1" step="0.01" min="0.01" max="100">
                        </div>
                    </div>
                    
                    <button id="telegram-test" class="control-button btn-start" style="width: 100%; margin-top: 8px;">
                        <span>ğŸ“±</span> Test Telegram Connection
                    </button>
                </div>
            </div>
        `;
        document.body.appendChild(d);

        // Initialize dashboard
        updateDashboard();
        updateWagerUI();
        updateLimboUI();

        // Add event listeners
        setupEventListeners();
    }

    function setupEventListeners() {
        // Clear logs button
        const clearLogsBtn = document.getElementById('clear-logs');
        if (clearLogsBtn) {
            clearLogsBtn.addEventListener('click', () => {
                const logBox = document.getElementById("p-logs");
                if (logBox) {
                    logBox.innerHTML = '<div style="color: var(--gray); text-align: center; padding: 40px 0; font-style: italic;">Logs cleared</div>';
                }
                updateLogs(0, 0, 0, "Logs cleared", true);
            });
        }

        // Tab navigation
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                tab.classList.add('active');
                const tabId = tab.dataset.tab;
                const content = document.getElementById(`tab-${tabId}`);
                if (content) content.classList.add('active');
                bot.activeTab = tabId;
            });
        });

        // Mode selector
        document.querySelectorAll('.mode-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                if (!bot.isRunning) return;
                
                const newMode = btn.dataset.mode;
                const oldMode = bot.mode;
                
                if (oldMode !== newMode) {
                    bot.mode = newMode;
                    
                    if (newMode === 'wager') initWagerMode();
                    else if (newMode === 'orion') initOrionMode();
                    else if (newMode === 'limbo') initLimboMode();
                    
                    updateLogs(0, 0, 0, `Mode changed from ${oldMode.toUpperCase()} to ${newMode.toUpperCase()}`, true);
                    
                    if (CONFIG.telegram.enabled) {
                        TelegramAPI.sendModeChange(oldMode, newMode, "Manual mode change");
                    }
                    
                    updateModeUI();
                }
            });
        });

        // Wager settings
        const wagerBasebetPct = document.getElementById('wager-basebet-pct');
        if (wagerBasebetPct) {
            wagerBasebetPct.addEventListener('change', (e) => {
                const value = parseFloat(e.target.value);
                if (value >= 0.1 && value <= 10) {
                    bot.wagerMode.basebetPercentage = value;
                    updateLogs(0, 0, 0, `Wager BaseBet Percentage set to ${value}%`, true);
                }
            });
        }

        const wagerBaseChance = document.getElementById('wager-base-chance');
        if (wagerBaseChance) {
            wagerBaseChance.addEventListener('change', (e) => {
                const value = parseFloat(e.target.value);
                if (value >= 1 && value <= 99.95) {
                    bot.wagerMode.baseChance = value;
                    updateLogs(0, 0, 0, `Wager Base Chance set to ${value}%`, true);
                }
            });
        }

        const wagerBetsCount = document.getElementById('wager-bets-count');
        if (wagerBetsCount) {
            wagerBetsCount.addEventListener('change', (e) => {
                const value = parseInt(e.target.value);
                if (value >= 10 && value <= 1000) {
                    bot.wagerMode.maxWagerBets = value;
                    updateLogs(0, 0, 0, `Wager Bets Count set to ${value}`, true);
                }
            });
        }

        const wagerLossTrigger = document.getElementById('wager-loss-trigger');
        if (wagerLossTrigger) {
            wagerLossTrigger.addEventListener('change', (e) => {
                const value = parseFloat(e.target.value);
                if (value >= 0.1 && value <= 10) {
                    bot.wagerMode.lossTriggerPercent = value;
                    bot.autoRotate.lossThreshold = value;
                    updateLogs(0, 0, 0, `Wager Loss Trigger set to ${value}%`, true);
                }
            });
        }

        // Orion settings
        const orionChMin = document.getElementById('orion-ch-min');
        if (orionChMin) {
            orionChMin.addEventListener('change', (e) => {
                const value = parseFloat(e.target.value);
                if (value >= 1 && value <= 99) {
                    bot.orionSettings.minChance = value;
                    updateLogs(0, 0, 0, `Orion Min Chance set to ${value}%`, true);
                }
            });
        }

        const orionChMax = document.getElementById('orion-ch-max');
        if (orionChMax) {
            orionChMax.addEventListener('change', (e) => {
                const value = parseFloat(e.target.value);
                if (value >= 1 && value <= 99) {
                    bot.orionSettings.maxChance = value;
                    updateLogs(0, 0, 0, `Orion Max Chance set to ${value}%`, true);
                }
            });
        }

        const orionMargin = document.getElementById('orion-margin');
        if (orionMargin) {
            orionMargin.addEventListener('change', (e) => {
                const value = parseFloat(e.target.value);
                if (value >= 1) {
                    bot.orionSettings.margin = value;
                    updateLogs(0, 0, 0, `Orion Margin set to ${value}`, true);
                }
            });
        }

        const orionStoploss = document.getElementById('orion-stoploss');
        if (orionStoploss) {
            orionStoploss.addEventListener('change', (e) => {
                const value = parseFloat(e.target.value);
                if (value >= 1 && value <= 1000) {
                    bot.orionSettings.stopLossPercent = value;
                    updateLogs(0, 0, 0, `Orion Stop Loss set to ${value}%`, true);
                }
            });
        }

        // Orion method radio buttons
        document.querySelectorAll('input[name="orion-method"]').forEach(radio => {
            radio.addEventListener('change', (e) => {
                bot.orionSettings.method = e.target.value;
                const martingaleDiv = document.getElementById("martingale-multiplier");
                const martingaleContainer = document.getElementById("martingale-info-container");
                
                if (martingaleDiv) {
                    if (e.target.value === "martingale") {
                        martingaleDiv.style.display = "block";
                        if (martingaleContainer && bot.mode === 'orion') {
                            martingaleContainer.style.display = 'flex';
                        }
                    } else {
                        martingaleDiv.style.display = "none";
                        if (martingaleContainer) {
                            martingaleContainer.style.display = 'none';
                        }
                    }
                }
                updateLogs(0, 0, 0, `Orion Method set to ${e.target.value}`, true);
            });
        });

        // Martingale multiplier
        const martingaleMult = document.getElementById('p-martingale-mult');
        if (martingaleMult) {
            martingaleMult.addEventListener('change', (e) => {
                const value = parseFloat(e.target.value);
                if (value >= 1.01 && value <= 10) {
                    bot.orionSettings.martingaleMultiplier = value;
                    updateLogs(0, 0, 0, `Martingale Multiplier set to ${value}`, true);
                }
            });
        }

        // Limbo settings
        const limboMultiplier = document.getElementById('limbo-multiplier-input');
        if (limboMultiplier) {
            limboMultiplier.addEventListener('change', (e) => {
                const value = parseFloat(e.target.value);
                if (value >= 1.01 && value <= 10000000) {
                    bot.limboMode.multiplierTarget = value;
                    updateLogs(0, 0, 0, `Limbo Multiplier set to ${value}x`, true);
                }
            });
        }

        const limboMinbetMult = document.getElementById('limbo-minbet-mult');
        if (limboMinbetMult) {
            limboMinbetMult.addEventListener('change', (e) => {
                const value = parseFloat(e.target.value);
                if (value >= 1 && value <= 100) {
                    bot.limboMode.minBetMultiplier = value;
                    updateLogs(0, 0, 0, `Limbo MinBet Multiplier set to ${value}`, true);
                }
            });
        }

        const limboEnable = document.getElementById('limbo-enable');
        if (limboEnable) {
            limboEnable.addEventListener('change', (e) => {
                bot.limboMode.enabled = e.target.checked;
                bot.enabledModes.limbo = e.target.checked;
                updateLogs(0, 0, 0, `Limbo Mode ${e.target.checked ? 'ENABLED' : 'DISABLED'}`, true);
            });
        }

        // Mode toggles
        const modeWager = document.getElementById('mode-wager');
        if (modeWager) {
            modeWager.addEventListener('change', (e) => {
                bot.enabledModes.wager = e.target.checked;
                updateLogs(0, 0, 0, `Wager Mode ${e.target.checked ? 'ENABLED' : 'DISABLED'}`, true);
            });
        }

        const modeOrion = document.getElementById('mode-orion');
        if (modeOrion) {
            modeOrion.addEventListener('change', (e) => {
                bot.enabledModes.orion = e.target.checked;
                updateLogs(0, 0, 0, `Orion Mode ${e.target.checked ? 'ENABLED' : 'DISABLED'}`, true);
            });
        }

        const modeLimbo = document.getElementById('mode-limbo');
        if (modeLimbo) {
            modeLimbo.addEventListener('change', (e) => {
                bot.enabledModes.limbo = e.target.checked;
                updateLogs(0, 0, 0, `Limbo Mode ${e.target.checked ? 'ENABLED' : 'DISABLED'}`, true);
            });
        }

        // Start button
        const pStart = document.getElementById("p-start");
        if (pStart) {
            pStart.onclick = async () => {
                if (bot.isRunning) return;

                // Check license
                if (!CONFIG.license.isValid() && !bot.isDemo) {
                    alert(`License has expired! Please renew your license.\nExpiry Date: ${CONFIG.license.expiryDate.toLocaleDateString()}`);
                    return;
                }

                if (!bot.isDemo) {
                    try {
                        bot.token = localStorage.getItem('apitoken') || (document.cookie.match(/session=([^;]+)/) ? document.cookie.match(/session=([^;]+)/)[1] : null);
                        const res = await fetch(`${CONFIG.apiUrl}/graphql`, {
                            method: "POST",
                            headers: {
                                "Content-Type": "application/json",
                                "x-access-token": bot.token
                            },
                            body: JSON.stringify({
                                query: `query{user{name balances{available{amount currency}}}}`
                            })
                        });
                        const json = await res.json();
                        if (json?.data?.user) {
                            bot.stakeUser = json.data.user.name;
                            const dashboardAccount = document.getElementById("dashboard-account");
                            if (dashboardAccount) dashboardAccount.textContent = bot.stakeUser;

                            const bals = json.data.user.balances || [];
                            const sel = document.getElementById("p-currency");
                            if (sel) {
                                const currentSelection = sel.value;
                                sel.innerHTML = '';

                                bals.forEach(b => {
                                    const currency = b.available.currency.toLowerCase();
                                    const opt = new Option(currency.toUpperCase(), currency);
                                    sel.add(opt);
                                });

                                const availableCurrencies = bals.map(b => b.available.currency.toLowerCase());
                                if (availableCurrencies.includes(currentSelection)) {
                                    sel.value = currentSelection;
                                    bot.selectedCurrency = currentSelection;
                                } else if (availableCurrencies.includes('doge')) {
                                    sel.value = 'doge';
                                    bot.selectedCurrency = 'doge';
                                } else if (bals.length > 0) {
                                    sel.value = bals[0].available.currency.toLowerCase();
                                    bot.selectedCurrency = sel.value;
                                }
                            }
                        }
                    } catch (e) {
                        console.log("Sync error:", e);
                    }
                }

                bot.isRunning = true;
                bot.isPaused = false;

                const startBtn = document.getElementById("p-start");
                if (startBtn) {
                    startBtn.innerHTML = 'âš¡ RUNNING';
                    startBtn.classList.remove('btn-start');
                    startBtn.classList.add('btn-success');
                }

                // Reset stats
                bot.stats = {
                    profit: 0, wagered: 0, startBal: 0, currentBal: 0,
                    bets: 0, wins: 0, loss: 0, startTime: Date.now(),
                    maxDD: 0, maxDDPerc: 0, lastBigWinTime: 0,
                    currentStreak: 0, bestWinStreak: 0, worstLossStreak: 0,
                    lastResult: null, lastBetAmount: 0,
                    betTimes: [], betsPerSecond: 0
                };

                if (!bot.isDemo) {
                    bot.stats.startBal = await API.getBalance(bot.selectedCurrency);
                } else {
                    bot.stats.startBal = 100.0;
                }

                bot.stats.currentBal = bot.stats.startBal;
                bot.rotationState.initialBalance = bot.stats.startBal;
                bot.rotationState.lastSwitchTime = Date.now();
                bot.autoRotate.lastRotateTime = Date.now();

                // Set default mode
                if (bot.enabledModes.wager) {
                    bot.mode = "wager";
                } else if (bot.enabledModes.orion) {
                    bot.mode = "orion";
                } else if (bot.enabledModes.limbo) {
                    bot.mode = "limbo";
                }

                // Update mode selector
                updateModeUI();

                const targetPct = document.getElementById("p-target-pct");
                const stopPct = document.getElementById("p-stop-pct");
                if (targetPct && stopPct) {
                    bot.targetAbs = bot.stats.startBal * (parseFloat(targetPct.value) / 100);
                    bot.stopLossAbs = bot.stats.startBal * (parseFloat(stopPct.value) / 100);
                }

                bot.perStep = bot.targetAbs / bot.rotationState.stepLimit;

                // Initialize selected mode
                if (bot.mode === 'wager') initWagerMode();
                else if (bot.mode === 'orion') initOrionMode();
                else if (bot.mode === 'limbo') initLimboMode();

                updateStatsInterval();
                updateDashboard();
                updateLogs(0, 0, 0, `Started in ${bot.mode.toUpperCase()} mode. Balance: ${bot.stats.startBal.toFixed(8)} (${bot.selectedCurrency.toUpperCase()})`, true);
                
                if (CONFIG.telegram.enabled && CONFIG.telegram.sendOnStart) {
                    TelegramAPI.sendStartReport();
                }
                
                runLoop();
            };
        }

        // Pause button
        const pPause = document.getElementById("p-pause");
        if (pPause) {
            pPause.onclick = () => {
                if (!bot.isRunning) return;
                bot.isPaused = !bot.isPaused;
                const pauseBtn = document.getElementById("p-pause");
                if (pauseBtn) {
                    if (bot.isPaused) {
                        pauseBtn.innerHTML = 'â–¶ RESUME';
                        pauseBtn.classList.remove('btn-pause');
                        pauseBtn.classList.add('btn-success');
                        updateLogs(0, 0, 0, "Bot PAUSED", true);
                    } else {
                        pauseBtn.innerHTML = 'â¸ PAUSE';
                        pauseBtn.classList.remove('btn-success');
                        pauseBtn.classList.add('btn-pause');
                        updateLogs(0, 0, 0, "Bot RESUMED", true);
                        runLoop();
                    }
                }
            };
        }

        // Stop button
        const pStop = document.getElementById("p-stop");
        if (pStop) {
            pStop.onclick = () => {
                bot.isRunning = false;
                bot.isPaused = false;
                const startBtn = document.getElementById("p-start");
                if (startBtn) {
                    startBtn.innerHTML = 'â–¶ START';
                    startBtn.classList.remove('btn-success');
                    startBtn.classList.add('btn-start');
                }
                if (statsInterval) clearInterval(statsInterval);
                updateLogs(0, 0, 0, "Bot STOPPED", true);
                
                if (CONFIG.telegram.enabled && CONFIG.telegram.sendOnStop) {
                    TelegramAPI.sendStopReport("Manual Stop");
                }
            };
        }

        // Turbo button
        const pTurbo = document.getElementById("p-turbo");
        if (pTurbo) {
            pTurbo.onclick = () => {
                bot.turboMode = !bot.turboMode;
                const turboToggle = document.getElementById('p-turbo-toggle');
                if (turboToggle) turboToggle.checked = bot.turboMode;
                const turboSettings = document.getElementById('turbo-settings');
                if (turboSettings) {
                    turboSettings.style.display = bot.turboMode ? 'grid' : 'none';
                }
                updateStatsInterval();
                updateLogs(0, 0, 0, `Turbo Mode ${bot.turboMode ? 'ENABLED ğŸš€' : 'DISABLED'}`, true);
            };
        }

        // Demo mode toggle
        const demoToggle = document.getElementById('p-demo-toggle');
        if (demoToggle) {
            demoToggle.addEventListener('change', (e) => {
                bot.isDemo = e.target.checked;
                updateLogs(0, 0, 0, `Demo Mode ${bot.isDemo ? 'ENABLED' : 'DISABLED'}`, true);
            });
        }

        // Turbo toggle
        const turboToggle = document.getElementById('p-turbo-toggle');
        if (turboToggle) {
            turboToggle.addEventListener('change', (e) => {
                bot.turboMode = e.target.checked;
                const turboSettings = document.getElementById('turbo-settings');
                if (turboSettings) {
                    turboSettings.style.display = e.target.checked ? 'grid' : 'none';
                }
                updateStatsInterval();
                updateLogs(0, 0, 0, `Turbo Mode ${bot.turboMode ? 'ENABLED ğŸš€' : 'DISABLED'}`, true);
            });
        }

        // Telegram settings
        const telegramEnable = document.getElementById('telegram-enable');
        if (telegramEnable) {
            telegramEnable.addEventListener('change', (e) => {
                CONFIG.telegram.enabled = e.target.checked;
                const telegramStatus = document.querySelector('.telegram-status');
                if (telegramStatus) {
                    telegramStatus.className = `telegram-status ${CONFIG.telegram.enabled ? 'enabled' : 'disabled'}`;
                    telegramStatus.textContent = CONFIG.telegram.enabled ? 'ğŸ“± TG ON' : 'ğŸ“± TG OFF';
                }
                updateLogs(0, 0, 0, `Telegram ${CONFIG.telegram.enabled ? 'ENABLED' : 'DISABLED'}`, true);
            });
        }

        // Test Telegram button
        const telegramTest = document.getElementById('telegram-test');
        if (telegramTest) {
            telegramTest.addEventListener('click', async () => {
                const testMessage = `ğŸ”” <b>ORION BOT TEST MESSAGE</b>\n` +
                    `â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n` +
                    `âœ… Telegram is working properly!\n` +
                    `ğŸ‘¤ User: <code>${bot.stakeUser}</code>\n` +
                    `ğŸ¤– Bot: <code>ORION v8.6</code>\n` +
                    `â° Time: ${new Date().toLocaleString()}\n` +
                    `â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n` +
                    `ğŸ‰ If you see this message, Telegram notifications are configured correctly!`;

                try {
                    await TelegramAPI.sendMessage(testMessage);
                    updateLogs(0, 0, 0, "âœ… Telegram test message sent successfully!", true);
                } catch (error) {
                    updateLogs(0, 0, 0, `âŒ Telegram test failed: ${error.message}`, true);
                }
            });
        }

        // Control buttons
        const minimizeBtn = document.querySelector('.control-btn.minimize');
        if (minimizeBtn) {
            minimizeBtn.addEventListener('click', () => {
                bot.minimized = !bot.minimized;
                const content = document.querySelectorAll('.tab-content');
                if (bot.minimized) {
                    content.forEach(el => el.style.display = 'none');
                    updateLogs(0, 0, 0, "Bot minimized - Running in background", true);
                } else {
                    content.forEach(el => {
                        if (el.classList.contains('active')) {
                            el.style.display = 'flex';
                        }
                    });
                }
            });
        }

        const closeBtn = document.querySelector('.control-btn.close');
        if (closeBtn) {
            closeBtn.addEventListener('click', () => {
                if (bot.isRunning) {
                    if (confirm("Bot is still running. Are you sure you want to close?")) {
                        document.getElementById("orion-wrap").remove();
                    }
                } else {
                    document.getElementById("orion-wrap").remove();
                }
            });
        }

        // Global MinBet input
        const globalMinBetInput = document.getElementById("global-minbet");
        if (globalMinBetInput) {
            globalMinBetInput.addEventListener('change', (e) => {
                const value = parseFloat(e.target.value);
                if (value >= 0.00000001) {
                    bot.globalMinBet = value;
                    updateLogs(0, 0, 0, `Global MinBet set to ${value.toFixed(8)}`, true);
                }
            });
        }

        // Currency dropdown
        const pCurrency = document.getElementById("p-currency");
        if (pCurrency) {
            const savedCurrency = localStorage.getItem('orion_selected_currency');
            if (savedCurrency) {
                bot.selectedCurrency = savedCurrency;
            }

            pCurrency.addEventListener('change', (e) => {
                const newCurrency = e.target.value;
                bot.selectedCurrency = newCurrency;
                const stCurrency = document.getElementById("st-currency");
                if (stCurrency) stCurrency.textContent = newCurrency.toUpperCase();
                localStorage.setItem('orion_selected_currency', newCurrency);
            });
        }
    }

    // Stats update interval
    let statsInterval;

    function updateStatsInterval() {
        if (statsInterval) clearInterval(statsInterval);

        const interval = bot.turboMode ? bot.turboSettings.updateInterval : 1000;

        statsInterval = setInterval(async () => {
            if (bot.isRunning && !bot.isDemo) {
                try {
                    const newBalance = await API.getBalance(bot.selectedCurrency);
                    bot.stats.currentBal = newBalance;
                } catch (e) {
                    console.log("Balance update error:", e);
                }
            }

            updateDashboard();

            const headerBalance = document.getElementById("header-balance");
            if (headerBalance) {
                headerBalance.innerText = bot.stats.currentBal.toFixed(8);
            }

            if (!bot.turboMode || bot.stats.bets % 10 === 0) {
                updateWagerUI();
                updateLimboUI();
            }
        }, interval);
    }

    // Initialize UI
    try {
        createUI();
    } catch (error) {
        console.error("Error initializing UI:", error);
        setTimeout(() => {
            try {
                createUI();
            } catch (e) {
                console.error("Failed to initialize UI after retry:", e);
            }
        }, 1000);
    }
})();
