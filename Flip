(function () {
    // ==================== CONFIGURATION ====================
    const CONFIG = {
        get apiUrl() { return window.location.origin + '/_api'; },
        version: "ORION PRO v5.3 FLIP EDITION",
        tgToken: '8391763291:AAEA05v6FG70eM1WGrgU7mrPgckfjQaxkno',
        tgChatId: '-1003744641395',
        supportContact: '@OrionLogic',
        quickChartUrl: 'https://quickchart.io/chart'
    };

    // ==================== WHITELIST SYSTEM ====================
    const WHITELIST = {
        "orionlogic": { tier: "VIP", expiry: "2099-12-31" },
        "biele": { tier: "PREMIUM", expiry: "2026-02-26" },
        "siska82": { tier: "PREMIUM", expiry: "2026-02-26" },
        "dfransiska": { tier: "PREMIUM", expiry: "2026-02-26" },
        "brokenpips": { tier: "PREMIUM", expiry: "2026-02-26" },
        "aynus": { tier: "PREMIUM", expiry: "2026-02-26" },
        "terbaik444": { tier: "PREMIUM", expiry: "2026-01-30" },
        "k4pitiang": { tier: "PREMIUM", expiry: "2026-02-26" }
    };

    // ==================== LICENSE VALIDATION ====================
    let currentUser = null;
    let licenseData = null;
    let userExpiry = "";

    async function validateLicense() {
        try {
            const token = localStorage.getItem('apitoken') || 
                         (document.cookie.match(/session=([^;]+)/) ? 
                          document.cookie.match(/session=([^;]+)/)[1] : null);

            if (!token) {
                showLicenseModal("Please login to Stake.com first");
                return false;
            }

            const response = await fetch(`${CONFIG.apiUrl}/graphql`, {
                method: "POST",
                headers: { 
                    "Content-Type": "application/json",
                    "x-access-token": token 
                },
                body: JSON.stringify({ query: `query{user{name}}` })
            });

            const data = await response.json();
            const username = data?.data?.user?.name?.toLowerCase();

            if (!username) {
                showLicenseModal("Cannot retrieve username");
                return false;
            }

            currentUser = username;
            licenseData = WHITELIST[username];
            
            if (!licenseData) {
                showLicenseModal(
                    `Username <strong>${username}</strong> is not whitelisted.`, 
                    true
                );
                return false;
            }

            const expiryDate = new Date(licenseData.expiry);
            if (new Date() > expiryDate) {
                showLicenseModal(
                    `License expired on ${expiryDate.toLocaleDateString()}.`, 
                    true
                );
                return false;
            }

            userExpiry = expiryDate.toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'short',
                day: 'numeric'
            });

            console.log(`‚úÖ License validated: ${username} (${licenseData.tier}) - Expires: ${userExpiry}`);
            
            await sendTelegramReport("load");
            
            return true;

        } catch (error) {
            console.error("License validation error:", error);
            showLicenseModal("Connection error. Please refresh.");
            return false;
        }
    }

    function showLicenseModal(message, isError = false) {
        const modal = document.createElement('div');
        modal.style.cssText = `
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(15, 17, 23, 0.95);
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 99999;
            padding: 20px;
            font-family: 'Inter', sans-serif;
        `;
        
        modal.innerHTML = `
            <div style="background: linear-gradient(145deg, #1A1D28, #131722); border-radius: 16px; padding: 30px; max-width: 400px; width: 100%; border: 1px solid #374151; box-shadow: 0 20px 40px rgba(0,0,0,0.3); position: relative; overflow: hidden;">
                <div style="position: absolute; top: 0; left: 0; right: 0; height: 4px; background: linear-gradient(90deg, ${isError ? '#EF4444' : '#6366F1'}, ${isError ? '#DC2626' : '#8B5CF6'});"></div>
                
                <div style="text-align: center; margin-bottom: 25px;">
                    <div style="font-size: 42px; margin-bottom: 15px; color: ${isError ? '#EF4444' : '#6366F1'};">${isError ? '‚õî' : 'üîê'}</div>
                    <div style="font-size: 20px; font-weight: 800; margin-bottom: 8px; color: #F3F4F6; letter-spacing: 0.5px;">ORION PRO ACCESS</div>
                    <div style="font-size: 11px; color: #9CA3AF; letter-spacing: 1px; text-transform: uppercase;">${CONFIG.version}</div>
                </div>
                
                <div style="background: rgba(55, 65, 81, 0.3); padding: 18px; border-radius: 12px; margin-bottom: 25px; border: 1px solid #4B5563;">
                    <div style="font-size: 14px; color: #E5E7EB; text-align: center; line-height: 1.5;">${message}</div>
                </div>
                
                ${isError ? `
                <div style="background: linear-gradient(145deg, #1F2937, #111827); padding: 15px; border-radius: 10px; margin-bottom: 20px; border: 1px solid #6B7280;">
                    <div style="font-size: 12px; color: #FCA5A5; text-align: center;">
                        <div style="margin-bottom: 5px; font-weight: 600;">Need license?</div>
                        <div style="color: #9CA3AF;">Contact: ${CONFIG.supportContact}</div>
                    </div>
                </div>
                ` : ''}
                
                <button onclick="this.parentElement.parentElement.remove(); location.reload();" 
                        style="width: 100%; padding: 14px; background: linear-gradient(135deg, #374151, #4B5563); color: #F3F4F6; border: none; border-radius: 10px; font-weight: 700; font-size: 14px; cursor: pointer; transition: all 0.3s; letter-spacing: 0.5px; position: relative; overflow: hidden;">
                    <div style="position: absolute; top: 0; left: -100%; width: 100%; height: 100%; background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent); transition: 0.5s;"></div>
                    <span style="position: relative;">${isError ? 'üîÑ RETRY' : 'üöÄ CONTINUE'}</span>
                </button>
            </div>
        `;
        
        document.body.appendChild(modal);
        
        const btn = modal.querySelector('button');
        btn.onmouseenter = () => {
            btn.style.background = 'linear-gradient(135deg, #4B5563, #6B7280)';
            btn.style.transform = 'translateY(-2px)';
            btn.style.boxShadow = '0 8px 20px rgba(0,0,0,0.3)';
        };
        btn.onmouseleave = () => {
            btn.style.background = 'linear-gradient(135deg, #374151, #4B5563)';
            btn.style.transform = 'translateY(0)';
            btn.style.boxShadow = 'none';
        };
    }

    // ==================== FLIP RECOVERY SYSTEM ====================
    const FlipRecovery = {
        isActive: false,
        originalMode: null,
        originalProfit: 0,
        startBalance: 0,
        startTime: null,
        
        recoveryLevel: 1,
        maxLevels: 3,
        
        sequence: [1, 2, 3],
        baseBet: 0.00000100,
        flipsCompleted: 0,
        maxFlips: 100,
        
        pattern: [],
        patternAnalysis: "",
        currentSide: "heads",
        sideMode: "auto",
        
        stats: {
            totalRecoveries: 0,
            successfulRecoveries: 0,
            failedRecoveries: 0,
            totalRecovered: 0,
            totalTime: 0
        },
        
        profitHistory: [],
        chartHistory: [],
        
        initialize(originalMode, currentProfit) {
            this.isActive = true;
            this.recoveryLevel = 1;
            this.originalMode = originalMode;
            this.originalProfit = currentProfit;
            this.startBalance = bot.stats.currentBal;
            this.startTime = Date.now();
            this.flipsCompleted = 0;
            this.pattern = [];
            this.profitHistory = [];
            this.chartHistory = [];
            
            this.baseBet = getVal("p-flip-basebet") || 0.00000100;
            this.sideMode = getVal("p-flip-side-mode") || "auto";
            
            this.sequence = this.getInitialSequence(1);
            this.currentSide = this.determineInitialSide();
            
            this.addProfitToHistory(currentProfit);
            this.stats.totalRecoveries++;
            
            console.log(`üîÑ Flip Recovery Level ${this.recoveryLevel} Started`);
            
            return true;
        },
        
        getInitialSequence(level) {
            switch(level) {
                case 1: return [1, 2, 3];
                case 2: return [1, 1, 1];
                case 3: return [1];
                default: return [1];
            }
        },
        
        determineInitialSide() {
            switch(this.sideMode) {
                case "heads": return "heads";
                case "tails": return "tails";
                case "manual": return getVal("p-flip-manual-side") || "heads";
                case "auto":
                default: return this.analyzePatternForSide() || (Math.random() > 0.5 ? "heads" : "tails");
            }
        },
        
        analyzePatternForSide() {
            if (this.pattern.length < 3) return null;
            
            const lastFive = this.pattern.slice(0, Math.min(5, this.pattern.length));
            const lossCount = lastFive.filter(r => !r.win).length;
            
            if (lossCount >= 4) {
                return this.currentSide === "heads" ? "tails" : "heads";
            }
            
            return null;
        },
        
        getNextBet() {
            if (this.sequence.length === 0) return this.baseBet;
            
            if (this.sequence.length >= 2) {
                return this.baseBet * (this.sequence[0] + this.sequence[this.sequence.length - 1]);
            }
            
            return this.baseBet * this.sequence[0];
        },
        
        handleResult(win) {
            this.flipsCompleted++;
            
            this.pattern.unshift({
                win: win,
                side: this.currentSide,
                bet: this.getNextBet(),
                time: Date.now()
            });
            
            if (this.pattern.length > 10) {
                this.pattern.pop();
            }
            
            this.addProfitToHistory(bot.stats.sessionProfit);
            
            if (win) {
                return this.handleWin();
            } else {
                return this.handleLoss();
            }
        },
        
        handleWin() {
            if (this.sequence.length >= 2) {
                this.sequence.shift();
                this.sequence.pop();
            } else {
                this.sequence.shift();
            }
            
            if (this.sideMode === "auto") {
                this.analyzeAndAdjustSide();
            }
            
            if (this.sequence.length === 0) {
                return this.completeLevel(true);
            }
            
            return { complete: false, levelComplete: false };
        },
        
        handleLoss() {
            const betAmount = this.sequence.length >= 2 ? 
                this.sequence[0] + this.sequence[this.sequence.length - 1] : 
                this.sequence[0];
            
            this.sequence.push(betAmount);
            
            if (this.sideMode === "auto") {
                this.analyzeAndAdjustSide();
            }
            
            if (this.sequence.length > (getVal("p-flip-max-sequence") || 15)) {
                return this.completeLevel(false);
            }
            
            if (this.flipsCompleted >= this.maxFlips) {
                return this.completeLevel(false);
            }
            
            return { complete: false, levelComplete: false };
        },
        
        analyzeAndAdjustSide() {
            if (this.sideMode !== "auto" || this.pattern.length < 5) return;
            
            const lastFive = this.pattern.slice(0, 5);
            const lossCount = lastFive.filter(r => !r.win).length;
            
            if (lossCount >= 4) {
                const newSide = this.currentSide === "heads" ? "tails" : "heads";
                const oldSide = this.currentSide;
                
                this.currentSide = newSide;
                this.patternAnalysis = `Auto-switched to ${newSide} (${lossCount}/5 loss)`;
                
                console.log(`üîÑ Auto-switched from ${oldSide} to ${newSide}`);
                updateLogs(0, 0, "FLIP", 0, `Auto side switch: ${oldSide} ‚Üí ${newSide}`);
            }
        },
        
        shouldStop(currentProfit) {
            const breakEvenThreshold = this.originalProfit * 0.9995;
            return currentProfit >= breakEvenThreshold;
        },
        
        completeLevel(success) {
            if (success) {
                console.log(`‚úÖ Flip Recovery Level ${this.recoveryLevel} Complete`);
                
                if (this.shouldStop(bot.stats.sessionProfit)) {
                    return this.finalizeRecovery(true);
                }
                
                if (this.recoveryLevel < this.maxLevels) {
                    this.recoveryLevel++;
                    this.sequence = this.getInitialSequence(this.recoveryLevel);
                    this.flipsCompleted = 0;
                    
                    console.log(`üîÑ Moving to Level ${this.recoveryLevel}`);
                    updateStatus(`üîÑ LEVEL ${this.recoveryLevel} RECOVERY`, "#F59E0B");
                    
                    return { complete: false, levelComplete: true };
                }
                
                return this.finalizeRecovery(true);
                
            } else {
                console.log(`‚ùå Flip Recovery Level ${this.recoveryLevel} Failed`);
                
                if (this.recoveryLevel < this.maxLevels) {
                    this.recoveryLevel++;
                    this.sequence = this.getInitialSequence(this.recoveryLevel);
                    this.flipsCompleted = 0;
                    this.pattern = [];
                    
                    console.log(`üîÑ Trying Level ${this.recoveryLevel}`);
                    updateStatus(`üîÑ LEVEL ${this.recoveryLevel} RECOVERY`, "#F59E0B");
                    
                    return { complete: false, levelComplete: true };
                }
                
                return this.finalizeRecovery(false);
            }
        },
        
        finalizeRecovery(success) {
            this.isActive = false;
            const recoveryTime = Date.now() - this.startTime;
            this.stats.totalTime += recoveryTime;
            
            if (success) {
                this.stats.successfulRecoveries++;
                this.stats.totalRecovered += Math.abs(this.originalProfit);
                
                console.log(`‚úÖ Flip Recovery Complete in ${(recoveryTime/1000).toFixed(1)}s`);
                
                setTimeout(() => {
                    rotateMode("WAGER");
                    updateStatus("‚ö° BACK TO WAGER MODE", "#8B5CF6");
                    updateLogs(0, 0, "RECOVERY", 0, 
                        `Recovery complete ‚Üí WAGER mode (${(recoveryTime/1000).toFixed(1)}s)`);
                }, 1000);
                
            } else {
                this.stats.failedRecoveries++;
                
                console.log(`‚ùå Flip Recovery Failed after ${this.flipsCompleted} flips`);
                
                setTimeout(() => {
                    rotateMode("BASE");
                    updateStatus("üîÑ BACK TO BASE MODE", "#6366F1");
                    updateLogs(0, 0, "RECOVERY", 0, 
                        `Recovery failed ‚Üí BASE mode (${this.flipsCompleted} flips)`);
                }, 2000);
            }
            
            return { complete: true, success: success };
        },
        
        forceSide(side) {
            if (!this.isActive) return false;
            
            const oldSide = this.currentSide;
            this.currentSide = side;
            this.sideMode = "manual";
            
            console.log(`üîÑ Manual side change: ${oldSide} ‚Üí ${side}`);
            updateStatus(`üîÑ FORCED ${side.toUpperCase()}`, "#F59E0B");
            
            return true;
        },
        
        addProfitToHistory(profit) {
            this.profitHistory.push({
                time: Date.now(),
                profit: profit,
                sequence: [...this.sequence],
                side: this.currentSide
            });
            
            const thirtyMinutesAgo = Date.now() - (30 * 60 * 1000);
            this.profitHistory = this.profitHistory.filter(h => h.time > thirtyMinutesAgo);
        },
        
        getProgress() {
            if (!this.isActive) return 0;
            
            const initialLength = this.getInitialSequence(this.recoveryLevel).length;
            const currentReduction = initialLength - this.sequence.length;
            return Math.min(100, (currentReduction / initialLength) * 100);
        },
        
        getStats() {
            const successRate = this.stats.totalRecoveries > 0 ?
                (this.stats.successfulRecoveries / this.stats.totalRecoveries * 100) : 0;
            
            const avgTime = this.stats.totalRecoveries > 0 ?
                (this.stats.totalTime / this.stats.totalRecoveries / 1000) : 0;
            
            return {
                successRate: successRate.toFixed(1),
                totalRecoveries: this.stats.totalRecoveries,
                successful: this.stats.successfulRecoveries,
                failed: this.stats.failedRecoveries,
                totalRecovered: this.stats.totalRecovered.toFixed(8),
                avgTime: avgTime.toFixed(1)
            };
        },
        
        getPatternEmoji() {
            if (this.pattern.length === 0) return "‚¨ú‚¨ú‚¨ú‚¨ú‚¨ú‚¨ú‚¨ú‚¨ú‚¨ú‚¨ú";
            
            const emojis = this.pattern.slice(0, 10).map(p => 
                p.win ? "‚úÖ" : "‚ùå"
            );
            
            while (emojis.length < 10) {
                emojis.push("‚¨ú");
            }
            
            return emojis.join("");
        },
        
        getLevelDescription() {
            switch(this.recoveryLevel) {
                case 1: return "Standard Labouchre [1,2,3]";
                case 2: return "Conservative [1,1,1]";
                case 3: return "Very Conservative [1]";
                default: return `Level ${this.recoveryLevel}`;
            }
        }
    };

    // ==================== BOT ENGINE ====================
    const bot = {
        isRunning: false,
        isPaused: false,
        mode: "BASE",
        currentGame: "DICE",
        token: null,
        stakeUser: "Loading...",
        startTime: null,
        stopTime: null,
        lastRotationTime: null,
        
        stats: {
            profit: 0,
            wagered: 0,
            startBal: 0,
            currentBal: 0,
            bets: 0,
            wins: 0,
            loss: 0,
            
            sessionProfit: 0,
            sessionWagered: 0,
            sessionBets: 0,
            sessionStartBal: 0,
            
            maxDD: 0,
            maxDDPercent: 0,
            peakBalance: 0,
            
            biggestWin: 0,
            biggestLoss: 0,
            biggestBet: 0,
            
            currentWinStreak: 0,
            currentLossStreak: 0,
            longestWinStreak: 0,
            longestLossStreak: 0,
            
            winRate: 0,
            roi: 0,
            profitPerBet: 0
        },
        
        selectedCurrency: localStorage.getItem('orion_last_coin') || "usdt",
        nextBet: 0,
        currentChance: 0,
        currentMulti: 0,
        
        wgr: {
            ctwin: 0,
            balhigh: 0,
            profitc: 0,
            betload: 0
        },
        
        base: {
            ls: 0,
            lc: 0,
            bcount: 0,
            partialProfit: 0
        },
        
        session: {
            maxSessions: 20,
            currentSession: 1,
            sessionHistory: [],
            sessionStartTime: null,
            sessionTargetAbs: 0
        },
        
        lastReportTime: 0,
        lastChartUpdate: 0,
        
        licenseTier: "PREMIUM",
        supportContact: CONFIG.supportContact
    };

    // ==================== QUICK PRESETS ====================
    const QuickPresets = {
        CONSERVATIVE: {
            name: "üõ°Ô∏è CONSERVATIVE",
            description: "Low risk, steady profit",
            settings: {
                "p-basebet": 0.00000050,
                "p-bch-min": 85.0,
                "p-bch-max": 90.0,
                "p-hch-min": 25.0,
                "p-hch-max": 35.0,
                "p-wgr-chance": 99.5,
                "p-wgr-div": 150,
                "p-stoploss-pct": 3.0,
                "p-session-target": 0.1,
                "p-session-stoploss": 0.05,
                "p-recovery-threshold": -2.0,
                "p-flip-basebet": 0.00000050,
                "p-flip-max-sequence": 12,
                "p-flip-side-mode": "auto"
            }
        },
        
        BALANCED: {
            name: "‚öñÔ∏è BALANCED",
            description: "Optimal risk/reward",
            settings: {
                "p-basebet": 0.00000100,
                "p-bch-min": 80.0,
                "p-bch-max": 85.0,
                "p-hch-min": 20.0,
                "p-hch-max": 30.0,
                "p-wgr-chance": 99.0,
                "p-wgr-div": 100,
                "p-stoploss-pct": 5.0,
                "p-session-target": 0.2,
                "p-session-stoploss": 0.1,
                "p-recovery-threshold": -2.0,
                "p-flip-basebet": 0.00000100,
                "p-flip-max-sequence": 15,
                "p-flip-side-mode": "auto"
            }
        },
        
        AGGRESSIVE: {
            name: "‚ö° AGGRESSIVE",
            description: "High risk, high reward",
            settings: {
                "p-basebet": 0.00000200,
                "p-bch-min": 75.0,
                "p-bch-max": 80.0,
                "p-hch-min": 15.0,
                "p-hch-max": 25.0,
                "p-wgr-chance": 98.5,
                "p-wgr-div": 70,
                "p-stoploss-pct": 8.0,
                "p-session-target": 0.3,
                "p-session-stoploss": 0.15,
                "p-recovery-threshold": -2.0,
                "p-flip-basebet": 0.00000200,
                "p-flip-max-sequence": 18,
                "p-flip-side-mode": "manual"
            }
        }
    };

    // ==================== API FUNCTIONS ====================
    const API = {
        async syncOnce() {
            bot.token = localStorage.getItem('apitoken') || 
                       (document.cookie.match(/session=([^;]+)/) ? 
                        document.cookie.match(/session=([^;]+)/)[1] : null);
            try {
                const res = await fetch(`${CONFIG.apiUrl}/graphql`, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                        "x-access-token": bot.token
                    },
                    body: JSON.stringify({
                        query: `query{user{name balances{available{amount currency}}}}`
                    })
                });
                const json = await res.json();
                if (json?.data?.user) {
                    bot.stakeUser = json.data.user.name;
                    const bals = json.data.user.balances || [];
                    const sel = document.getElementById("p-currency");
                    
                    if (sel) {
                        const currentSelected = sel.value || bot.selectedCurrency;
                        sel.innerHTML = "";

                        bals.forEach(b => {
                            const opt = new Option(
                                `${b.available.currency.toUpperCase()} (${parseFloat(b.available.amount).toFixed(2)})`,
                                b.available.currency
                            );
                            if(b.available.currency === currentSelected) opt.selected = true;
                            sel.add(opt);
                        });
                        bot.selectedCurrency = sel.value;
                    }
                    
                    await updateBalanceDisplay();
                }
            } catch (e) {
                console.error("Sync Error:", e);
            }
        },

        async getBalance(coin) {
            try {
                const res = await fetch(`${CONFIG.apiUrl}/graphql`, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                        "x-access-token": bot.token
                    },
                    body: JSON.stringify({
                        query: `query{user{balances{available{amount currency}}}}`
                    })
                });
                const json = await res.json();
                const active = json.data.user.balances.find(
                    b => b.available.currency.toLowerCase() === coin.toLowerCase()
                );
                return active ? parseFloat(active.available.amount) : 0;
            } catch (e) {
                console.error("Balance Error:", e);
                return 0;
            }
        },

        async placeBet(gameType, params) {
            let endpoint;
            let payload;
            
            if (gameType === "DICE") {
                endpoint = "/casino/dice/roll";
                payload = {
                    amount: parseFloat(params.amount.toFixed(8)),
                    currency: bot.selectedCurrency,
                    target: (100 - params.chance).toFixed(1),
                    condition: "above",
                    identifier: Math.random().toString(36).slice(2) + Date.now()
                };
            } else if (gameType === "FLIP") {
                endpoint = "/_api/graphql";
                payload = {
                    query: `mutation FlipNext($condition: FlipConditionEnum!) {
                        flipNext(condition: $condition) {
                            id
                            active
                            payoutMultiplier
                            amountMultiplier
                            amount
                            payout
                            updatedAt
                            currency
                            game
                            user {
                                id
                                name
                            }
                            state {
                                currentRound
                                payoutMultiplier
                                playedRounds
                                flips
                            }
                        }
                    }`,
                    variables: {
                        condition: params.side
                    }
                };
            }
            
            try {
                const headers = {
                    "Content-Type": "application/json",
                    "x-access-token": bot.token
                };
                
                if (gameType === "FLIP") {
                    headers["x-lockdown-token"] = "s5MNWtjTM5TvCMkAzxov";
                }
                
                const r = await fetch(`${CONFIG.apiUrl}${endpoint}`, {
                    method: "POST",
                    headers: headers,
                    body: JSON.stringify(payload)
                });
                const result = await r.json();
                return result;
            } catch (error) {
                console.error(`${gameType} Bet Error:`, error);
                throw error;
            }
        }
    };

    // ==================== TELEGRAM REPORT ====================
    async function sendTelegramReport(reason) {
        try {
            const now = Date.now();
            if (reason === "auto" && now - bot.lastReportTime < 300000) {
                return;
            }
            
            bot.lastReportTime = now;
            
            const runningTime = getRunningTime();
            const sessionProfitPct = bot.stats.sessionStartBal > 0 ?
                (bot.stats.sessionProfit / bot.stats.sessionStartBal * 100) : 0;
            
            const winRate = bot.stats.bets > 0 ? 
                (bot.stats.wins / bot.stats.bets * 100) : 0;
            
            let header = "";
            let emoji = "üìä";
            
            switch(reason) {
                case "load": header = "BOT LOADED"; emoji = "üì±"; break;
                case "start": header = "BOT STARTED"; emoji = "‚ñ∂Ô∏è"; break;
                case "stop": header = "BOT STOPPED"; emoji = "üõë"; break;
                case "target": header = "SESSION TARGET"; emoji = "üéØ"; break;
                case "stoploss": header = "STOP LOSS HIT"; emoji = "‚õî"; break;
                case "flip_recovery_start": header = "FLIP RECOVERY STARTED"; emoji = "üîÑ"; break;
                case "flip_recovery_update": header = "FLIP RECOVERY UPDATE"; emoji = "üìà"; break;
                case "flip_recovery_complete": header = "FLIP RECOVERY COMPLETE"; emoji = "‚úÖ"; break;
                case "mode_switch": header = "MODE SWITCHED"; emoji = "üîÑ"; break;
                default: header = "REGULAR REPORT"; emoji = "üìä";
            }
            
            const caption = `
${emoji} <b>ORION PRO ${header}</b>
User: ${bot.stakeUser} | ‚ö° ${bot.currentGame === 'FLIP' ? 'FLIP RECOVERY' : bot.mode}
${FlipRecovery.isActive ? `Range: Labouchre ${FlipRecovery.getLevelDescription()}` : `Range: ${getVal("p-bch-min")}-${getVal("p-bch-max")}%`}
Refresh: 5m
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
üí∞ <b>FINANCIALS</b>
‚îú Bal: ${bot.stats.currentBal.toFixed(8)}
‚îú PnL: ${bot.stats.sessionProfit >= 0 ? '+' : ''}${bot.stats.sessionProfit.toFixed(8)} (${sessionProfitPct.toFixed(2)}%)
‚îú Wgr: ${bot.stats.sessionWagered.toFixed(8)}
‚îî Est: ${calculateHourlyEstimate().toFixed(8)} / hr

üìâ <b>RISK STATS</b>
‚îú DD: ${sessionProfitPct < 0 ? Math.abs(sessionProfitPct).toFixed(2) : '0.00'}% (Max: ${bot.stats.maxDDPercent.toFixed(2)}%)
‚îú Streak: ${bot.stats.currentLossStreak}L / ${bot.stats.currentWinStreak}W
‚îî ${FlipRecovery.isActive ? `Rec Progress: ${FlipRecovery.getProgress().toFixed(1)}%` : `Tax Debt: 0.000000`}

üé≤ <b>PERFORMANCE</b>
‚îú Speed: ${calculateBetsPerSecond().toFixed(1)} b/s
‚îú WinRate: ${winRate.toFixed(1)}%
‚îî ${FlipRecovery.isActive ? FlipRecovery.getPatternEmoji() : getWinLossEmojiChart()}
‚è± ${runningTime}
${FlipRecovery.isActive ? `\nüîÑ <b>FLIP RECOVERY</b>\n‚îú Level: ${FlipRecovery.recoveryLevel}/3\n‚îú Sequence: [${FlipRecovery.sequence.join(',')}]\n‚îú Side: ${FlipRecovery.currentSide.toUpperCase()}\n‚îî Flips: ${FlipRecovery.flipsCompleted}\n` : ''}
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
üí¨ <b>Support:</b> ${CONFIG.supportContact}
‚ö° <b>Version:</b> ${CONFIG.version}
            `;
            
            const messageUrl = `https://api.telegram.org/bot${CONFIG.tgToken}/sendMessage`;
            await fetch(messageUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    chat_id: CONFIG.tgChatId,
                    text: caption,
                    parse_mode: 'HTML',
                    disable_web_page_preview: true
                })
            });
            
            console.log(`${emoji} Telegram report sent (${reason})`);
            
        } catch (error) {
            console.error('Telegram report error:', error);
        }
    }

    function getWinLossEmojiChart() {
        const logs = window.performanceLogs || [];
        const last10 = logs.slice(0, 10).map(log => 
            log.profit >= 0 ? 'üü©' : 'üü•'
        );
        
        while (last10.length < 10) {
            last10.push('‚¨ú');
        }
        
        return last10.join('');
    }

    function calculateHourlyEstimate() {
        if (!bot.startTime || bot.stats.bets === 0) return 0;
        const hours = (Date.now() - bot.startTime) / 3600000;
        return hours > 0 ? bot.stats.profit / hours : 0;
    }

    function calculateBetsPerSecond() {
        if (!bot.startTime || bot.stats.bets === 0) return 0;
        const seconds = (Date.now() - bot.startTime) / 1000;
        return seconds > 0 ? bot.stats.bets / seconds : 0;
    }

    // ==================== UTILITY FUNCTIONS ====================
    function getVal(id) {
        try {
            let el = document.getElementById(id);
            
            if (!el && id.includes('-')) {
                const mobileId = id + '-mobile';
                el = document.getElementById(mobileId);
            }
            
            if (!el) {
                const defaults = {
                    "p-minbet": 0.00000001,
                    "p-basebet": 0.00000100,
                    "p-multi-start": 1.45,
                    "p-multi-inc": 0.05,
                    "p-bch-min": 80.0,
                    "p-bch-max": 95.0,
                    "p-hch-min": 20.0,
                    "p-hch-max": 30.0,
                    "p-wgr-chance": 99.0,
                    "p-wgr-div": 100,
                    "p-stoploss-pct": 5.0,
                    "p-session-target": 0.2,
                    "p-session-stoploss": 0.1,
                    "p-max-sessions": 20,
                    "p-recovery-threshold": -2.0,
                    "p-flip-basebet": 0.00000100,
                    "p-flip-max-sequence": 15,
                    "p-flip-side-mode": "auto",
                    "p-flip-manual-side": "heads"
                };
                return defaults[id] || 0;
            }
            
            if (el.type === 'checkbox') {
                return el.checked ? 1 : 0;
            }
            
            if (el.tagName === 'SELECT') {
                return el.value;
            }
            
            return parseFloat(el.value) || 0;
        } catch (e) {
            console.error(`Error getting value for ${id}:`, e);
            return 0;
        }
    }

    async function updateBalanceDisplay() {
        if (bot.isRunning) return;
        const balance = await API.getBalance(bot.selectedCurrency);
        bot.stats.currentBal = balance;
        if (bot.stats.startBal === 0) {
            bot.stats.startBal = balance;
        }
    }

    function updateStatsSync(betData, win, profit) {
        const betTime = Date.now();
        
        bot.stats.bets++;
        bot.stats.sessionBets++;
        bot.stats.wagered += betData.amount;
        bot.stats.sessionWagered += betData.amount;
        bot.stats.profit += profit;
        bot.stats.sessionProfit += profit;
        bot.stats.currentBal += profit;
        
        if (win) {
            bot.stats.wins++;
            bot.stats.currentWinStreak++;
            bot.stats.currentLossStreak = 0;
            
            if (bot.stats.currentWinStreak > bot.stats.longestWinStreak) {
                bot.stats.longestWinStreak = bot.stats.currentWinStreak;
            }
            
            if (profit > bot.stats.biggestWin) {
                bot.stats.biggestWin = profit;
            }
        } else {
            bot.stats.loss++;
            bot.stats.currentLossStreak++;
            bot.stats.currentWinStreak = 0;
            
            if (bot.stats.currentLossStreak > bot.stats.longestLossStreak) {
                bot.stats.longestLossStreak = bot.stats.currentLossStreak;
            }
            
            if (Math.abs(profit) > Math.abs(bot.stats.biggestLoss)) {
                bot.stats.biggestLoss = profit;
            }
        }
        
        if (betData.amount > bot.stats.biggestBet) {
            bot.stats.biggestBet = betData.amount;
        }
        
        if (bot.stats.currentBal > bot.stats.peakBalance) {
            bot.stats.peakBalance = bot.stats.currentBal;
        }
        
        const drawdown = bot.stats.peakBalance - bot.stats.currentBal;
        if (drawdown > bot.stats.maxDD) {
            bot.stats.maxDD = drawdown;
            bot.stats.maxDDPercent = (drawdown / bot.stats.peakBalance) * 100;
        }
        
        bot.stats.winRate = bot.stats.bets > 0 ? 
            (bot.stats.wins / bot.stats.bets * 100) : 0;
        bot.stats.profitPerBet = bot.stats.bets > 0 ? 
            (bot.stats.profit / bot.stats.bets) : 0;
        bot.stats.roi = bot.stats.wagered > 0 ? 
            (bot.stats.profit / bot.stats.wagered * 100) : 0;
    }

    // ==================== RECOVERY TRIGGER SYSTEM ====================
    function checkRecoveryTrigger() {
        if (FlipRecovery.isActive || bot.currentGame !== "DICE") return;
        
        const sessionProfitPct = (bot.stats.sessionProfit / bot.stats.sessionStartBal) * 100;
        const recoveryThreshold = getVal("p-recovery-threshold") || -2.0;
        
        if (sessionProfitPct <= recoveryThreshold) {
            console.log(`üîÑ Triggering Flip Recovery at ${sessionProfitPct.toFixed(2)}% loss`);
            
            FlipRecovery.initialize(
                bot.mode,
                bot.stats.sessionProfit
            );
            
            bot.currentGame = "FLIP";
            bot.nextBet = FlipRecovery.getNextBet();
            
            updateStatus(`üîÑ FLIP RECOVERY STARTED (L${FlipRecovery.recoveryLevel})`, "#F59E0B");
            updateLogs(0, 0, "RECOVERY", 0, 
                `Flip recovery started at ${sessionProfitPct.toFixed(2)}% loss - Side: ${FlipRecovery.currentSide}`);
            
            sendTelegramReport("flip_recovery_start");
            
            return true;
        }
        
        return false;
    }

    // ==================== ROTATION MANAGEMENT ====================
    function rotateMode(newMode) {
        const oldMode = bot.mode;
        bot.mode = newMode;
        
        if (newMode === "BASE") {
            rotateToBaseMode();
        } else if (newMode === "WAGER") {
            rotateToWagerMode();
        }
        
        updateStatus(`üîÑ ${oldMode} ‚Üí ${newMode}`, "#9CA3AF");
        updateLogs(0, 0, "ROTATION", 0, `${oldMode} ‚Üí ${newMode}`);
        
        sendTelegramReport("mode_switch");
        
        console.log(`üîÑ Mode rotated: ${oldMode} ‚Üí ${newMode}`);
    }

    function rotateToBaseMode() {
        bot.currentChance = Math.random() * (getVal("p-bch-max") - getVal("p-bch-min")) + getVal("p-bch-min");
        bot.nextBet = getVal("p-basebet");
        bot.currentMulti = getVal("p-multi-start");
        bot.base.ls = 0;
        bot.base.lc = 0;
        bot.base.partialProfit = 0;
        bot.base.bcount = 0;
        
        console.log("üîÑ Rotated to BASE mode");
    }

    function rotateToWagerMode() {
        bot.currentChance = getVal("p-wgr-chance");
        bot.nextBet = bot.stats.currentBal / getVal("p-wgr-div");
        bot.wgr.balhigh = bot.stats.currentBal;
        bot.wgr.profitc = 0;
        bot.wgr.ctwin = 0;
        bot.wgr.betload = 0;
        
        console.log("üîÑ Rotated to WAGER mode");
    }

    // ==================== GAME FUNCTIONS ====================
    function handleBaseMode(win) {
        if (win) {
            bot.base.ls = 0;
            bot.base.lc = 0;
            bot.base.partialProfit = 0;
            bot.currentChance = Math.random() * (getVal("p-bch-max") - getVal("p-bch-min")) + getVal("p-bch-min");
            bot.nextBet = getVal("p-basebet");
            bot.currentMulti = getVal("p-multi-start");
        } else {
            bot.base.ls++;
            bot.base.lc++;
            
            if (bot.base.ls === 1 || bot.base.lc > bot.base.bcount) {
                if (bot.base.ls > 1) bot.currentMulti += getVal("p-multi-inc");
                bot.base.lc = 1;
                bot.currentChance = Math.random() * (getVal("p-hch-max") - getVal("p-hch-min")) + getVal("p-hch-min");
                bot.base.bcount = Math.ceil(99 / bot.currentChance);
            }
            bot.nextBet = (Math.abs(bot.base.partialProfit) / ((99/bot.currentChance) - 1)) * bot.currentMulti;
        }
    }

    function handleWagerMode(win) {
        if (win) {
            bot.wgr.ctwin++;
            
            if (bot.wgr.ctwin > 10) {
                bot.wgr.ctwin = 0;
                const recoveryChance = Math.random() * (30 - 20) + 20;
                bot.currentChance = recoveryChance;
                bot.nextBet = Math.max(0, bot.wgr.betload) / ((99 / bot.currentChance) - 1);
            } else {
                bot.currentChance = getVal("p-wgr-chance");
                bot.nextBet = bot.stats.currentBal / getVal("p-wgr-div");
            }
            
            if (bot.stats.currentBal > bot.wgr.balhigh) {
                bot.wgr.balhigh = bot.stats.currentBal;
            }
        } else {
            bot.wgr.profitc += (bot.stats.currentBal - bot.wgr.balhigh);
            bot.wgr.betload = bot.wgr.balhigh - bot.stats.currentBal;
            
            if (bot.currentChance < 80) {
                bot.nextBet = Math.abs(bot.wgr.betload) / ((99 / bot.currentChance) - 1);
            } else {
                bot.nextBet *= 1.12;
            }
        }
    }

    // ==================== MAIN BOT LOOP ====================
    async function runLoop() {
        if (!bot.isRunning || bot.isPaused) return;
        
        // Check stop loss
        const stopLossPct = getVal("p-stoploss-pct");
        const currentProfitPct = bot.stats.profit / bot.stats.startBal * 100;
        
        if (currentProfitPct <= -stopLossPct) {
            await stopEngine();
            updateStatus("‚õî GLOBAL STOP LOSS", "#EF4444");
            await sendTelegramReport("stoploss");
            return;
        }
        
        // Check recovery trigger
        if (bot.stats.bets % 10 === 0) {
            checkRecoveryTrigger();
        }
        
        try {
            // FLIP RECOVERY MODE
            if (FlipRecovery.isActive) {
                if (FlipRecovery.shouldStop(bot.stats.sessionProfit)) {
                    const result = FlipRecovery.finalizeRecovery(true);
                    if (result.complete) {
                        setTimeout(runLoop, 1000);
                        return;
                    }
                }
                
                const result = await API.placeBet("FLIP", {
                    amount: FlipRecovery.getNextBet(),
                    side: FlipRecovery.currentSide
                });
                
                const flip = result?.data?.flipNext || result?.flipNext;
                if (flip) {
                    const win = flip.payout > 0;
                    const profit = flip.payout - flip.amount;
                    
                    updateStatsSync(flip, win, profit);
                    updateLogs(flip.amount, 50, `FLIP (${FlipRecovery.currentSide.toUpperCase()})`, profit);
                    
                    const recoveryResult = FlipRecovery.handleResult(win);
                    
                    if (recoveryResult.complete) {
                        setTimeout(runLoop, 1000);
                        return;
                    }
                    
                    bot.nextBet = FlipRecovery.getNextBet();
                    
                    updateFlipRecoveryUI();
                    
                    if (FlipRecovery.flipsCompleted % 5 === 0) {
                        sendTelegramReport("flip_recovery_update");
                    }
                }
                
                setTimeout(runLoop, 1000);
                return;
            }
            
            // REGULAR DICE MODE
            const result = await API.placeBet("DICE", {
                amount: bot.nextBet,
                chance: bot.currentChance
            });
            
            const dice = result?.data?.diceRoll || result?.diceRoll;
            if (dice) {
                const win = dice.payout > 0;
                const profit = dice.payout - dice.amount;
                
                updateStatsSync(dice, win, profit);
                updateLogs(dice.amount, bot.currentChance, bot.mode, profit);
                
                if (bot.mode === "BASE") {
                    handleBaseMode(win);
                } else if (bot.mode === "WAGER") {
                    handleWagerMode(win);
                }
                
                const minBet = getVal("p-minbet");
                bot.nextBet = Math.max(bot.nextBet, minBet);
                
                if (bot.stats.bets % 5 === 0) {
                    updateCompleteStatistics();
                }
                
                if (Date.now() - bot.lastReportTime >= 300000) {
                    sendTelegramReport("auto");
                }
            }
            
            setTimeout(runLoop, 0);
            
        } catch (e) {
            console.error("Loop error:", e);
            setTimeout(runLoop, 100);
        }
    }

    async function stopEngine() {
        bot.isRunning = false;
        bot.stopTime = Date.now();
        await updateBalanceDisplay();
    }

    async function startBot() {
        const currencySelect = document.getElementById("p-currency");
        if (currencySelect) {
            bot.selectedCurrency = currencySelect.value;
            localStorage.setItem('orion_last_coin', bot.selectedCurrency);
        }
        
        await API.syncOnce();
        
        bot.session.maxSessions = getVal("p-max-sessions");
        bot.session.currentSession = 1;
        
        bot.stats.startBal = await API.getBalance(bot.selectedCurrency);
        bot.stats.currentBal = bot.stats.startBal;
        bot.stats.sessionStartBal = bot.stats.startBal;
        
        bot.stats.sessionProfit = 0;
        bot.stats.sessionWagered = 0;
        bot.stats.sessionBets = 0;
        bot.stats.profit = 0;
        bot.stats.wagered = 0;
        bot.stats.bets = 0;
        bot.stats.wins = 0;
        bot.stats.loss = 0;
        bot.stats.maxDD = 0;
        bot.stats.maxDDPercent = 0;
        bot.stats.peakBalance = bot.stats.startBal;
        
        const sessionTargetPct = getVal("p-session-target");
        bot.session.sessionTargetAbs = bot.stats.sessionStartBal * (sessionTargetPct / 100);
        
        bot.isRunning = true;
        bot.isPaused = false;
        bot.startTime = Date.now();
        bot.stopTime = null;
        bot.lastReportTime = Date.now();
        bot.lastChartUpdate = Date.now();
        
        bot.session.sessionHistory = [];
        bot.session.sessionStartTime = Date.now();
        
        bot.wgr.balhigh = bot.stats.startBal;
        bot.wgr.profitc = 0;
        bot.wgr.ctwin = 0;
        bot.wgr.betload = 0;
        
        rotateToBaseMode();
        
        const logBody = document.getElementById("p-log-body");
        if (logBody) logBody.innerHTML = "";
        
        updateLogs(0, 0, "SESSION", 0, `Session ${bot.session.currentSession} started - Target: ${sessionTargetPct}%`);
        updateStatus("‚ö° RUNNING", "#10B981");
        
        await sendTelegramReport("start");
        runLoop();
    }

    // ==================== UI FUNCTIONS ====================
    function updateStatus(text, color) {
        const el = document.getElementById("st-status-text");
        if (el) {
            el.innerText = text;
            el.style.color = color || "#9CA3AF";
        }
    }

    function updateLogs(amt, ch, mode, pft, customText = "") {
        const logBox = document.getElementById("p-log-body");
        if (!logBox) return;
        
        const modeColors = {
            'WAGER': '#8B5CF6',
            'BASE': '#6366F1',
            'FLIP': '#F59E0B',
            'RECOVERY': '#F59E0B',
            'SESSION': '#6366F1',
            'ROTATION': '#9CA3AF'
        };
        
        const row = document.createElement("div");
        
        if (customText) {
            row.style.cssText = `padding: 8px 12px; margin: 4px 0; background: rgba(55, 65, 81, 0.3); border-radius: 8px; border-left: 3px solid ${modeColors[mode] || '#6366F1'}; font-size: 11px; color: #E5E7EB;`;
            row.innerHTML = `<div style="display: flex; align-items: center; gap: 8px;"><span style="color: ${modeColors[mode] || '#6366F1'}">${mode}</span><span>${customText}</span></div>`;
        } else {
            row.style.cssText = `display:grid; grid-template-columns:1.2fr 1fr 0.8fr 1.2fr; font-size:11px; border-bottom:1px solid rgba(255,255,255,0.05); padding:8px 0; color:${pft >= 0 ? '#10B981' : '#EF4444'}; text-align:center;`;
            row.innerHTML = `
                <span>${amt.toFixed(5)}</span>
                <span>${ch.toFixed(1)}%</span>
                <span style="color:${modeColors[mode] || '#6366F1'}">${mode}</span>
                <span>${pft.toFixed(5)}</span>
            `;
        }
        
        logBox.prepend(row);
        if (logBox.children.length > 15) logBox.removeChild(logBox.lastChild);
    }

    function getRunningTime() {
        if (!bot.startTime) return "00:00:00";
        const now = Date.now();
        const diff = now - bot.startTime;
        
        const hours = Math.floor(diff / 3600000);
        const minutes = Math.floor((diff % 3600000) / 60000);
        const seconds = Math.floor((diff % 60000) / 1000);
        
        return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
    }

    function updateFlipRecoveryUI() {
        if (!FlipRecovery.isActive) return;
        
        const elements = {
            'flip-sequence': `[${FlipRecovery.sequence.join(',')}]`,
            'flip-nextbet': FlipRecovery.getNextBet().toFixed(8),
            'flip-side': FlipRecovery.currentSide.toUpperCase(),
            'flip-pattern': FlipRecovery.getPatternEmoji(),
            'flip-progress': FlipRecovery.getProgress().toFixed(1) + '%',
            'flip-level': FlipRecovery.recoveryLevel,
            'flip-flips': FlipRecovery.flipsCompleted,
            'flip-level-desc': FlipRecovery.getLevelDescription()
        };
        
        for (const [id, value] of Object.entries(elements)) {
            const el = document.getElementById(id);
            if (el) el.textContent = value;
        }
        
        const progressBar = document.getElementById('flip-recovery-bar');
        if (progressBar) {
            progressBar.style.width = FlipRecovery.getProgress() + '%';
        }
        
        for (let i = 1; i <= 3; i++) {
            const badge = document.getElementById(`level-badge-${i}`);
            if (badge) {
                badge.className = `level-badge ${FlipRecovery.recoveryLevel === i ? 'active' : ''}`;
            }
        }
    }

    function updateCompleteStatistics() {
        const statsEl = document.getElementById("complete-statistics");
        if (!statsEl) return;
        
        const winRate = bot.stats.bets > 0 ? ((bot.stats.wins / bot.stats.bets) * 100) : 0;
        const roi = bot.stats.wagered > 0 ? (bot.stats.profit / bot.stats.wagered * 100) : 0;
        const profitPerBet = bot.stats.bets > 0 ? (bot.stats.profit / bot.stats.bets) : 0;
        const sessionProfitPct = bot.stats.sessionStartBal > 0 ? 
            (bot.stats.sessionProfit / bot.stats.sessionStartBal * 100) : 0;
        
        statsEl.innerHTML = `
            <div class="clean-stats">
                <div class="stat-row">
                    <div class="stat-item">
                        <div class="stat-label">üí∞ Balance Start</div>
                        <div class="stat-value">${bot.stats.startBal.toFixed(8)}</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">üíµ Balance Now</div>
                        <div class="stat-value ${bot.stats.currentBal >= bot.stats.startBal ? 'text-success' : 'text-danger'}">
                            ${bot.stats.currentBal.toFixed(8)}
                        </div>
                    </div>
                </div>
                
                <div class="stat-row">
                    <div class="stat-item">
                        <div class="stat-label">üìà Total Profit</div>
                        <div class="stat-value ${bot.stats.profit >= 0 ? 'text-success' : 'text-danger'}">
                            ${bot.stats.profit >= 0 ? '+' : ''}${bot.stats.profit.toFixed(8)}
                        </div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">üéØ Session Profit</div>
                        <div class="stat-value ${bot.stats.sessionProfit >= 0 ? 'text-success' : 'text-danger'}">
                            ${bot.stats.sessionProfit >= 0 ? '+' : ''}${bot.stats.sessionProfit.toFixed(8)}
                        </div>
                    </div>
                </div>
                
                <div class="stat-row">
                    <div class="stat-item">
                        <div class="stat-label">üéÆ Bets</div>
                        <div class="stat-value">${bot.stats.bets} (${bot.stats.wins}/${bot.stats.loss})</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">üìä Win Rate</div>
                        <div class="stat-value ${winRate >= 50 ? 'text-success' : 'text-danger'}">${winRate.toFixed(1)}%</div>
                    </div>
                </div>
                
                ${FlipRecovery.isActive ? `
                <div class="stat-row">
                    <div class="stat-item">
                        <div class="stat-label">üîÑ Recovery Level</div>
                        <div class="stat-value text-warning">${FlipRecovery.recoveryLevel}/3</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">üìä Recovery Progress</div>
                        <div class="stat-value">${FlipRecovery.getProgress().toFixed(1)}%</div>
                    </div>
                </div>
                ` : ''}
            </div>
        `;
    }

    // ==================== PRESET FUNCTIONS ====================
    function applyPreset(presetName) {
        const preset = QuickPresets[presetName];
        if (!preset) return;
        
        for (const [key, value] of Object.entries(preset.settings)) {
            const el = document.getElementById(key);
            if (el) {
                if (el.type === 'checkbox') {
                    el.checked = Boolean(value);
                } else if (el.tagName === 'SELECT') {
                    el.value = value;
                    el.dispatchEvent(new Event('change'));
                } else {
                    el.value = value;
                }
            }
        }
        
        updateStatus(`‚úÖ ${preset.name} APPLIED`, "#10B981");
        updateLogs(0, 0, "PRESET", 0, `${preset.name} preset applied`);
        
        console.log(`‚úÖ ${preset.name} preset applied`);
    }

    // ==================== FLIP CONTROL FUNCTIONS ====================
    function forceFlipSide(side) {
        if (FlipRecovery.isActive) {
            FlipRecovery.forceSide(side);
            updateFlipRecoveryUI();
            updateStatus(`üîÑ FORCED ${side.toUpperCase()}`, "#F59E0B");
        }
    }

    function switchGame(game) {
        if (bot.isRunning && !FlipRecovery.isActive) {
            bot.currentGame = game;
            updateStatus(`üéÆ SWITCHED TO ${game}`, game === "FLIP" ? "#F59E0B" : "#6366F1");
            updateLogs(0, 0, "GAME", 0, `Switched to ${game}`);
        }
    }

    // ==================== UI CREATION ====================
    function createUI() {
        if (document.getElementById("orion-wrap")) {
            document.getElementById("orion-wrap").remove();
        }
        
        const s = document.createElement("style");
        s.innerHTML = `
            @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
            
            :root {
                --bg-primary: #0F1117;
                --bg-secondary: #1A1D28;
                --bg-tertiary: #242837;
                --accent-primary: #6366F1;
                --accent-secondary: #8B5CF6;
                --accent-success: #10B981;
                --accent-warning: #F59E0B;
                --accent-danger: #EF4444;
                --text-primary: #F3F4F6;
                --text-secondary: #9CA3AF;
                --text-muted: #6B7280;
                --border-color: #374151;
                --border-light: #4B5563;
                --gradient-primary: linear-gradient(135deg, #6366F1 0%, #8B5CF6 100%);
                --gradient-warning: linear-gradient(135deg, #F59E0B 0%, #FBBF24 100%);
                --gradient-danger: linear-gradient(135deg, #EF4444 0%, #F87171 100%);
                --font-size-xs: 12px;
                --font-size-sm: 14px;
                --font-size-md: 16px;
                --font-size-lg: 18px;
                --font-size-xl: 22px;
                --spacing-xs: 8px;
                --spacing-sm: 12px;
                --spacing-md: 16px;
                --spacing-lg: 20px;
                --spacing-xl: 24px;
            }
            
            #orion-wrap {
                position: fixed;
                background: var(--bg-primary);
                color: var(--text-primary);
                font-family: 'Inter', sans-serif;
                z-index: 9999;
                display: flex;
                flex-direction: column;
                border-radius: 20px;
                box-shadow: 0 25px 50px rgba(0,0,0,0.4);
                overflow: hidden;
                border: 1px solid var(--border-color);
            }
            
            /* Desktop Layout */
            @media (min-width: 769px) {
                #orion-wrap {
                    width: 600px;
                    height: 800px;
                    resize: both;
                    min-width: 550px;
                    min-height: 700px;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                }
                
                .orion-header {
                    padding: var(--spacing-lg);
                }
                
                .header-title {
                    font-size: var(--font-size-xl);
                }
                
                .btn {
                    padding: var(--spacing-md);
                    font-size: var(--font-size-md);
                    height: 56px;
                }
                
                input, select {
                    padding: 12px;
                    font-size: var(--font-size-md);
                    height: 44px;
                }
            }
            
            /* Mobile Layout */
            @media (max-width: 768px) {
                #orion-wrap {
                    width: 95vw;
                    height: 90vh;
                    bottom: 0;
                    left: 2.5vw;
                    top: auto;
                    resize: none;
                    border-radius: 16px 16px 0 0;
                }
                
                .orion-header {
                    padding: var(--spacing-md);
                }
                
                .header-title {
                    font-size: var(--font-size-lg);
                }
                
                .btn {
                    padding: var(--spacing-md);
                    font-size: var(--font-size-md);
                    height: 52px;
                }
                
                input, select {
                    padding: 12px;
                    font-size: var(--font-size-md);
                    height: 48px;
                }
                
                .mobile-nav {
                    position: sticky;
                    bottom: 0;
                    background: var(--bg-secondary);
                    border-top: 1px solid var(--border-color);
                    display: flex;
                    padding: 8px;
                    gap: 8px;
                    z-index: 100;
                }
                
                .nav-btn {
                    flex: 1;
                    padding: 12px;
                    background: var(--bg-tertiary);
                    border: 1px solid var(--border-color);
                    border-radius: 10px;
                    color: var(--text-primary);
                    font-size: 12px;
                    font-weight: 600;
                    display: flex;
                    flex-direction: column;
                    align-items: center;
                    gap: 4px;
                }
                
                .nav-btn.active {
                    background: var(--gradient-primary);
                    color: white;
                }
                
                .tab-content {
                    display: none;
                    padding: var(--spacing-md);
                    overflow-y: auto;
                    flex: 1;
                }
                
                .tab-content.active {
                    display: block;
                }
            }
            
            /* Common Styles */
            .orion-header {
                background: linear-gradient(145deg, var(--bg-secondary), var(--bg-primary));
                border-bottom: 1px solid var(--border-color);
                position: relative;
            }
            
            .orion-header::before {
                content: '';
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                height: 4px;
                background: var(--gradient-primary);
            }
            
            .header-main {
                display: flex;
                align-items: center;
                justify-content: space-between;
                margin-bottom: var(--spacing-md);
            }
            
            .license-badge {
                background: var(--gradient-primary);
                color: white;
                padding: var(--spacing-xs) var(--spacing-md);
                border-radius: 20px;
                font-size: var(--font-size-sm);
                font-weight: 700;
                letter-spacing: 0.5px;
            }
            
            .user-info-card {
                background: linear-gradient(145deg, var(--bg-tertiary), var(--bg-secondary));
                border-radius: 12px;
                padding: var(--spacing-md);
                border: 1px solid var(--border-color);
                display: flex;
                align-items: center;
                justify-content: space-between;
                margin-top: var(--spacing-xs);
            }
            
            .user-avatar {
                width: 48px;
                height: 48px;
                background: var(--gradient-primary);
                border-radius: 12px;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 24px;
                color: white;
            }
            
            .username {
                font-size: var(--font-size-md);
                font-weight: 600;
                color: var(--text-primary);
            }
            
            .expiry-date {
                font-size: var(--font-size-sm);
                color: var(--text-secondary);
                display: flex;
                align-items: center;
                gap: 4px;
            }
            
            .status-badge {
                display: inline-block;
                padding: 12px 24px;
                background: linear-gradient(145deg, var(--bg-tertiary), var(--bg-secondary));
                border: 1px solid var(--border-color);
                border-radius: 12px;
                font-size: var(--font-size-sm);
                font-weight: 600;
                color: var(--text-primary);
                margin-top: var(--spacing-sm);
                text-align: center;
                letter-spacing: 0.5px;
                width: 100%;
            }
            
            .running-time {
                background: linear-gradient(145deg, var(--bg-tertiary), var(--bg-secondary));
                padding: var(--spacing-sm) var(--spacing-lg);
                text-align: center;
                font-size: var(--font-size-sm);
                font-weight: 600;
                color: var(--accent-primary);
                letter-spacing: 0.5px;
                border-bottom: 1px solid var(--border-color);
            }
            
            .content-area {
                flex: 1;
                overflow-y: auto;
                padding: var(--spacing-lg);
            }
            
            .clean-stats {
                background: linear-gradient(145deg, var(--bg-secondary), var(--bg-tertiary));
                border-radius: 12px;
                padding: var(--spacing-md);
                border: 1px solid var(--border-color);
                margin-bottom: var(--spacing-md);
            }
            
            .stat-row {
                display: flex;
                justify-content: space-between;
                margin-bottom: var(--spacing-sm);
                padding-bottom: var(--spacing-sm);
                border-bottom: 1px solid var(--border-color);
            }
            
            .stat-item {
                flex: 1;
            }
            
            .stat-label {
                color: var(--text-secondary);
                margin-bottom: 4px;
                text-transform: uppercase;
                letter-spacing: 0.5px;
                font-size: var(--font-size-xs);
            }
            
            .stat-value {
                font-weight: 700;
                color: var(--text-primary);
                font-size: var(--font-size-sm);
            }
            
            .btn-primary {
                background: var(--gradient-primary);
                color: white;
            }
            
            .btn-warning {
                background: var(--gradient-warning);
                color: #1F2937;
            }
            
            .btn-danger {
                background: var(--gradient-danger);
                color: white;
            }
            
            .btn-secondary {
                background: linear-gradient(145deg, var(--bg-secondary), var(--bg-tertiary));
                color: var(--text-primary);
                border: 1px solid var(--border-color);
            }
            
            .btn:hover {
                transform: translateY(-2px);
                box-shadow: 0 8px 20px rgba(0,0,0,0.2);
            }
            
            .text-success { color: var(--accent-success) !important; }
            .text-warning { color: var(--accent-warning) !important; }
            .text-danger { color: var(--accent-danger) !important; }
            .text-info { color: var(--accent-primary) !important; }
            
            .resize-handle {
                position: absolute;
                bottom: 0;
                right: 0;
                width: 20px;
                height: 20px;
                cursor: se-resize;
                background: linear-gradient(135deg, transparent 50%, var(--border-light) 50%);
                border-top-left-radius: 8px;
            }
            
            @media (max-width: 768px) {
                .resize-handle {
                    display: none;
                }
            }
            
            ::-webkit-scrollbar {
                width: 8px;
            }
            
            ::-webkit-scrollbar-track {
                background: var(--bg-tertiary);
                border-radius: 4px;
            }
            
            ::-webkit-scrollbar-thumb {
                background: var(--border-light);
                border-radius: 4px;
            }
        `;
        document.head.appendChild(s);
        
        const isMobile = window.innerWidth < 769;
        
        const d = document.createElement("div");
        d.id = "orion-wrap";
        
        if (isMobile) {
            d.innerHTML = createMobileUI();
        } else {
            d.innerHTML = createDesktopUI();
        }
        
        document.body.appendChild(d);
        
        setupEventListeners();
        
        if (isMobile) {
            setupMobileNavigation();
            loadMobileSettings();
        }
        
        API.syncOnce();
    }

    function createDesktopUI() {
        return `
            <div class="resize-handle"></div>
            
            <div class="orion-header">
                <div class="header-main">
                    <div class="header-title">
                        <span>‚ö°</span>
                        ORION PRO FLIP EDITION
                    </div>
                    <div class="license-badge">
                        ${bot.licenseTier}
                    </div>
                </div>
                
                <div class="user-info-card">
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <div class="user-avatar">
                            üë§
                        </div>
                        <div style="display: flex; flex-direction: column;">
                            <div class="username">${bot.stakeUser}</div>
                            <div class="expiry-date">
                                <span>üìÖ</span>
                                <span>Expires: ${userExpiry}</span>
                            </div>
                        </div>
                    </div>
                    <div style="font-size: 12px; color: #9CA3AF;">
                        ${CONFIG.version}
                    </div>
                </div>
                
                <div class="status-badge" id="st-status-text">üü¢ READY</div>
            </div>
            
            <div class="running-time" id="running-time">
                RUNNING TIME: 00:00:00
            </div>
            
            <div class="content-area">
                <div class="clean-stats" id="complete-statistics">
                    <div class="stat-row">
                        <div class="stat-item">
                            <div class="stat-label">üí∞ Balance Start</div>
                            <div class="stat-value">0.00000000</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">üíµ Balance Now</div>
                            <div class="stat-value">0.00000000</div>
                        </div>
                    </div>
                    <div class="stat-row">
                        <div class="stat-item">
                            <div class="stat-label">üìà Total Profit</div>
                            <div class="stat-value">0.00000000</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">üéØ Session Profit</div>
                            <div class="stat-value">0.00000000</div>
                        </div>
                    </div>
                    <div class="stat-row">
                        <div class="stat-item">
                            <div class="stat-label">üéÆ Bets</div>
                            <div class="stat-value">0 (0/0)</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">üìä Win Rate</div>
                            <div class="stat-value">0.0%</div>
                        </div>
                    </div>
                </div>
                
                <div style="background: linear-gradient(145deg, var(--bg-secondary), var(--bg-tertiary)); border-radius: 12px; padding: 16px; margin: 20px 0; border: 1px solid var(--border-color);">
                    <div style="font-size: 14px; color: var(--text-secondary); margin-bottom: 8px; font-weight: 600;">SELECT CURRENCY</div>
                    <select id="p-currency" style="width: 100%; padding: 14px; background: var(--bg-primary); border: 1px solid var(--border-color); border-radius: 10px; color: var(--text-primary); font-size: 16px;">
                        <option value="loading">Loading currencies...</option>
                    </select>
                </div>
                
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin: 20px 0;">
                    <button class="preset-btn" data-preset="CONSERVATIVE" style="padding: 16px; background: linear-gradient(145deg, #1F2937, #111827); border: 1px solid #374151; border-radius: 12px; color: #9CA3AF; font-size: 14px; font-weight: 600; cursor: pointer; display: flex; flex-direction: column; align-items: center; gap: 8px;">
                        <span style="font-size: 24px;">üõ°Ô∏è</span>
                        CONSERVATIVE
                    </button>
                    <button class="preset-btn" data-preset="BALANCED" style="padding: 16px; background: linear-gradient(145deg, #1E3A8A, #1E40AF); border: 1px solid #3B82F6; border-radius: 12px; color: #E5E7EB; font-size: 14px; font-weight: 600; cursor: pointer; display: flex; flex-direction: column; align-items: center; gap: 8px;">
                        <span style="font-size: 24px;">‚öñÔ∏è</span>
                        BALANCED
                    </button>
                    <button class="preset-btn" data-preset="AGGRESSIVE" style="padding: 16px; background: linear-gradient(145deg, #7C2D12, #9A3412); border: 1px solid #F59E0B; border-radius: 12px; color: #FDE68A; font-size: 14px; font-weight: 600; cursor: pointer; display: flex; flex-direction: column; align-items: center; gap: 8px;">
                        <span style="font-size: 24px;">‚ö°</span>
                        AGGRESSIVE
                    </button>
                </div>
                
                <div style="display: grid; gap: 12px; margin: 20px 0;">
                    <button id="btn-run" class="btn btn-primary">
                        <span style="font-size: 24px;">üöÄ</span>
                        START BOT
                    </button>
                    
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px;">
                        <button id="btn-pause" class="btn btn-warning">
                            <span style="font-size: 20px;">‚è∏Ô∏è</span>
                            PAUSE
                        </button>
                        <button id="btn-stop" class="btn btn-danger">
                            <span style="font-size: 20px;">üõë</span>
                            STOP
                        </button>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px;">
                        <button class="mode-btn" data-mode="BASE" class="btn btn-secondary">
                            <span style="font-size: 20px;">üèóÔ∏è</span>
                            BASE MODE
                        </button>
                        <button class="mode-btn" data-mode="WAGER" class="btn btn-secondary">
                            <span style="font-size: 20px;">‚ö°</span>
                            WAGER MODE
                        </button>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px;">
                        <button class="game-btn" data-game="DICE" class="btn btn-secondary">
                            <span style="font-size: 20px;">üé≤</span>
                            DICE GAME
                        </button>
                        <button class="game-btn" data-game="FLIP" class="btn btn-secondary">
                            <span style="font-size: 20px;">ü™ô</span>
                            FLIP GAME
                        </button>
                    </div>
                </div>
                
                <div style="text-align: center; margin: 24px 0;">
                    <button id="toggle-settings" style="background: transparent; border: 1px solid var(--border-color); color: var(--text-secondary); padding: 12px 24px; border-radius: 20px; font-size: 14px; font-weight: 600; cursor: pointer; display: flex; align-items: center; gap: 10px; margin: 0 auto;">
                        <span style="font-size: 18px;">‚öôÔ∏è</span>
                        SHOW SETTINGS
                    </button>
                </div>
                
                <div id="settings-panel" style="display: none; background: linear-gradient(145deg, var(--bg-secondary), var(--bg-tertiary)); border-radius: 12px; padding: 20px; margin: 20px 0; border: 1px solid var(--border-color);">
                    <div style="font-size: 18px; font-weight: 700; color: var(--text-primary); margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
                        <span style="font-size: 22px;">‚öôÔ∏è</span>
                        SETTINGS
                    </div>
                    
                    <div style="margin-bottom: 24px;">
                        <div style="font-size: 16px; color: var(--text-secondary); margin-bottom: 12px; font-weight: 600;">üé≤ DICE SETTINGS</div>
                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px;">
                            <div>
                                <div style="font-size: 14px; color: var(--text-secondary); margin-bottom: 6px;">Base Bet</div>
                                <input id="p-basebet" value="0.00000100" type="number" step="0.00000001" min="0" style="width: 100%; padding: 12px; background: var(--bg-primary); border: 1px solid var(--border-color); border-radius: 8px; color: var(--text-primary); font-size: 16px;">
                            </div>
                            <div>
                                <div style="font-size: 14px; color: var(--text-secondary); margin-bottom: 6px;">Base Chance Min</div>
                                <input id="p-bch-min" value="80.0" type="number" step="0.1" min="1" max="99" style="width: 100%; padding: 12px; background: var(--bg-primary); border: 1px solid var(--border-color); border-radius: 8px; color: var(--text-primary); font-size: 16px;">
                            </div>
                            <div>
                                <div style="font-size: 14px; color: var(--text-secondary); margin-bottom: 6px;">Base Chance Max</div>
                                <input id="p-bch-max" value="95.0" type="number" step="0.1" min="1" max="99" style="width: 100%; padding: 12px; background: var(--bg-primary); border: 1px solid var(--border-color); border-radius: 8px; color: var(--text-primary); font-size: 16px;">
                            </div>
                            <div>
                                <div style="font-size: 14px; color: var(--text-secondary); margin-bottom: 6px;">Wager Chance</div>
                                <input id="p-wgr-chance" value="99.0" type="number" step="0.1" min="90" max="99.99" style="width: 100%; padding: 12px; background: var(--bg-primary); border: 1px solid var(--border-color); border-radius: 8px; color: var(--text-primary); font-size: 16px;">
                            </div>
                            <div>
                                <div style="font-size: 14px; color: var(--text-secondary); margin-bottom: 6px;">Multiplier Start</div>
                                <input id="p-multi-start" value="1.45" type="number" step="0.01" min="1" style="width: 100%; padding: 12px; background: var(--bg-primary); border: 1px solid var(--border-color); border-radius: 8px; color: var(--text-primary); font-size: 16px;">
                            </div>
                            <div>
                                <div style="font-size: 14px; color: var(--text-secondary); margin-bottom: 6px;">Multiplier Increase</div>
                                <input id="p-multi-inc" value="0.05" type="number" step="0.01" min="0.01" style="width: 100%; padding: 12px; background: var(--bg-primary); border: 1px solid var(--border-color); border-radius: 8px; color: var(--text-primary); font-size: 16px;">
                            </div>
                            <div>
                                <div style="font-size: 14px; color: var(--text-secondary); margin-bottom: 6px;">Hedge Chance Min</div>
                                <input id="p-hch-min" value="20.0" type="number" step="0.1" min="1" max="99" style="width: 100%; padding: 12px; background: var(--bg-primary); border: 1px solid var(--border-color); border-radius: 8px; color: var(--text-primary); font-size: 16px;">
                            </div>
                            <div>
                                <div style="font-size: 14px; color: var(--text-secondary); margin-bottom: 6px;">Hedge Chance Max</div>
                                <input id="p-hch-max" value="30.0" type="number" step="0.1" min="1" max="99" style="width: 100%; padding: 12px; background: var(--bg-primary); border: 1px solid var(--border-color); border-radius: 8px; color: var(--text-primary); font-size: 16px;">
                            </div>
                            <div>
                                <div style="font-size: 14px; color: var(--text-secondary); margin-bottom: 6px;">Wager Division</div>
                                <input id="p-wgr-div" value="100" type="number" step="1" min="50" style="width: 100%; padding: 12px; background: var(--bg-primary); border: 1px solid var(--border-color); border-radius: 8px; color: var(--text-primary); font-size: 16px;">
                            </div>
                            <div>
                                <div style="font-size: 14px; color: var(--text-secondary); margin-bottom: 6px;">Min Bet</div>
                                <input id="p-minbet" value="0.00000001" type="number" step="0.00000001" min="0" style="width: 100%; padding: 12px; background: var(--bg-primary); border: 1px solid var(--border-color); border-radius: 8px; color: var(--text-primary); font-size: 16px;">
                            </div>
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 24px;">
                        <div style="font-size: 16px; color: var(--text-secondary); margin-bottom: 12px; font-weight: 600;">üîÑ FLIP RECOVERY</div>
                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px;">
                            <div>
                                <div style="font-size: 14px; color: var(--text-secondary); margin-bottom: 6px;">Recovery Threshold %</div>
                                <input id="p-recovery-threshold" value="-2.0" type="number" step="0.1" min="-10" max="0" style="width: 100%; padding: 12px; background: var(--bg-primary); border: 1px solid var(--border-color); border-radius: 8px; color: var(--text-primary); font-size: 16px;">
                            </div>
                            <div>
                                <div style="font-size: 14px; color: var(--text-secondary); margin-bottom: 6px;">Flip Base Bet</div>
                                <input id="p-flip-basebet" value="0.00000100" type="number" step="0.00000001" min="0" style="width: 100%; padding: 12px; background: var(--bg-primary); border: 1px solid var(--border-color); border-radius: 8px; color: var(--text-primary); font-size: 16px;">
                            </div>
                            <div>
                                <div style="font-size: 14px; color: var(--text-secondary); margin-bottom: 6px;">Max Sequence Length</div>
                                <input id="p-flip-max-sequence" value="15" type="number" step="1" min="5" max="25" style="width: 100%; padding: 12px; background: var(--bg-primary); border: 1px solid var(--border-color); border-radius: 8px; color: var(--text-primary); font-size: 16px;">
                            </div>
                            <div>
                                <div style="font-size: 14px; color: var(--text-secondary); margin-bottom: 6px;">Side Selection</div>
                                <select id="p-flip-side-mode" style="width: 100%; padding: 12px; background: var(--bg-primary); border: 1px solid var(--border-color); border-radius: 8px; color: var(--text-primary); font-size: 16px;">
                                    <option value="auto">Auto (Pattern Analysis)</option>
                                    <option value="heads">Force Heads</option>
                                    <option value="tails">Force Tails</option>
                                    <option value="manual">Manual Control</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div>
                        <div style="font-size: 16px; color: var(--text-secondary); margin-bottom: 12px; font-weight: 600;">üéØ SESSION SETTINGS</div>
                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px;">
                            <div>
                                <div style="font-size: 14px; color: var(--text-secondary); margin-bottom: 6px;">Max Sessions</div>
                                <input id="p-max-sessions" value="20" type="number" step="1" min="1" style="width: 100%; padding: 12px; background: var(--bg-primary); border: 1px solid var(--border-color); border-radius: 8px; color: var(--text-primary); font-size: 16px;">
                            </div>
                            <div>
                                <div style="font-size: 14px; color: var(--text-secondary); margin-bottom: 6px;">Session Target %</div>
                                <input id="p-session-target" value="0.2" type="number" step="0.1" min="0.1" style="width: 100%; padding: 12px; background: var(--bg-primary); border: 1px solid var(--border-color); border-radius: 8px; color: var(--text-primary); font-size: 16px;">
                            </div>
                            <div>
                                <div style="font-size: 14px; color: var(--text-secondary); margin-bottom: 6px;">Session Stop Loss %</div>
                                <input id="p-session-stoploss" value="0.1" type="number" step="0.1" min="0.1" style="width: 100%; padding: 12px; background: var(--bg-primary); border: 1px solid var(--border-color); border-radius: 8px; color: var(--text-primary); font-size: 16px;">
                            </div>
                            <div>
                                <div style="font-size: 14px; color: var(--text-secondary); margin-bottom: 6px;">Global Stop Loss %</div>
                                <input id="p-stoploss-pct" value="5.0" type="number" step="0.1" min="0.1" style="width: 100%; padding: 12px; background: var(--bg-primary); border: 1px solid var(--border-color); border-radius: 8px; color: var(--text-primary); font-size: 16px;">
                            </div>
                        </div>
                    </div>
                </div>
                
                <div style="background: linear-gradient(145deg, var(--bg-secondary), var(--bg-tertiary)); border-radius: 12px; padding: 20px; margin: 24px 0; border: 1px solid var(--border-color); max-height: 250px; overflow-y: auto;">
                    <div style="display: grid; grid-template-columns: 1.2fr 1fr 0.8fr 1.2fr; padding: 12px 0; border-bottom: 1px solid var(--border-color); font-size: 14px; color: var(--text-secondary); font-weight: 600; text-align: center;">
                        <span>AMOUNT</span>
                        <span>CHANCE</span>
                        <span>MODE</span>
                        <span>PROFIT</span>
                    </div>
                    <div id="p-log-body"></div>
                </div>
                
                <div style="text-align: center; padding: 20px; color: var(--text-secondary); font-size: 14px; border-top: 1px solid var(--border-color); margin-top: 20px;">
                    üí¨ <a href="https://t.me/${CONFIG.supportContact.replace('@', '')}" target="_blank" style="color: var(--accent-primary); text-decoration: none; font-weight: 600;">${CONFIG.supportContact}</a>
                    <div style="margin-top: 12px;">
                        ‚ö° ${CONFIG.version} | üîí ${bot.licenseTier}
                    </div>
                </div>
            </div>
        `;
    }

    function createMobileUI() {
        return `
            <div class="orion-header">
                <div class="header-main">
                    <div class="header-title">
                        ‚ö° ORION PRO
                    </div>
                    <div class="license-badge">
                        ${bot.licenseTier}
                    </div>
                </div>
                
                <div class="user-info-card">
                    <div class="user-avatar">
                        üë§
                    </div>
                    <div style="flex: 1;">
                        <div class="username">${bot.stakeUser}</div>
                        <div class="expiry-date">Exp: ${userExpiry}</div>
                    </div>
                </div>
                
                <div class="status-badge" id="st-status-text">üü¢ READY</div>
            </div>
            
            <div class="running-time" id="running-time">
                RUNNING TIME: 00:00:00
            </div>
            
            <div id="tab-dashboard" class="tab-content active">
                <div class="clean-stats" id="complete-statistics">
                    <div class="stat-row">
                        <div class="stat-item">
                            <div class="stat-label">üí∞ Balance Start</div>
                            <div class="stat-value">0.00000000</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">üíµ Balance Now</div>
                            <div class="stat-value">0.00000000</div>
                        </div>
                    </div>
                    <div class="stat-row">
                        <div class="stat-item">
                            <div class="stat-label">üìà Total Profit</div>
                            <div class="stat-value">0.00000000</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">üéØ Session Profit</div>
                            <div class="stat-value">0.00000000</div>
                        </div>
                    </div>
                    <div class="stat-row">
                        <div class="stat-item">
                            <div class="stat-label">üéÆ Bets</div>
                            <div class="stat-value">0 (0/0)</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">üìä Win Rate</div>
                            <div class="stat-value">0.0%</div>
                        </div>
                    </div>
                </div>
                
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin: 16px 0;">
                    <button id="btn-run" style="grid-column: 1 / -1; padding: 16px; background: var(--gradient-primary); border: none; border-radius: 12px; color: white; font-size: 16px; font-weight: 700; display: flex; align-items: center; justify-content: center; gap: 10px;">
                        <span>üöÄ</span>
                        START BOT
                    </button>
                    
                    <button id="btn-pause" style="padding: 14px; background: var(--gradient-warning); border: none; border-radius: 10px; color: #1F2937; font-size: 14px; font-weight: 600; display: flex; align-items: center; justify-content: center; gap: 8px;">
                        <span>‚è∏Ô∏è</span>
                        PAUSE
                    </button>
                    
                    <button id="btn-stop" style="padding: 14px; background: var(--gradient-danger); border: none; border-radius: 10px; color: white; font-size: 14px; font-weight: 600; display: flex; align-items: center; justify-content: center; gap: 8px;">
                        <span>üõë</span>
                        STOP
                    </button>
                </div>
                
                <div style="margin: 20px 0;">
                    <div style="font-size: 14px; color: var(--text-secondary); margin-bottom: 8px; font-weight: 600;">SELECT GAME</div>
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px;">
                        <button class="game-btn" data-game="DICE" style="padding: 16px; background: var(--bg-tertiary); border: 1px solid var(--border-color); border-radius: 10px; color: var(--text-primary); font-size: 14px; font-weight: 600; display: flex; flex-direction: column; align-items: center; gap: 6px;">
                            <span style="font-size: 24px;">üé≤</span>
                            DICE
                        </button>
                        <button class="game-btn" data-game="FLIP" style="padding: 16px; background: var(--bg-tertiary); border: 1px solid var(--border-color); border-radius: 10px; color: var(--text-primary); font-size: 14px; font-weight: 600; display: flex; flex-direction: column; align-items: center; gap: 6px;">
                            <span style="font-size: 24px;">ü™ô</span>
                            FLIP
                        </button>
                    </div>
                </div>
                
                <div style="margin: 20px 0;">
                    <div style="font-size: 14px; color: var(--text-secondary); margin-bottom: 8px; font-weight: 600;">SELECT MODE</div>
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px;">
                        <button class="mode-btn" data-mode="BASE" style="padding: 16px; background: var(--bg-tertiary); border: 1px solid var(--border-color); border-radius: 10px; color: var(--text-primary); font-size: 14px; font-weight: 600; display: flex; flex-direction: column; align-items: center; gap: 6px;">
                            <span style="font-size: 24px;">üèóÔ∏è</span>
                            BASE
                        </button>
                        <button class="mode-btn" data-mode="WAGER" style="padding: 16px; background: var(--bg-tertiary); border: 1px solid var(--border-color); border-radius: 10px; color: var(--text-primary); font-size: 14px; font-weight: 600; display: flex; flex-direction: column; align-items: center; gap: 6px;">
                            <span style="font-size: 24px;">‚ö°</span>
                            WAGER
                        </button>
                    </div>
                </div>
                
                <div style="margin: 20px 0;">
                    <div style="font-size: 14px; color: var(--text-secondary); margin-bottom: 8px; font-weight: 600;">CURRENCY</div>
                    <select id="p-currency" style="width: 100%; padding: 14px; background: var(--bg-tertiary); border: 1px solid var(--border-color); border-radius: 10px; color: var(--text-primary); font-size: 16px;">
                        <option value="loading">Loading currencies...</option>
                    </select>
                </div>
            </div>
            
            <div id="tab-presets" class="tab-content" style="padding: 20px;">
                <div style="font-size: 18px; font-weight: 700; color: var(--text-primary); margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
                    <span>‚ö°</span>
                    QUICK PRESETS
                </div>
                
                <div style="display: flex; flex-direction: column; gap: 12px;">
                    <button class="preset-btn" data-preset="CONSERVATIVE" style="padding: 18px; background: linear-gradient(145deg, #1F2937, #111827); border: 1px solid #374151; border-radius: 12px; color: #9CA3AF; font-size: 16px; font-weight: 600; display: flex; align-items: center; gap: 12px;">
                        <span style="font-size: 24px;">üõ°Ô∏è</span>
                        <div style="text-align: left;">
                            <div>CONSERVATIVE</div>
                            <div style="font-size: 12px; color: #6B7280;">Low risk, steady profit</div>
                        </div>
                    </button>
                    
                    <button class="preset-btn" data-preset="BALANCED" style="padding: 18px; background: linear-gradient(145deg, #1E3A8A, #1E40AF); border: 1px solid #3B82F6; border-radius: 12px; color: #E5E7EB; font-size: 16px; font-weight: 600; display: flex; align-items: center; gap: 12px;">
                        <span style="font-size: 24px;">‚öñÔ∏è</span>
                        <div style="text-align: left;">
                            <div>BALANCED</div>
                            <div style="font-size: 12px; color: #93C5FD;">Optimal risk/reward</div>
                        </div>
                    </button>
                    
                    <button class="preset-btn" data-preset="AGGRESSIVE" style="padding: 18px; background: linear-gradient(145deg, #7C2D12, #9A3412); border: 1px solid #F59E0B; border-radius: 12px; color: #FDE68A; font-size: 16px; font-weight: 600; display: flex; align-items: center; gap: 12px;">
                        <span style="font-size: 24px;">‚ö°</span>
                        <div style="text-align: left;">
                            <div>AGGRESSIVE</div>
                            <div style="font-size: 12px; color: #FBBF24;">High risk, high reward</div>
                        </div>
                    </button>
                </div>
            </div>
            
            <div id="tab-settings" class="tab-content" style="padding: 20px;">
                <!-- Mobile settings loaded dynamically -->
            </div>
            
            <div id="tab-logs" class="tab-content" style="padding: 20px;">
                <div id="p-log-body-mobile"></div>
            </div>
            
            <div class="mobile-nav">
                <button class="nav-btn active" data-tab="dashboard">
                    <span style="font-size: 20px;">üìä</span>
                    Dashboard
                </button>
                <button class="nav-btn" data-tab="presets">
                    <span style="font-size: 20px;">‚ö°</span>
                    Presets
                </button>
                <button class="nav-btn" data-tab="settings">
                    <span style="font-size: 20px;">‚öôÔ∏è</span>
                    Settings
                </button>
                <button class="nav-btn" data-tab="logs">
                    <span style="font-size: 20px;">üìù</span>
                    Logs
                </button>
            </div>
        `;
    }

    // ==================== EVENT LISTENERS ====================
    function setupEventListeners() {
        // Currency selector
        const currencySelect = document.getElementById("p-currency");
        if (currencySelect) {
            currencySelect.addEventListener('change', async (e) => {
                bot.selectedCurrency = e.target.value;
                localStorage.setItem('orion_last_coin', bot.selectedCurrency);
                await updateBalanceDisplay();
            });
        }

        // Start button
        const startBtn = document.getElementById("btn-run");
        if (startBtn) {
            startBtn.addEventListener('click', async () => {
                if (!bot.isRunning) {
                    await startBot();
                }
            });
        }

        // Stop button
        const stopBtn = document.getElementById("btn-stop");
        if (stopBtn) {
            stopBtn.addEventListener('click', async () => {
                await stopEngine();
                updateStatus("üõë STOPPED", "#EF4444");
                await sendTelegramReport("stop");
            });
        }

        // Pause button
        const pauseBtn = document.getElementById("btn-pause");
        if (pauseBtn) {
            pauseBtn.addEventListener('click', async () => {
                bot.isPaused = !bot.isPaused;
                updateStatus(bot.isPaused ? "‚è∏Ô∏è PAUSED" : "‚ö° RUNNING",
                           bot.isPaused ? "#F59E0B" : "#10B981");
            });
        }

        // Settings toggle
        const settingsToggle = document.getElementById("toggle-settings");
        if (settingsToggle) {
            settingsToggle.addEventListener('click', () => {
                const panel = document.getElementById("settings-panel");
                const button = document.getElementById("toggle-settings");
                
                if (panel.style.display === "none" || !panel.style.display) {
                    panel.style.display = "block";
                    button.innerHTML = '<span>‚öôÔ∏è</span> HIDE SETTINGS';
                } else {
                    panel.style.display = "none";
                    button.innerHTML = '<span>‚öôÔ∏è</span> SHOW SETTINGS';
                }
            });
        }

        // Preset buttons
        document.querySelectorAll('.preset-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const preset = this.getAttribute('data-preset');
                applyPreset(preset);
            });
        });

        // Mode buttons
        document.querySelectorAll('.mode-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const mode = this.getAttribute('data-mode');
                rotateMode(mode);
            });
        });

        // Game buttons
        document.querySelectorAll('.game-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const game = this.getAttribute('data-game');
                switchGame(game);
            });
        });
    }

    function setupMobileNavigation() {
        const navButtons = document.querySelectorAll('.nav-btn');
        const tabContents = document.querySelectorAll('.tab-content');
        
        navButtons.forEach(btn => {
            btn.addEventListener('click', function() {
                const tabId = this.getAttribute('data-tab');
                
                navButtons.forEach(b => b.classList.remove('active'));
                tabContents.forEach(t => t.classList.remove('active'));
                
                this.classList.add('active');
                document.getElementById(`tab-${tabId}`).classList.add('active');
            });
        });
    }

    function loadMobileSettings() {
        const settingsTab = document.getElementById('tab-settings');
        if (!settingsTab) return;
        
        settingsTab.innerHTML = `
            <div style="font-size: 18px; font-weight: 700; color: var(--text-primary); margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
                <span>‚öôÔ∏è</span>
                SETTINGS
            </div>
            
            <div style="display: flex; flex-direction: column; gap: 16px;">
                <div>
                    <div style="font-size: 14px; color: var(--text-secondary); margin-bottom: 8px; font-weight: 600;">üé≤ DICE SETTINGS</div>
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px;">
                        <div>
                            <div style="font-size: 12px; color: var(--text-secondary); margin-bottom: 4px;">Base Bet</div>
                            <input id="p-basebet-mobile" value="0.00000100" type="number" step="0.00000001" min="0" style="width: 100%; padding: 12px; background: var(--bg-primary); border: 1px solid var(--border-color); border-radius: 8px; color: var(--text-primary); font-size: 14px;">
                        </div>
                        <div>
                            <div style="font-size: 12px; color: var(--text-secondary); margin-bottom: 4px;">Base Chance Min</div>
                            <input id="p-bch-min-mobile" value="80.0" type="number" step="0.1" min="1" max="99" style="width: 100%; padding: 12px; background: var(--bg-primary); border: 1px solid var(--border-color); border-radius: 8px; color: var(--text-primary); font-size: 14px;">
                        </div>
                        <div>
                            <div style="font-size: 12px; color: var(--text-secondary); margin-bottom: 4px;">Base Chance Max</div>
                            <input id="p-bch-max-mobile" value="95.0" type="number" step="0.1" min="1" max="99" style="width: 100%; padding: 12px; background: var(--bg-primary); border: 1px solid var(--border-color); border-radius: 8px; color: var(--text-primary); font-size: 14px;">
                        </div>
                        <div>
                            <div style="font-size: 12px; color: var(--text-secondary); margin-bottom: 4px;">Wager Chance</div>
                            <input id="p-wgr-chance-mobile" value="99.0" type="number" step="0.1" min="90" max="99.99" style="width: 100%; padding: 12px; background: var(--bg-primary); border: 1px solid var(--border-color); border-radius: 8px; color: var(--text-primary); font-size: 14px;">
                        </div>
                    </div>
                </div>
                
                <div>
                    <div style="font-size: 14px; color: var(--text-secondary); margin-bottom: 8px; font-weight: 600;">üîÑ FLIP SETTINGS</div>
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px;">
                        <div>
                            <div style="font-size: 12px; color: var(--text-secondary); margin-bottom: 4px;">Recovery Threshold %</div>
                            <input id="p-recovery-threshold-mobile" value="-2.0" type="number" step="0.1" min="-10" max="0" style="width: 100%; padding: 12px; background: var(--bg-primary); border: 1px solid var(--border-color); border-radius: 8px; color: var(--text-primary); font-size: 14px;">
                        </div>
                        <div>
                            <div style="font-size: 12px; color: var(--text-secondary); margin-bottom: 4px;">Flip Base Bet</div>
                            <input id="p-flip-basebet-mobile" value="0.00000100" type="number" step="0.00000001" min="0" style="width: 100%; padding: 12px; background: var(--bg-primary); border: 1px solid var(--border-color); border-radius: 8px; color: var(--text-primary); font-size: 14px;">
                        </div>
                    </div>
                </div>
            </div>
        `;
    }

    // ==================== REAL-TIME UPDATES ====================
    setInterval(() => {
        try {
            if (!document.getElementById("st-status-text")) return;
            
            if (bot.startTime) {
                document.getElementById("running-time").innerText = `RUNNING TIME: ${getRunningTime()}`;
            }
            
            if (Date.now() % 2000 < 100) {
                updateCompleteStatistics();
            }
                
        } catch (e) {
            console.error("UI update error:", e);
        }
    }, 1000);

    // ==================== GLOBAL FUNCTIONS ====================
    if (typeof window !== 'undefined') {
        window.applyPreset = applyPreset;
        window.rotateMode = rotateMode;
        window.switchGame = switchGame;
        window.forceFlipSide = forceFlipSide;
    }

    // ==================== INITIALIZATION ====================
    async function initialize() {
        const isValid = await validateLicense();
        
        if (isValid) {
            console.log(`‚úÖ License valid for ${currentUser} (${licenseData.tier})`);
            bot.licenseTier = licenseData.tier;
            bot.stakeUser = currentUser;
            
            createUI();
            
            FlipRecovery.stats = {
                totalRecoveries: 0,
                successfulRecoveries: 0,
                failedRecoveries: 0,
                totalRecovered: 0,
                totalTime: 0
            };
            
        } else {
            console.log("‚ùå License invalid or user not whitelisted");
        }
    }

    // Start
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initialize);
    } else {
        initialize();
    }
})();
