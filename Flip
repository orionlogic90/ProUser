(function () {
    const CONFIG = {
        get apiUrl() { return window.location.origin + '/_api'; },
        tgToken: '8391763291:AAEA05v6FG70eM1WGrgU7mrPgckfjQaxkno',
        tgChatId: '-1003744641395', 
        version: "ORION v8.1", // Updated version
    };

    const bot = {
        isRunning: false, isDemo: false, token: null, stakeUser: "Loading...",
        stats: { profit: 0, wagered: 0, startBal: 0, currentBal: 0, bets: 0, wins: 0, loss: 0, startTime: null, maxDD: 0, maxDDPerc: 0 },
        selectedCurrency: "doge", tg: 0, perStep: 0, baseChance: 0, currentChance: 0,
        singleChanceBets: 0, singleChanceLimit: 0, targetAbs: 0, stopLossAbs: 0,
        mode: "orion",
        enabledModes: {
            orion: true,
            wager: true,
            labouchere: true
        },
        wagerStats: {
            betlose: 0, betsafe: false, basebet: 0, nextbet: 0, 
            chanceNormal: 97, chanceRecovery: 25, chanceMax: 99,
            simplestats: {
                stopwin: false, reset: false, recov: false, mostbet: 0, balhi: 0, balst: 0,
                maxdrop: 0, profitc: 0, drop: 0
            },
            xstopwin: [0, 0, 0, 0, 0, 5],
            wagerDivider: 2.0 // Added wager divider
        },
        labouchere: {
            sequence: [1, 2, 3, 4],
            currentSequence: [],
            targetProfit: 10,
            betAmount: 0,
            baseBet: 0.00000001, // Added base bet
            minBet: 0.00000001, // Added min bet
            chance: 49.5, // Added chance
            betOn: 'black',
            recoveryMode: false,
            maxBet: 0, 
            maxCycles: 3, 
            currentCycle: 1,
            totalCyclesCompleted: 0,
            useMaxBetOnly: false // Flag for using max bet only when reached
        },
        rotationState: {
            initialBalance: 0,
            wagerLossThreshold: 0.001,
            severeLossThreshold: 0.01,
            inRecovery: false,
            stepLimit: 10000,
            stepLimitMultiplier: 1.1
        },
        telegramReport: {
            lastReportTime: 0,
            reportInterval: 5 * 60 * 1000,
            isReporting: false
        },
        minimized: false
    };

    // ... [Kode API dan fungsi lainnya tetap sama sampai fungsi initWagerMode] ...

    function initWagerMode() {
        const baseBetPct = parseFloat(document.getElementById("w-basebet-pct")?.value) || 1.0;
        const wagerDivider = parseFloat(document.getElementById("w-wager-divider")?.value) || 2.0;
        
        bot.wagerStats.wagerDivider = wagerDivider;
        bot.wagerStats.basebet = (bot.stats.currentBal * (baseBetPct / 100)) / wagerDivider; // Divide by wagerDivider
        bot.wagerStats.nextbet = bot.wagerStats.basebet;
        bot.wagerStats.betlose = 0;
        bot.wagerStats.betsafe = false;
        bot.wagerStats.simplestats = {
            stopwin: false, reset: false, recov: false, 
            mostbet: bot.wagerStats.basebet, 
            balhi: bot.stats.currentBal, 
            balst: bot.stats.currentBal,
            maxdrop: 0, profitc: 0, drop: 0
        };
        
        for (let i = 1; i <= 6; i++) {
            const val = parseFloat(document.getElementById(`w-xstopwin-${i}`)?.value) || 0;
            bot.wagerStats.xstopwin[i-1] = val;
        }
        
        bot.wagerStats.chanceNormal = parseFloat(document.getElementById("w-chance-normal")?.value) || 97;
        bot.wagerStats.chanceRecovery = parseFloat(document.getElementById("w-chance-recovery")?.value) || 25;
        bot.wagerStats.chanceMax = parseFloat(document.getElementById("w-chance-max")?.value) || 99;
        
        bot.currentChance = bot.wagerStats.chanceNormal;
    }

    function updateWagerStats(profit) {
        const ws = bot.wagerStats;
        const ss = ws.simplestats;
        
        ss.profitc += profit;
        
        if (ss.profitc >= 0) {
            if (ss.stopwin) {
                bot.isRunning = false;
                updateLogs(0, 0, 0, "WAGER: Stop condition reached", true);
                return;
            }
            ss.profitc = 0;
            ss.balhi = bot.stats.currentBal;
            ss.reset = false;
            ss.recov = false;
        }
        
        ss.drop = ss.balhi - bot.stats.currentBal;
        if (ss.drop > ss.maxdrop) {
            ss.maxdrop = ss.drop;
        }
        
        if (ws.nextbet > ss.mostbet) {
            ss.mostbet = ws.nextbet;
        }
        
        if (ws.xstopwin[0] > 0 && ss.maxdrop/ss.balhi*100 > ws.xstopwin[0]) {
            ss.stopwin = true;
        }
        if (ws.xstopwin[1] > 0 && ss.mostbet/ss.balst*100 > ws.xstopwin[1]) {
            ss.stopwin = true;
        }
        if (ws.xstopwin[2] > 0 && bot.stats.loss > ws.xstopwin[2]) {
            ss.stopwin = true;
        }
        if (ws.xstopwin[3] > 0 && bot.stats.profit/(bot.stats.currentBal-bot.stats.profit)*100 > ws.xstopwin[3]) {
            ss.stopwin = true;
        }
        
        if (ws.xstopwin[4] > 0 && ws.nextbet/ss.balhi*100 > ws.xstopwin[4] && !ss.recov) {
            ss.recov = true;
        }
        
        if (ws.xstopwin[5] > 0 && ss.drop/ss.balhi*100 > ws.xstopwin[5] && !ss.reset) {
            ss.reset = true;
            ws.nextbet = ws.basebet;
        }
        
        if (ss.recov) {
            ws.chanceNormal = Math.random() * 10 + 5;
            ws.nextbet = Math.abs(ss.profitc)/((99/ws.chanceNormal)-1) / ws.wagerDivider; // Divide by wagerDivider
            const minbet = parseFloat(document.getElementById("w-minbet")?.value) || 0.00000001;
            if (ws.nextbet < minbet) ws.nextbet = minbet;
        }
        
        updateWagerUI();
    }

    function wagerBetLogic(profit) {
        const ws = bot.wagerStats;
        
        ws.betlose += profit;
        
        if (ws.betlose >= 0) {
            ws.betsafe = false;
            ws.betlose = 0;
            ws.nextbet = ws.basebet;
            bot.currentChance = ws.chanceNormal;
        } else {
            if (!ws.betsafe) {
                bot.currentChance = ws.chanceRecovery;
                ws.betsafe = true;
            }
        }
        
        if (ws.betsafe) {
            if (bot.stats.bets % 1 === 0) {
                bot.currentChance += 0.5;
                if (bot.currentChance > ws.chanceMax) {
                    bot.currentChance = ws.chanceNormal;
                    ws.betsafe = false;
                    ws.betlose = 0;
                    ws.nextbet = ws.basebet;
                }
            }
            ws.nextbet = Math.abs(ws.betlose)/((99/bot.currentChance)-1)*0.5 / ws.wagerDivider; // Divide by wagerDivider
        }
        
        const minbet = parseFloat(document.getElementById("w-minbet")?.value) || 0.00000001;
        if (ws.nextbet < minbet) ws.nextbet = minbet;
        
        updateWagerStats(profit);
        return ws.nextbet;
    }

    function initLabouchere() {
        const seqInput = document.getElementById("l-sequence")?.value || "1,2,3,4";
        bot.labouchere.sequence = seqInput.split(',').map(x => parseFloat(x.trim()) || 1);
        bot.labouchere.currentSequence = [...bot.labouchere.sequence];
        bot.labouchere.targetProfit = parseFloat(document.getElementById("l-target")?.value) || 10;
        bot.labouchere.baseBet = parseFloat(document.getElementById("l-basebet")?.value) || 0.00000001;
        bot.labouchere.minBet = parseFloat(document.getElementById("l-minbet")?.value) || 0.00000001;
        bot.labouchere.chance = parseFloat(document.getElementById("l-chance")?.value) || 49.5;
        bot.labouchere.maxBet = parseFloat(document.getElementById("l-maxbet")?.value) || 0;
        bot.labouchere.maxCycles = parseInt(document.getElementById("l-maxcycles")?.value) || 3;
        bot.labouchere.currentCycle = 1;
        bot.labouchere.totalCyclesCompleted = 0;
        bot.labouchere.useMaxBetOnly = false;
        bot.labouchere.betOn = Math.random() > 0.5 ? 'black' : 'red';
        bot.labouchere.recoveryMode = bot.rotationState.inRecovery;
        
        updateLabouchereUI();
    }

    function labouchereBetLogic(win) {
        const lb = bot.labouchere;
        
        // Jika sudah mencapai max cycles dan useMaxBetOnly = false, reset ke base bet
        if (lb.maxCycles > 0 && lb.totalCyclesCompleted >= lb.maxCycles && !lb.useMaxBetOnly) {
            lb.betAmount = lb.baseBet;
            updateLabouchereUI();
            return { betAmount: lb.betAmount, completed: false, stop: false };
        }
        
        // Jika current sequence kosong, mulai cycle baru
        if (lb.currentSequence.length === 0) {
            lb.currentSequence = [...lb.sequence];
            lb.currentCycle++;
            lb.totalCyclesCompleted++;
            
            // Jika mencapai max cycles dan useMaxBetOnly = true, set flag
            if (lb.maxCycles > 0 && lb.totalCyclesCompleted >= lb.maxCycles) {
                lb.useMaxBetOnly = true;
                updateLogs(0, 0, 0, `LABOUCHERE: Max cycles reached. Using max bet only.`, true);
            } else {
                updateLogs(0, 0, 0, `LABOUCHERE: Starting cycle ${lb.currentCycle}`, true);
            }
        }
        
        // Hitung bet amount berdasarkan Labouchere
        if (lb.currentSequence.length === 1) {
            lb.betAmount = lb.currentSequence[0];
        } else {
            lb.betAmount = lb.currentSequence[0] + lb.currentSequence[lb.currentSequence.length - 1];
        }
        
        // Terapkan min bet
        if (lb.betAmount < lb.minBet) {
            lb.betAmount = lb.minBet;
        }
        
        // Terapkan max bet jika diatur
        if (lb.maxBet > 0) {
            // Jika useMaxBetOnly = true, gunakan max bet saja
            if (lb.useMaxBetOnly) {
                lb.betAmount = lb.maxBet;
            } 
            // Jika bet amount melebihi max bet, batasi ke max bet tapi jangan stop
            else if (lb.betAmount > lb.maxBet) {
                lb.betAmount = lb.maxBet;
                updateLogs(0, 0, 0, `LABOUCHERE: Bet limited to max ${lb.maxBet.toFixed(8)}`, true);
            }
        }
        
        // Terapkan base bet jika bet amount terlalu kecil
        if (lb.betAmount < lb.baseBet) {
            lb.betAmount = lb.baseBet;
        }
        
        // Update current chance
        bot.currentChance = lb.chance;
        
        // Logika win/lose Labouchere
        if (win) {
            lb.currentSequence.shift();
            lb.currentSequence.pop();
            
            if (lb.currentSequence.length === 0 && !lb.useMaxBetOnly) {
                updateLogs(lb.betAmount, lb.betAmount, lb.chance, `LABOUCHERE: Cycle ${lb.currentCycle-1} completed!`, true);
            }
        } else {
            lb.currentSequence.push(lb.betAmount);
        }
        
        updateLabouchereUI();
        return { betAmount: lb.betAmount, completed: false, stop: false };
    }

    // ... [Kode checkRotation, getNextEnabledMode, generateTelegramReport, checkAndSendReport tetap sama] ...

    async function runLoop() {
        if (!bot.isRunning) return;
        
        try {
            checkRotation();
            checkAndSendReport();
            
            let nextBet = 0;
            
            if (bot.mode === "orion") {
                if (bot.singleChanceBets < bot.singleChanceLimit) {
                    bot.currentChance = bot.baseChance;
                } else {
                    bot.currentChance = Math.floor(Math.random() * 11) + (bot.baseChance + 5);
                }

                const payout = 99 / bot.currentChance;
                const margin = parseFloat(document.getElementById("p-margin")?.value) || 1.01;
                const minBetLimit = parseFloat(document.getElementById("p-minbet")?.value) || 0;
                const baseBet = parseFloat(document.getElementById("p-basebet")?.value) || 0;
                
                nextBet = (Math.abs(bot.tg) / (payout - 1)) * margin;
                if (bot.tg === bot.perStep) nextBet = baseBet;
                if (nextBet < minBetLimit) nextBet = minBetLimit;
                
            } else if (bot.mode === "wager") {
                nextBet = wagerBetLogic(0);
                
            } else if (bot.mode === "labouchere") {
                const lbResult = labouchereBetLogic(false);
                nextBet = lbResult.betAmount;
                
                if (lbResult.stop) {
                    const nextEnabledMode = getNextEnabledMode();
                    bot.mode = nextEnabledMode;
                    if (nextEnabledMode === "wager") initWagerMode();
                    else if (nextEnabledMode === "labouchere") initLabouchere();
                    else if (nextEnabledMode === "orion") setNewBaseChance();
                    updateLogs(0, 0, 0, `LABOUCHERE: Stopped. Switching to ${nextEnabledMode.toUpperCase()}.`, true);
                }
            }

            if (nextBet <= 0) nextBet = parseFloat(document.getElementById("p-basebet")?.value) || 0.00000001;
            if (nextBet > bot.stats.currentBal && bot.stats.currentBal > 0) {
                nextBet = bot.stats.currentBal;
            }

            const res = await API.placeBet(nextBet, bot.currentChance);
            const d = res?.data?.diceRoll || res?.diceRoll;

            if (d) {
                const win = d.payout > 0;
                const pft = d.payout - d.amount;
                
                bot.stats.bets++; 
                bot.stats.wagered += d.amount;
                bot.stats.profit += pft; 
                bot.stats.currentBal += pft;

                if (win) {
                    bot.stats.wins++;
                } else {
                    bot.stats.loss++;
                }

                if (bot.stats.currentBal < bot.stats.startBal) {
                    let dd = bot.stats.startBal - bot.stats.currentBal;
                    let ddPerc = (dd / bot.stats.startBal) * 100;
                    if (dd > bot.stats.maxDD) bot.stats.maxDD = dd;
                    if (ddPerc > bot.stats.maxDDPerc) bot.stats.maxDDPerc = ddPerc;
                }

                updateLogs(d.amount, pft, bot.currentChance);

                if (bot.mode === "orion") {
                    if (win) {
                        setNewBaseChance();
                    } else {
                        bot.singleChanceBets++; 
                        bot.tg += (d.amount + bot.perStep);
                    }
                } else if (bot.mode === "wager") {
                    wagerBetLogic(pft);
                } else if (bot.mode === "labouchere") {
                    const result = labouchereBetLogic(win);
                    if (result.completed && !result.stop) {
                        updateLogs(0, 0, 0, "Labouchere sequence completed!", true);
                    }
                }

                if (bot.stats.profit >= bot.targetAbs) { 
                    bot.isRunning = false; 
                    updateLogs(0, 0, 0, "üéØ TARGET SUCCESS!", true);
                }
                else if (bot.stats.profit <= -bot.stopLossAbs) { 
                    bot.isRunning = false; 
                    updateLogs(0, 0, 0, "üõë STOP LOSS REACHED!", true);
                }
                else if (bot.mode === "orion" && bot.stats.bets >= bot.rotationState.stepLimit) { 
                    bot.rotationState.stepLimit = Math.round(bot.rotationState.stepLimit * bot.rotationState.stepLimitMultiplier);
                    const nextEnabledMode = getNextEnabledMode();
                    bot.mode = nextEnabledMode;
                    if (nextEnabledMode === "wager") initWagerMode();
                    else if (nextEnabledMode === "labouchere") initLabouchere();
                    updateLogs(0, 0, 0, `üîÑ ORION: Step limit reached. New limit: ${bot.rotationState.stepLimit}. Switching to ${nextEnabledMode.toUpperCase()}.`, true);
                }
            }
            
            if (bot.isRunning) {
                if (!bot.isDemo) setTimeout(runLoop, 60); 
                else runLoop();
            }
            
        } catch (e) { 
            console.error("Run loop error:", e);
            if (bot.isRunning) {
                setTimeout(runLoop, 1000); 
            }
        }
    }

    // ... [Kode updateLogs, getModeColor, updateWagerUI tetap sama] ...

    function updateLabouchereUI() {
        const lb = bot.labouchere;
        
        if (document.getElementById("l-sequence-current")) {
            document.getElementById("l-sequence-current").innerText = lb.currentSequence.join(', ');
            document.getElementById("l-betamount").innerText = lb.betAmount.toFixed(8);
            document.getElementById("l-beton").innerText = lb.betOn.toUpperCase();
            document.getElementById("l-recovery").innerText = lb.recoveryMode ? "YES" : "NO";
            document.getElementById("l-cycle").innerText = `${lb.currentCycle}/${lb.maxCycles > 0 ? lb.maxCycles : '‚àû'}`;
            document.getElementById("l-total-cycles").innerText = lb.totalCyclesCompleted.toString();
            document.getElementById("l-maxbet-display").innerText = lb.maxBet > 0 ? lb.maxBet.toFixed(8) : "Unlimited";
            document.getElementById("l-chance-display").innerText = lb.chance.toFixed(1) + "%";
            document.getElementById("l-basebet-display").innerText = lb.baseBet.toFixed(8);
            document.getElementById("l-minbet-display").innerText = lb.minBet.toFixed(8);
            
            const statusEl = document.getElementById("l-status");
            if (statusEl) {
                if (lb.useMaxBetOnly) {
                    statusEl.textContent = "MAX BET MODE";
                    statusEl.style.color = "#f59e0b";
                } else {
                    statusEl.textContent = "NORMAL";
                    statusEl.style.color = "#10b981";
                }
            }
            
            const seqContainer = document.getElementById("l-sequence-visual");
            if (seqContainer) {
                seqContainer.innerHTML = '';
                lb.currentSequence.forEach((num, idx) => {
                    const numEl = document.createElement("span");
                    numEl.className = "sequence-number";
                    numEl.textContent = num;
                    if (idx === 0 || idx === lb.currentSequence.length - 1) {
                        numEl.style.backgroundColor = "#ff3366";
                        numEl.style.color = "#fff";
                    }
                    seqContainer.appendChild(numEl);
                });
            }
        }
    }

    // ... [Kode updateProgressBar tetap sama] ...

    function createUI() {
        if (document.getElementById("orion-wrap")) document.getElementById("orion-wrap").remove();
        
        const s = document.createElement("style");
        s.innerHTML = `
            /* ... [CSS tetap sama, tambahkan style untuk input baru] ... */
            
            .labouchere-settings-grid {
                display: grid;
                grid-template-columns: repeat(2, 1fr);
                gap: 12px;
                margin-bottom: 12px;
            }
            
            .labouchere-setting-card {
                background: linear-gradient(135deg, rgba(30, 41, 59, 0.9), rgba(15, 23, 42, 0.9));
                border: 1px solid var(--border);
                border-radius: 10px;
                padding: 14px;
                text-align: center;
                transition: all 0.2s ease;
            }
            
            .labouchere-setting-card:hover {
                border-color: #8b5cf6;
                transform: translateY(-1px);
            }
            
            .labouchere-setting-label {
                font-size: 9px;
                color: var(--gray);
                text-transform: uppercase;
                letter-spacing: 0.5px;
                margin-bottom: 8px;
                display: block;
                line-height: 1.2;
                font-weight: 600;
            }
            
            .labouchere-setting-value {
                font-size: 12px;
                font-weight: 700;
                color: var(--light);
                font-family: 'JetBrains Mono', monospace;
                width: 100%;
                background: rgba(15, 23, 42, 0.8);
                border: 1px solid var(--border);
                padding: 8px;
                border-radius: 8px;
                text-align: center;
                transition: all 0.2s ease;
            }
            
            .labouchere-setting-value:focus {
                outline: none;
                border-color: #8b5cf6;
                background: rgba(139, 92, 246, 0.1);
            }
            
            .labouchere-current-value {
                font-size: 9px;
                color: #8b5cf6;
                margin-top: 6px;
                display: block;
                font-weight: 600;
            }
            
            .wager-divider-card {
                background: linear-gradient(135deg, rgba(30, 41, 59, 0.9), rgba(15, 23, 42, 0.9));
                border: 1px solid var(--border);
                border-radius: 10px;
                padding: 14px;
                text-align: center;
                transition: all 0.2s ease;
                grid-column: span 2;
            }
            
            .wager-divider-card:hover {
                border-color: var(--primary);
                transform: translateY(-1px);
            }
            
            .labouchere-stats-grid {
                display: grid;
                grid-template-columns: repeat(3, 1fr);
                gap: 8px;
                margin-top: 12px;
            }
            
            .labouchere-stat-item {
                background: rgba(139, 92, 246, 0.1);
                border: 1px solid rgba(139, 92, 246, 0.3);
                border-radius: 8px;
                padding: 10px;
                text-align: center;
            }
            
            .labouchere-stat-label {
                font-size: 8px;
                color: #a78bfa;
                text-transform: uppercase;
                letter-spacing: 0.5px;
                margin-bottom: 4px;
                font-weight: 600;
            }
            
            .labouchere-stat-value {
                font-size: 11px;
                font-weight: 700;
                color: var(--light);
                font-family: 'JetBrains Mono', monospace;
            }
            
            .status-badge {
                display: inline-block;
                padding: 3px 8px;
                border-radius: 6px;
                font-size: 9px;
                font-weight: 700;
                text-transform: uppercase;
                letter-spacing: 0.5px;
                margin-top: 4px;
            }
        `;
        document.head.appendChild(s);
        
        const d = document.createElement("div");
        d.id = "orion-wrap";
        d.innerHTML = `
            <div class="header">
                <div class="header-content">
                    <div>
                        <div class="app-title">ORION v8.1</div>
                        <div class="app-subtitle">ENHANCED LABOUCHERE</div>
                    </div>
                    <div class="header-controls">
                        <div class="control-btn minimize" title="Minimize">
                            _
                        </div>
                        <div class="control-btn close" title="Close">
                            √ó
                        </div>
                    </div>
                </div>
                
                <div class="user-info-bar">
                    <div class="user-info-left">
                        <span style="color: var(--gray);">USER:</span>
                        <span class="user-badge" id="user-name">${bot.stakeUser}</span>
                    </div>
                    <div class="user-info-right">
                        <span style="color: var(--gray);">EXPIRES:</span>
                        <span class="date-badge" id="expiration-date">Loading...</span>
                    </div>
                </div>
            </div>
            
            <div class="content">
                <div class="status-indicator">
                    <div class="status-card">
                        <div class="status-label">Current Mode</div>
                        <div class="mode-indicator" id="mode-indicator">
                            <div class="mode-dot" style="background: ${getModeColor()}"></div>
                            <span id="current-mode">${bot.mode.toUpperCase()}</span>
                        </div>
                    </div>
                    <div class="status-card">
                        <div class="status-label">Step Limit</div>
                        <div class="status-value" id="step-limit-display">${bot.rotationState.stepLimit}</div>
                    </div>
                    <div class="status-card">
                        <div class="status-label">Status</div>
                        <div class="status-value" id="rotation-status" style="color: ${bot.rotationState.inRecovery ? '#f59e0b' : '#10b981'}">${bot.rotationState.inRecovery ? 'RECOVERY' : 'READY'}</div>
                    </div>
                </div>
                
                <div class="currency-selector">
                    <span class="currency-label">CURRENCY</span>
                    <select id="p-currency" class="select-field" style="width: 120px; margin: 0;">
                        <!-- Will be populated by sync -->
                    </select>
                </div>
                
                <div class="tabs-container">
                    <div class="tab active" data-tab="orion">‚ö°</div>
                    <div class="tab" data-tab="wager">üéØ</div>
                    <div class="tab" data-tab="labouchere">üé≤</div>
                    <div class="tab" data-tab="settings">‚öôÔ∏è</div>
                </div>
                
                <div class="tab-content active" id="tab-orion">
                    <div class="section">
                        <div class="section-title">Orion Settings</div>
                        
                        <div class="step-limit-display">
                            <div class="step-limit-label">Step Limit</div>
                            <div class="step-limit-value" id="current-step-limit">${bot.rotationState.stepLimit}</div>
                        </div>
                        
                        <div class="grid-2">
                            <div class="input-group">
                                <label class="input-label">
                                    <span class="input-label-text">Base Bet</span>
                                </label>
                                <input id="p-basebet" class="input-field" value="0.00000001" type="number" step="0.00000001" min="0">
                            </div>
                            <div class="input-group">
                                <label class="input-label">
                                    <span class="input-label-text">Min Bet</span>
                                </label>
                                <input id="p-minbet" class="input-field" value="0.00000000" type="number" step="0.00000001" min="0">
                            </div>
                        </div>
                        
                        <div class="grid-2">
                            <div class="input-group">
                                <label class="input-label">
                                    <span class="input-label-text">Chance Min</span>
                                </label>
                                <input id="p-ch-min" class="input-field" value="5.0" type="number" step="0.1" min="1" max="99">
                            </div>
                            <div class="input-group">
                                <label class="input-label">
                                    <span class="input-label-text">Chance Max</span>
                                </label>
                                <input id="p-ch-max" class="input-field" value="12.0" type="number" step="0.1" min="1" max="99">
                            </div>
                        </div>
                        
                        <div class="grid-2">
                            <div class="input-group">
                                <label class="input-label">
                                    <span class="input-label-text">Target %</span>
                                </label>
                                <input id="p-target-pct" class="input-field" value="10.0" type="number" step="0.1" min="0" max="1000">
                            </div>
                            <div class="input-group">
                                <label class="input-label">
                                    <span class="input-label-text">Stop Loss %</span>
                                </label>
                                <input id="p-stop-pct" class="input-field" value="50.0" type="number" step="0.1" min="0" max="1000">
                            </div>
                        </div>
                        
                        <div class="grid-2">
                            <div class="input-group">
                                <label class="input-label">
                                    <span class="input-label-text">Steps Limit</span>
                                </label>
                                <input id="p-steps" class="input-field" value="10000" type="number" step="100" min="100">
                            </div>
                            <div class="input-group">
                                <label class="input-label">
                                    <span class="input-label-text">Margin</span>
                                </label>
                                <input id="p-margin" class="input-field" value="1.01" type="number" step="0.01" min="1">
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="tab-content" id="tab-wager">
                    <div class="section">
                        <div class="wager-section">
                            <div class="section-title">Wager Settings</div>
                            
                            <div class="grid-2">
                                <div class="input-group">
                                    <label class="input-label">
                                        <span class="input-label-text">Min Bet</span>
                                    </label>
                                    <input type="number" id="w-minbet" class="input-field" value="0.00000001" step="0.00000001" min="0">
                                </div>
                                <div class="input-group">
                                    <label class="input-label">
                                        <span class="input-label-text">Base Bet %</span>
                                    </label>
                                    <input type="number" id="w-basebet-pct" class="input-field" value="1.0" step="0.1" min="0.1" max="10">
                                </div>
                            </div>
                            
                            <div class="wager-divider-card">
                                <label class="wager-setting-label">Wager Divider</label>
                                <input type="number" id="w-wager-divider" class="wager-setting-value" value="2.0" step="0.1" min="1" max="10">
                                <span class="current-value" id="w-wager-divider-current">2.0x</span>
                            </div>
                        </div>
                        
                        <div class="wager-section">
                            <div class="section-title">Chance Settings</div>
                            <div class="wager-settings-grid">
                                <div class="wager-setting-card">
                                    <label class="wager-setting-label">Normal</label>
                                    <input type="number" id="w-chance-normal" class="wager-setting-value" value="97.0" step="0.1" min="1" max="99">
                                    <span class="current-value" id="w-chance-normal-current">97.0%</span>
                                </div>
                                
                                <div class="wager-setting-card">
                                    <label class="wager-setting-label">Recovery</label>
                                    <input type="number" id="w-chance-recovery" class="wager-setting-value" value="25.0" step="0.1" min="1" max="99">
                                    <span class="current-value" id="w-chance-recovery-current">25.0%</span>
                                </div>
                                
                                <div class="wager-setting-card">
                                    <label class="wager-setting-label">Max</label>
                                    <input type="number" id="w-chance-max" class="wager-setting-value" value="99.0" step="0.1" min="1" max="99">
                                    <span class="current-value" id="w-chance-max-current">99.0%</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="wager-section">
                            <div class="section-title">Stop Conditions</div>
                            
                            <div class="xstopwin-grid">
                                <div class="xstopwin-card">
                                    <label class="xstopwin-label">Max Drop %</label>
                                    <input type="number" id="w-xstopwin-1" class="xstopwin-value" value="${bot.wagerStats.xstopwin[0]}" step="0.1" min="0">
                                    <span class="xstopwin-current" id="xstopwin-1-current">${bot.wagerStats.xstopwin[0]}%</span>
                                </div>
                                
                                <div class="xstopwin-card">
                                    <label class="xstopwin-label">Max Bet %</label>
                                    <input type="number" id="w-xstopwin-2" class="xstopwin-value" value="${bot.wagerStats.xstopwin[1]}" step="0.1" min="0">
                                    <span class="xstopwin-current" id="xstopwin-2-current">${bot.wagerStats.xstopwin[1]}%</span>
                                </div>
                                
                                <div class="xstopwin-card">
                                    <label class="xstopwin-label">Lose Streak</label>
                                    <input type="number" id="w-xstopwin-3" class="xstopwin-value" value="${bot.wagerStats.xstopwin[2]}" step="1" min="0">
                                    <span class="xstopwin-current" id="xstopwin-3-current">${bot.wagerStats.xstopwin[2]}</span>
                                </div>
                                
                                <div class="xstopwin-card">
                                    <label class="xstopwin-label">Profit %</label>
                                    <input type="number" id="w-xstopwin-4" class="xstopwin-value" value="${bot.wagerStats.xstopwin[3]}" step="0.1" min="0">
                                    <span class="xstopwin-current" id="xstopwin-4-current">${bot.wagerStats.xstopwin[3]}%</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="tab-content" id="tab-labouchere">
                    <div class="section">
                        <div class="section-title">Enhanced Labouchere Settings</div>
                        
                        <div class="grid-2">
                            <div class="labouchere-input-group">
                                <label class="labouchere-input-label">Sequence</label>
                                <input id="l-sequence" class="labouchere-input-field" value="1,2,3,4" placeholder="e.g., 1,2,3,4">
                            </div>
                            <div class="labouchere-input-group">
                                <label class="labouchere-input-label">Target Profit</label>
                                <input id="l-target" class="labouchere-input-field" value="10" type="number" step="0.00000001" min="0">
                            </div>
                        </div>
                        
                        <div class="labouchere-settings-grid">
                            <div class="labouchere-setting-card">
                                <label class="labouchere-setting-label">Base Bet</label>
                                <input id="l-basebet" class="labouchere-setting-value" value="0.00000001" type="number" step="0.00000001" min="0">
                                <span class="labouchere-current-value" id="l-basebet-current">0.00000001</span>
                            </div>
                            
                            <div class="labouchere-setting-card">
                                <label class="labouchere-setting-label">Min Bet</label>
                                <input id="l-minbet" class="labouchere-setting-value" value="0.00000001" type="number" step="0.00000001" min="0">
                                <span class="labouchere-current-value" id="l-minbet-current">0.00000001</span>
                            </div>
                            
                            <div class="labouchere-setting-card">
                                <label class="labouchere-setting-label">Chance</label>
                                <input id="l-chance" class="labouchere-setting-value" value="49.5" type="number" step="0.1" min="1" max="99">
                                <span class="labouchere-current-value" id="l-chance-current">49.5%</span>
                            </div>
                            
                            <div class="labouchere-setting-card">
                                <label class="labouchere-setting-label">Max Bet</label>
                                <input id="l-maxbet" class="labouchere-setting-value" value="0" type="number" step="0.00000001" min="0" placeholder="0 = Unlimited">
                                <span class="labouchere-current-value" id="l-maxbet-current">Unlimited</span>
                            </div>
                            
                            <div class="labouchere-setting-card" style="grid-column: span 2;">
                                <label class="labouchere-setting-label">Max Cycles</label>
                                <input id="l-maxcycles" class="labouchere-setting-value" value="3" type="number" step="1" min="0" placeholder="0 = Unlimited">
                                <span class="labouchere-current-value" id="l-maxcycles-current">3 cycles</span>
                            </div>
                        </div>
                        
                        <div class="labouchere-input-group">
                            <label class="labouchere-input-label">Current Sequence</label>
                            <div class="sequence-visual" id="l-sequence-visual">
                                <span class="sequence-number">1</span>
                                <span class="sequence-number">2</span>
                                <span class="sequence-number">3</span>
                                <span class="sequence-number">4</span>
                            </div>
                        </div>
                        
                        <div class="labouchere-stats-grid">
                            <div class="labouchere-stat-item">
                                <div class="labouchere-stat-label">Next Bet</div>
                                <div class="labouchere-stat-value" id="l-betamount">0.00000000</div>
                            </div>
                            <div class="labouchere-stat-item">
                                <div class="labouchere-stat-label">Cycle</div>
                                <div class="labouchere-stat-value" id="l-cycle">1/3</div>
                            </div>
                            <div class="labouchere-stat-item">
                                <div class="labouchere-stat-label">Status</div>
                                <div class="labouchere-stat-value" id="l-status">NORMAL</div>
                            </div>
                        </div>
                        
                        <div class="labouchere-stats-grid">
                            <div class="labouchere-stat-item">
                                <div class="labouchere-stat-label">Base Bet</div>
                                <div class="labouchere-stat-value" id="l-basebet-display">0.00000001</div>
                            </div>
                            <div class="labouchere-stat-item">
                                <div class="labouchere-stat-label">Chance</div>
                                <div class="labouchere-stat-value" id="l-chance-display">49.5%</div>
                            </div>
                            <div class="labouchere-stat-item">
                                <div class="labouchere-stat-label">Recovery</div>
                                <div class="labouchere-stat-value" id="l-recovery">NO</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="tab-content" id="tab-settings">
                    <!-- ... [Tab settings tetap sama] ... -->
                </div>
                
                <div class="section">
                    <div class="section-title">Live Statistics</div>
                    
                    <div class="stats-container">
                        <div class="stats-column">
                            <div class="stat-item">
                                <div class="stat-label">Profit</div>
                                <div class="stat-value" id="st-p">0.00000000</div>
                                <div class="stat-subvalue" id="st-p-pct">0.00%</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-label">Wagered</div>
                                <div class="stat-value" id="st-w">0.00000000</div>
                                <div class="stat-subvalue" id="st-w-bets">0 bets</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-label">Win Rate</div>
                                <div class="stat-value" id="st-wr-value">0.00%</div>
                                <div class="stat-subvalue" id="st-r">0 (0/0)</div>
                            </div>
                        </div>
                        <div class="stats-column">
                            <div class="stat-item">
                                <div class="stat-label">Balance</div>
                                <div class="stat-value" id="st-bal">0.00000000</div>
                                <div class="stat-subvalue" id="st-currency">${bot.selectedCurrency.toUpperCase()}</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-label">Max Drawdown</div>
                                <div class="stat-value" id="st-dd">0.00000000</div>
                                <div class="stat-subvalue" id="st-dd-pct">0.00%</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-label">Streak</div>
                                <div class="stat-value" id="st-streak-value">0</div>
                                <div class="stat-subvalue" id="st-streak-type">Neutral</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="section">
                    <div class="section-title">Activity Logs</div>
                    <div class="logs-container" id="p-logs">
                        <div style="color: var(--gray); text-align: center; padding: 40px 0; font-size: 11px; font-style: italic;">
                            Waiting for engine start...
                        </div>
                    </div>
                </div>
                
                <div class="button-group">
                    <button id="p-start" class="btn btn-primary">
                        ‚ñ∂ START
                    </button>
                    <button id="p-stop" class="btn btn-danger">
                        ‚èπ STOP
                    </button>
                </div>
                
                <button id="telegram-report-btn" class="btn btn-warning">
                    üìä TG REPORT
                </button>
            </div>
        `;
        document.body.appendChild(d);
        
        // ... [Event listeners tetap sama, tambahkan yang baru] ...
        
        // Wager Divider
        const wagerDivider = document.getElementById("w-wager-divider");
        if (wagerDivider) {
            wagerDivider.addEventListener('change', (e) => {
                const val = parseFloat(e.target.value) || 2.0;
                bot.wagerStats.wagerDivider = val;
                const currentEl = document.getElementById("w-wager-divider-current");
                if (currentEl) currentEl.textContent = `${val.toFixed(1)}x`;
                updateLogs(0, 0, 0, `Wager Divider: ${val.toFixed(1)}x`, true);
            });
        }
        
        // Labouchere Base Bet
        const lBaseBet = document.getElementById("l-basebet");
        if (lBaseBet) {
            lBaseBet.addEventListener('change', (e) => {
                const val = parseFloat(e.target.value) || 0.00000001;
                bot.labouchere.baseBet = val;
                const currentEl = document.getElementById("l-basebet-current");
                if (currentEl) currentEl.textContent = val.toFixed(8);
            });
        }
        
        // Labouchere Min Bet
        const lMinBet = document.getElementById("l-minbet");
        if (lMinBet) {
            lMinBet.addEventListener('change', (e) => {
                const val = parseFloat(e.target.value) || 0.00000001;
                bot.labouchere.minBet = val;
                const currentEl = document.getElementById("l-minbet-current");
                if (currentEl) currentEl.textContent = val.toFixed(8);
            });
        }
        
        // Labouchere Chance
        const lChance = document.getElementById("l-chance");
        if (lChance) {
            lChance.addEventListener('change', (e) => {
                const val = parseFloat(e.target.value) || 49.5;
                bot.labouchere.chance = val;
                const currentEl = document.getElementById("l-chance-current");
                if (currentEl) currentEl.textContent = `${val}%`;
            });
        }
        
        // Labouchere Max Bet
        const lMaxBet = document.getElementById("l-maxbet");
        if (lMaxBet) {
            lMaxBet.addEventListener('change', (e) => {
                const val = parseFloat(e.target.value) || 0;
                bot.labouchere.maxBet = val;
                const currentEl = document.getElementById("l-maxbet-current");
                if (currentEl) {
                    if (val > 0) {
                        currentEl.textContent = val.toFixed(8);
                    } else {
                        currentEl.textContent = "Unlimited";
                    }
                }
            });
        }
        
        // Labouchere Max Cycles
        const lMaxCycles = document.getElementById("l-maxcycles");
        if (lMaxCycles) {
            lMaxCycles.addEventListener('change', (e) => {
                const val = parseInt(e.target.value) || 3;
                bot.labouchere.maxCycles = val;
                const currentEl = document.getElementById("l-maxcycles-current");
                if (currentEl) {
                    if (val > 0) {
                        currentEl.textContent = `${val} cycles`;
                    } else {
                        currentEl.textContent = "Unlimited";
                    }
                }
            });
        }
        
        // ... [Event listeners lainnya tetap sama] ...
    }

    // ... [Kode updateModeIndicator dan interval update tetap sama] ...
})();
